{
    "ClientConfiguration": {
        "ConfigurationName": "Простой склад",
        "ConfigurationDescription": "Автономное решение для простейшего учета",
        "ConfigurationVersion": "0.9.2",
        "Processes": [
            {
                "type": "Process",
                "ProcessName": "Справочник товаров",
                "PlanFactHeader": "План-факт",
                "DefineOnBackPressed": true,
                "hidden": false,
                "login_screen": false,
                "SC": false,
                "Operations": [
                    {
                        "type": "Operation",
                        "Name": "Меню НСИ",
                        "Timer": false,
                        "hideToolBarScreen": false,
                        "noScroll": true,
                        "handleKeyUp": false,
                        "noConfirmation": true,
                        "hideBottomBarScreen": true,
                        "onlineOnStart": false,
                        "send_when_opened": true,
                        "onlineOnInput": false,
                        "DefOnlineOnCreate": "",
                        "DefOnlineOnInput": "",
                        "DefOnCreate": "_menu_on_start",
                        "DefOnInput": "_menu_input",
                        "Elements": [
                            {
                                "Value": "",
                                "Variable": "",
                                "type": "LinearLayout",
                                "weight": "0",
                                "height": "match_parent",
                                "width": "match_parent",
                                "orientation": "vertical",
                                "Elements": [
                                    {
                                        "type": "CButtons",
                                        "height": "match_parent",
                                        "width": "match_parent",
                                        "weight": "0",
                                        "Value": "Добавить товар;Добавить ячейку;Добавить группу товаров;Добавить единицу измерения",
                                        "Variable": "menu"
                                    }
                                ]
                            }
                        ],
                        "onlineOnAfterStart": false
                    },
                    {
                        "Name": "ДиалогЕдиницы",
                        "type": "Operation",
                        "Elements": [
                            {
                                "Value": "",
                                "Variable": "",
                                "type": "LinearLayout",
                                "weight": "0",
                                "height": "wrap_content",
                                "width": "match_parent",
                                "orientation": "vertical",
                                "Elements": [
                                    {
                                        "type": "TextView",
                                        "height": "wrap_content",
                                        "width": "match_parent",
                                        "weight": "0",
                                        "Value": "Название",
                                        "Variable": "",
                                        "TextBold": true,
                                        "BackgroundColor": "",
                                        "TextSize": "17",
                                        "TextColor": "#696969"
                                    },
                                    {
                                        "type": "EditTextText",
                                        "height": "wrap_content",
                                        "width": "match_parent",
                                        "weight": "0",
                                        "Value": "@name",
                                        "Variable": "name",
                                        "gravity_horizontal": "left",
                                        "TextSize": "17"
                                    }
                                ]
                            }
                        ],
                        "Timer": false,
                        "hideToolBarScreen": false,
                        "noScroll": false,
                        "handleKeyUp": false,
                        "hideBottomBarScreen": true,
                        "onlineOnStart": false,
                        "onlineOnInput": false,
                        "onlineOnAfterStart": false
                    },
                    {
                        "Name": "Добавить товар",
                        "type": "Operation",
                        "Elements": [
                            {
                                "Value": "",
                                "Variable": "",
                                "type": "LinearLayout",
                                "weight": "0",
                                "height": "match_parent",
                                "width": "match_parent",
                                "orientation": "vertical",
                                "Elements": [
                                    {
                                        "type": "LinearLayout",
                                        "height": "wrap_content",
                                        "width": "match_parent",
                                        "weight": "0",
                                        "Value": "Добавить",
                                        "Variable": "btn_add",
                                        "orientation": "horizontal",
                                        "Elements": [
                                            {
                                                "type": "Button",
                                                "height": "wrap_content",
                                                "width": "match_parent",
                                                "weight": "1",
                                                "Value": "#f055",
                                                "Variable": "btn_add",
                                                "TextSize": "25",
                                                "BackgroundColor": "#3CB371"
                                            }
                                        ]
                                    },
                                    {
                                        "type": "CardsLayout",
                                        "height": "match_parent",
                                        "width": "match_parent",
                                        "weight": "0",
                                        "Value": "@list",
                                        "Variable": ""
                                    }
                                ],
                                "BackgroundColor": "",
                                "StrokeWidth": "",
                                "Padding": ""
                            },
                            {
                                "Value": "",
                                "Variable": "barcode_search",
                                "type": "barcode"
                            }
                        ],
                        "Timer": false,
                        "hideToolBarScreen": false,
                        "noScroll": false,
                        "handleKeyUp": false,
                        "hideBottomBarScreen": true,
                        "onlineOnStart": false,
                        "onlineOnInput": false,
                        "DefOnCreate": "_goods_on_start",
                        "DefOnInput": "_goods_input",
                        "noConfirmation": true,
                        "send_when_opened": true,
                        "onlineOnAfterStart": false
                    },
                    {
                        "Name": "ТоварыЗапись",
                        "type": "Operation",
                        "Elements": [
                            {
                                "Value": "",
                                "Variable": "",
                                "type": "LinearLayout",
                                "weight": "0",
                                "height": "match_parent",
                                "width": "match_parent",
                                "orientation": "vertical",
                                "Elements": [
                                    {
                                        "type": "TextView",
                                        "height": "wrap_content",
                                        "width": "match_parent",
                                        "weight": "0",
                                        "Value": "Удалить карточку товара",
                                        "Variable": "",
                                        "gravity_horizontal": "right",
                                        "TextSize": "",
                                        "TextBold": true,
                                        "TextItalic": true
                                    },
                                    {
                                        "type": "Button",
                                        "height": "wrap_content",
                                        "width": "match_parent",
                                        "weight": "0",
                                        "Value": "Сохранить...",
                                        "Variable": "btn_save",
                                        "BackgroundColor": "#E4D00A"
                                    },
                                    {
                                        "type": "ModernEditText",
                                        "height": "wrap_content",
                                        "width": "match_parent",
                                        "weight": "0",
                                        "Value": "@fill_name",
                                        "Variable": "name"
                                    },
                                    {
                                        "type": "ModernEditText",
                                        "height": "wrap_content",
                                        "width": "match_parent",
                                        "weight": "0",
                                        "Value": "@fill_product_number",
                                        "Variable": "product_number"
                                    },
                                    {
                                        "type": "ModernEditText",
                                        "height": "wrap_content",
                                        "width": "match_parent",
                                        "weight": "0",
                                        "Value": "@fill_price",
                                        "Variable": "price",
                                        "TextBold": true
                                    },
                                    {
                                        "type": "TextView",
                                        "height": "wrap_content",
                                        "width": "match_parent",
                                        "weight": "0",
                                        "Value": "Единица",
                                        "Variable": "",
                                        "TextBold": false
                                    },
                                    {
                                        "type": "SpinnerLayout",
                                        "height": "wrap_content",
                                        "width": "match_parent",
                                        "weight": "0",
                                        "Value": "@units",
                                        "Variable": "unit"
                                    },
                                    {
                                        "type": "ModernEditText",
                                        "height": "wrap_content",
                                        "width": "match_parent",
                                        "weight": "0",
                                        "Value": "@fill_barcode",
                                        "Variable": "barcode"
                                    },
                                    {
                                        "type": "TextView",
                                        "height": "wrap_content",
                                        "width": "match_parent",
                                        "weight": "0",
                                        "Value": "Группа",
                                        "Variable": ""
                                    },
                                    {
                                        "type": "SpinnerLayout",
                                        "height": "wrap_content",
                                        "width": "match_parent",
                                        "weight": "0",
                                        "Value": "@groups",
                                        "Variable": "group"
                                    },
                                    {
                                        "type": "TextView",
                                        "height": "wrap_content",
                                        "width": "match_parent",
                                        "weight": "1",
                                        "Value": "Сделать фото... Выбрать из галереи...",
                                        "Variable": "",
                                        "height_value": "0",
                                        "gravity_horizontal": "left"
                                    }
                                ],
                                "BackgroundColor": "",
                                "StrokeWidth": "",
                                "Padding": ""
                            },
                            {
                                "Value": "#f2ed",
                                "Variable": "menu_del",
                                "type": "MenuItem"
                            },
                            {
                                "Value": "@photoGallery",
                                "Variable": "photoGallery",
                                "type": "HorizontalGallery"
                            },
                            {
                                "Value": "",
                                "Variable": "photo",
                                "type": "photoGallery"
                            },
                            {
                                "Value": "",
                                "Variable": "barcode_nom",
                                "type": "barcode"
                            },
                            {
                                "Value": "",
                                "Variable": "photo",
                                "type": "photo"
                            }
                        ],
                        "Timer": false,
                        "hideToolBarScreen": false,
                        "noScroll": true,
                        "handleKeyUp": false,
                        "hideBottomBarScreen": true,
                        "onlineOnStart": false,
                        "onlineOnInput": false,
                        "DefOnCreate": "_goods_record_on_start",
                        "DefOnInput": "_goods_record_input",
                        "noConfirmation": true,
                        "send_when_opened": true,
                        "onlineOnAfterStart": false
                    },
                    {
                        "Name": "ДиалогГруппы",
                        "type": "Operation",
                        "Elements": [
                            {
                                "Value": "",
                                "Variable": "",
                                "type": "LinearLayout",
                                "weight": "0",
                                "height": "wrap_content",
                                "width": "match_parent",
                                "orientation": "vertical",
                                "Elements": [
                                    {
                                        "type": "TextView",
                                        "height": "wrap_content",
                                        "width": "match_parent",
                                        "weight": "0",
                                        "Value": "Название",
                                        "Variable": "",
                                        "TextBold": true,
                                        "BackgroundColor": "",
                                        "TextSize": "17",
                                        "TextColor": "#696969"
                                    },
                                    {
                                        "type": "EditTextText",
                                        "height": "wrap_content",
                                        "width": "match_parent",
                                        "weight": "0",
                                        "Value": "@name",
                                        "Variable": "name",
                                        "gravity_horizontal": "left",
                                        "TextSize": "17"
                                    }
                                ]
                            }
                        ],
                        "Timer": false,
                        "hideToolBarScreen": false,
                        "noScroll": false,
                        "handleKeyUp": false,
                        "hideBottomBarScreen": true,
                        "onlineOnStart": false,
                        "onlineOnInput": false,
                        "onlineOnAfterStart": false
                    },
                    {
                        "Name": "Добавить ячейку",
                        "type": "Operation",
                        "Elements": [
                            {
                                "Value": "",
                                "Variable": "",
                                "type": "LinearLayout",
                                "weight": "0",
                                "height": "match_parent",
                                "width": "match_parent",
                                "orientation": "vertical",
                                "Elements": [
                                    {
                                        "type": "LinearLayout",
                                        "height": "wrap_content",
                                        "width": "match_parent",
                                        "weight": "0",
                                        "Value": "Добавить",
                                        "Variable": "btn_add",
                                        "orientation": "horizontal",
                                        "Elements": [
                                            {
                                                "type": "Button",
                                                "height": "wrap_content",
                                                "width": "match_parent",
                                                "weight": "1",
                                                "Value": "#f055",
                                                "Variable": "btn_add",
                                                "TextSize": "25",
                                                "BackgroundColor": "#3CB371"
                                            }
                                        ]
                                    },
                                    {
                                        "type": "CardsLayout",
                                        "height": "match_parent",
                                        "width": "match_parent",
                                        "weight": "0",
                                        "Value": "@list",
                                        "Variable": ""
                                    }
                                ]
                            }
                        ],
                        "Timer": false,
                        "hideToolBarScreen": false,
                        "noScroll": false,
                        "handleKeyUp": false,
                        "hideBottomBarScreen": true,
                        "onlineOnStart": false,
                        "onlineOnInput": false,
                        "DefOnCreate": "_cells_on_start",
                        "DefOnInput": "_cells_input",
                        "send_when_opened": true,
                        "onlineOnAfterStart": false
                    },
                    {
                        "Name": "ЯчейкиЗапись",
                        "type": "Operation",
                        "Elements": [
                            {
                                "Value": "",
                                "Variable": "",
                                "type": "LinearLayout",
                                "weight": "0",
                                "height": "match_parent",
                                "width": "match_parent",
                                "orientation": "vertical",
                                "Elements": [
                                    {
                                        "type": "Button",
                                        "height": "wrap_content",
                                        "width": "match_parent",
                                        "weight": "0",
                                        "Value": "Сохранить...",
                                        "Variable": "btn_save",
                                        "BackgroundColor": "#E4D00A"
                                    },
                                    {
                                        "type": "ModernEditText",
                                        "height": "wrap_content",
                                        "width": "match_parent",
                                        "weight": "0",
                                        "Value": "@fill_name",
                                        "Variable": "name"
                                    },
                                    {
                                        "type": "ModernEditText",
                                        "height": "wrap_content",
                                        "width": "match_parent",
                                        "weight": "0",
                                        "Value": "@fill_barcode",
                                        "Variable": "barcode"
                                    }
                                ]
                            },
                            {
                                "Value": "#f2ed",
                                "Variable": "menu_del",
                                "type": "MenuItem"
                            },
                            {
                                "Value": "",
                                "Variable": "barcode_cell",
                                "type": "barcode"
                            }
                        ],
                        "Timer": false,
                        "hideToolBarScreen": false,
                        "noScroll": true,
                        "handleKeyUp": false,
                        "hideBottomBarScreen": true,
                        "onlineOnStart": false,
                        "onlineOnInput": false,
                        "DefOnCreate": "cells_record_on_start",
                        "DefOnInput": "cells_record_input",
                        "noConfirmation": true,
                        "send_when_opened": true,
                        "onlineOnAfterStart": false
                    },
                    {
                        "Name": "Добавить группу товаров",
                        "type": "Operation",
                        "Elements": [
                            {
                                "Value": "",
                                "Variable": "",
                                "type": "LinearLayout",
                                "weight": "0",
                                "height": "match_parent",
                                "width": "match_parent",
                                "orientation": "vertical",
                                "Elements": [
                                    {
                                        "type": "LinearLayout",
                                        "height": "wrap_content",
                                        "width": "match_parent",
                                        "weight": "0",
                                        "Value": "Добавить",
                                        "Variable": "btn_add",
                                        "orientation": "horizontal",
                                        "Elements": [
                                            {
                                                "type": "Button",
                                                "height": "wrap_content",
                                                "width": "match_parent",
                                                "weight": "1",
                                                "Value": "#f055",
                                                "Variable": "btn_add",
                                                "TextSize": "25",
                                                "BackgroundColor": "#3CB371"
                                            }
                                        ]
                                    },
                                    {
                                        "type": "TableLayout",
                                        "height": "match_parent",
                                        "width": "match_parent",
                                        "weight": "0",
                                        "Value": "@list",
                                        "Variable": ""
                                    }
                                ]
                            }
                        ],
                        "Timer": false,
                        "hideToolBarScreen": false,
                        "noScroll": true,
                        "handleKeyUp": false,
                        "hideBottomBarScreen": true,
                        "onlineOnStart": false,
                        "onlineOnInput": false,
                        "DefOnInput": "_groups_input",
                        "DefOnCreate": "_groups_on_start",
                        "send_when_opened": true,
                        "onlineOnAfterStart": false
                    },
                    {
                        "Name": "Добавить единицу измерения",
                        "type": "Operation",
                        "Elements": [
                            {
                                "Value": "",
                                "Variable": "",
                                "type": "LinearLayout",
                                "weight": "0",
                                "height": "match_parent",
                                "width": "match_parent",
                                "orientation": "vertical",
                                "Elements": [
                                    {
                                        "type": "LinearLayout",
                                        "height": "wrap_content",
                                        "width": "match_parent",
                                        "weight": "0",
                                        "Value": "Добавить",
                                        "Variable": "btn_add",
                                        "orientation": "horizontal",
                                        "Elements": [
                                            {
                                                "type": "Button",
                                                "height": "wrap_content",
                                                "width": "match_parent",
                                                "weight": "1",
                                                "Value": "#f055",
                                                "Variable": "btn_add",
                                                "TextSize": "25",
                                                "BackgroundColor": "#3CB371"
                                            }
                                        ]
                                    },
                                    {
                                        "type": "TableLayout",
                                        "height": "match_parent",
                                        "width": "match_parent",
                                        "weight": "0",
                                        "Value": "@list",
                                        "Variable": ""
                                    }
                                ]
                            }
                        ],
                        "Timer": false,
                        "hideToolBarScreen": false,
                        "noScroll": true,
                        "handleKeyUp": false,
                        "hideBottomBarScreen": true,
                        "onlineOnStart": false,
                        "onlineOnInput": false,
                        "DefOnInput": "_units_input",
                        "DefOnCreate": "_units_on_start",
                        "send_when_opened": true,
                        "onlineOnAfterStart": false
                    }
                ]
            },
            {
                "ProcessName": "Приемка",
                "type": "Process",
                "Operations": [
                    {
                        "Name": "Выбор ячейки",
                        "type": "Operation",
                        "Elements": [
                            {
                                "Value": "",
                                "Variable": "",
                                "type": "LinearLayout",
                                "weight": "0",
                                "height": "match_parent",
                                "width": "match_parent",
                                "orientation": "vertical",
                                "Elements": [
                                    {
                                        "type": "TextView",
                                        "height": "wrap_content",
                                        "width": "match_parent",
                                        "weight": "0",
                                        "Value": "Сканируйте или выберите ячейку",
                                        "Variable": "",
                                        "BackgroundColor": "#3B5958",
                                        "TextSize": "20",
                                        "TextColor": "#FFFFFF",
                                        "TextBold": true
                                    },
                                    {
                                        "type": "SpinnerLayout",
                                        "height": "wrap_content",
                                        "width": "match_parent",
                                        "weight": "0",
                                        "Value": "@cells",
                                        "Variable": "cell"
                                    }
                                ],
                                "BackgroundColor": "",
                                "StrokeWidth": "",
                                "Padding": ""
                            },
                            {
                                "Value": "",
                                "Variable": "barcode_cell",
                                "type": "barcode"
                            },
                            {
                                "Value": "",
                                "Variable": "",
                                "type": "LinearLayout",
                                "weight": "0",
                                "height": "wrap_content",
                                "width": "wrap_content",
                                "orientation": "vertical",
                                "Elements": [
                                    {
                                        "type": "TextView",
                                        "height": "match_parent",
                                        "width": "match_parent",
                                        "weight": "0",
                                        "Value": " ",
                                        "Variable": "",
                                        "TextSize": "72"
                                    },
                                    {
                                        "type": "TextView",
                                        "height": "match_parent",
                                        "width": "match_parent",
                                        "weight": "0",
                                        "Value": " ",
                                        "Variable": "",
                                        "TextSize": "72"
                                    },
                                    {
                                        "type": "TextView",
                                        "height": "match_parent",
                                        "width": "match_parent",
                                        "weight": "0",
                                        "Value": " ",
                                        "Variable": "",
                                        "TextSize": "72"
                                    },
                                    {
                                        "type": "TextView",
                                        "height": "match_parent",
                                        "width": "match_parent",
                                        "weight": "0",
                                        "Value": " ",
                                        "Variable": "",
                                        "TextSize": "53"
                                    },
                                    {
                                        "type": "TextView",
                                        "height": "wrap_content",
                                        "width": "match_parent",
                                        "weight": "0",
                                        "Value": "Сканируйте штрихкод камерой устройства",
                                        "Variable": "",
                                        "TextSize": "15",
                                        "gravity_horizontal": "right",
                                        "TextBold": true,
                                        "TextItalic": true
                                    }
                                ],
                                "BackgroundColor": "",
                                "StrokeWidth": "",
                                "Padding": ""
                            }
                        ],
                        "Timer": false,
                        "hideToolBarScreen": false,
                        "noScroll": false,
                        "handleKeyUp": false,
                        "hideBottomBarScreen": true,
                        "onlineOnStart": false,
                        "onlineOnInput": false,
                        "DefOnCreate": "_income_cell_on_start",
                        "DefOnInput": "_income_cell_on_input",
                        "send_when_opened": true,
                        "onlineOnAfterStart": false
                    },
                    {
                        "Name": "Выбор товара",
                        "type": "Operation",
                        "Elements": [
                            {
                                "Value": "",
                                "Variable": "",
                                "type": "LinearLayout",
                                "weight": "0",
                                "height": "match_parent",
                                "width": "match_parent",
                                "orientation": "vertical",
                                "Elements": [
                                    {
                                        "type": "TextView",
                                        "height": "wrap_content",
                                        "width": "match_parent",
                                        "weight": "0",
                                        "Value": "Сканируйте товар",
                                        "Variable": "",
                                        "BackgroundColor": "#3B5958",
                                        "TextSize": "20",
                                        "TextColor": "#FFFFFF",
                                        "TextBold": true
                                    },
                                    {
                                        "type": "TextView",
                                        "height": "wrap_content",
                                        "width": "match_parent",
                                        "weight": "0",
                                        "Value": "Ячейка",
                                        "Variable": "",
                                        "TextSize": "20"
                                    },
                                    {
                                        "type": "TextView",
                                        "height": "wrap_content",
                                        "width": "match_parent",
                                        "weight": "0",
                                        "Value": "@cell",
                                        "Variable": "",
                                        "TextBold": true,
                                        "TextSize": "22"
                                    },
                                    {
                                        "type": "TextView",
                                        "height": "wrap_content",
                                        "width": "match_parent",
                                        "weight": "0",
                                        "Value": "Товары в ячейке",
                                        "Variable": ""
                                    },
                                    {
                                        "type": "TableLayout",
                                        "height": "match_parent",
                                        "width": "match_parent",
                                        "weight": "0",
                                        "Value": "@table_object",
                                        "Variable": ""
                                    }
                                ],
                                "BackgroundColor": "",
                                "StrokeWidth": "",
                                "Padding": ""
                            },
                            {
                                "Value": "",
                                "Variable": "barcode",
                                "type": "barcode"
                            }
                        ],
                        "Timer": false,
                        "hideToolBarScreen": false,
                        "noScroll": false,
                        "handleKeyUp": false,
                        "hideBottomBarScreen": true,
                        "onlineOnStart": false,
                        "onlineOnInput": false,
                        "DefOnCreate": "",
                        "DefOnInput": "_income_nom_input",
                        "onlineOnAfterStart": false
                    },
                    {
                        "Name": "Ввод количества",
                        "type": "Operation",
                        "Elements": [
                            {
                                "Value": "",
                                "Variable": "",
                                "type": "LinearLayout",
                                "weight": "0",
                                "height": "match_parent",
                                "width": "match_parent",
                                "orientation": "vertical",
                                "Elements": [
                                    {
                                        "type": "TextView",
                                        "height": "wrap_content",
                                        "width": "match_parent",
                                        "weight": "0",
                                        "Value": "Укажите количество",
                                        "Variable": "",
                                        "BackgroundColor": "#3B5958",
                                        "TextSize": "20",
                                        "TextColor": "#FFFFFF",
                                        "TextBold": true
                                    },
                                    {
                                        "type": "TextView",
                                        "height": "wrap_content",
                                        "width": "match_parent",
                                        "weight": "0",
                                        "Value": "Ячейка",
                                        "Variable": "",
                                        "TextSize": "20"
                                    },
                                    {
                                        "type": "TextView",
                                        "height": "wrap_content",
                                        "width": "match_parent",
                                        "weight": "0",
                                        "Value": "@cell",
                                        "Variable": "",
                                        "TextBold": true,
                                        "TextSize": "22"
                                    },
                                    {
                                        "type": "TextView",
                                        "height": "wrap_content",
                                        "width": "match_parent",
                                        "weight": "0",
                                        "Value": "Товар",
                                        "Variable": "",
                                        "TextSize": "20"
                                    },
                                    {
                                        "type": "TextView",
                                        "height": "wrap_content",
                                        "width": "match_parent",
                                        "weight": "0",
                                        "Value": "@nom",
                                        "Variable": "",
                                        "TextBold": true,
                                        "TextSize": "22"
                                    },
                                    {
                                        "type": "LinearLayout",
                                        "height": "wrap_content",
                                        "width": "match_parent",
                                        "weight": "0",
                                        "Value": "",
                                        "Variable": "",
                                        "orientation": "horizontal",
                                        "Elements": [
                                            {
                                                "type": "TextView",
                                                "height": "wrap_content",
                                                "width": "match_parent",
                                                "weight": "1",
                                                "Value": "Кол-во",
                                                "Variable": ""
                                            },
                                            {
                                                "type": "EditTextNumeric",
                                                "height": "wrap_content",
                                                "width": "match_parent",
                                                "weight": "1",
                                                "Value": "@qty",
                                                "Variable": "qty",
                                                "BackgroundColor": "#F7ECEB",
                                                "TextBold": true
                                            }
                                        ]
                                    }
                                ]
                            }
                        ],
                        "Timer": false,
                        "hideToolBarScreen": false,
                        "noScroll": false,
                        "handleKeyUp": false,
                        "hideBottomBarScreen": true,
                        "onlineOnStart": false,
                        "onlineOnInput": false,
                        "DefOnInput": "_income_qty_input",
                        "onlineOnAfterStart": false
                    }
                ],
                "PlanFactHeader": "Состав"
            },
            {
                "ProcessName": "Отгрузка",
                "type": "Process",
                "Operations": [
                    {
                        "Name": "Выбор ячейки",
                        "type": "Operation",
                        "Elements": [
                            {
                                "Value": "",
                                "Variable": "",
                                "type": "LinearLayout",
                                "weight": "0",
                                "height": "match_parent",
                                "width": "match_parent",
                                "orientation": "vertical",
                                "Elements": [
                                    {
                                        "type": "TextView",
                                        "height": "wrap_content",
                                        "width": "match_parent",
                                        "weight": "0",
                                        "Value": "Сканируйте или выберите ячейку",
                                        "Variable": "",
                                        "BackgroundColor": "#3B5958",
                                        "TextSize": "20",
                                        "TextColor": "#FFFFFF",
                                        "TextBold": true
                                    },
                                    {
                                        "type": "SpinnerLayout",
                                        "height": "wrap_content",
                                        "width": "match_parent",
                                        "weight": "0",
                                        "Value": "@cells",
                                        "Variable": "cell"
                                    }
                                ]
                            },
                            {
                                "Value": "",
                                "Variable": "barcode_cell",
                                "type": "barcode"
                            }
                        ],
                        "Timer": false,
                        "hideToolBarScreen": false,
                        "noScroll": false,
                        "handleKeyUp": false,
                        "hideBottomBarScreen": true,
                        "onlineOnStart": false,
                        "onlineOnInput": false,
                        "DefOnCreate": "_income_cell_on_start",
                        "DefOnInput": "_income_cell_on_input",
                        "send_when_opened": true,
                        "onlineOnAfterStart": false
                    },
                    {
                        "Name": "Выбор товара",
                        "type": "Operation",
                        "Elements": [
                            {
                                "Value": "",
                                "Variable": "",
                                "type": "LinearLayout",
                                "weight": "0",
                                "height": "match_parent",
                                "width": "match_parent",
                                "orientation": "vertical",
                                "Elements": [
                                    {
                                        "type": "TextView",
                                        "height": "wrap_content",
                                        "width": "match_parent",
                                        "weight": "0",
                                        "Value": "Сканируйте товар",
                                        "Variable": "",
                                        "BackgroundColor": "#3B5958",
                                        "TextSize": "20",
                                        "TextColor": "#FFFFFF",
                                        "TextBold": true
                                    },
                                    {
                                        "type": "TextView",
                                        "height": "wrap_content",
                                        "width": "match_parent",
                                        "weight": "0",
                                        "Value": "Ячейка",
                                        "Variable": "",
                                        "TextSize": "20"
                                    },
                                    {
                                        "type": "TextView",
                                        "height": "wrap_content",
                                        "width": "match_parent",
                                        "weight": "0",
                                        "Value": "@cell",
                                        "Variable": "",
                                        "TextBold": true,
                                        "TextSize": "22"
                                    },
                                    {
                                        "type": "TextView",
                                        "height": "match_parent",
                                        "width": "match_parent",
                                        "weight": "0",
                                        "Value": "Товары в ячейке",
                                        "Variable": ""
                                    },
                                    {
                                        "type": "TableLayout",
                                        "height": "match_parent",
                                        "width": "match_parent",
                                        "weight": 0,
                                        "Value": "@table_object",
                                        "Variable": ""
                                    }
                                ],
                                "BackgroundColor": "",
                                "StrokeWidth": "",
                                "Padding": ""
                            },
                            {
                                "Value": "",
                                "Variable": "barcode",
                                "type": "barcode"
                            }
                        ],
                        "Timer": false,
                        "hideToolBarScreen": false,
                        "noScroll": false,
                        "handleKeyUp": false,
                        "hideBottomBarScreen": true,
                        "onlineOnStart": false,
                        "onlineOnInput": false,
                        "DefOnCreate": "",
                        "DefOnInput": "_income_nom_input",
                        "onlineOnAfterStart": false
                    },
                    {
                        "Name": "Ввод количества",
                        "type": "Operation",
                        "Elements": [
                            {
                                "Value": "",
                                "Variable": "",
                                "type": "LinearLayout",
                                "weight": "0",
                                "height": "match_parent",
                                "width": "match_parent",
                                "orientation": "vertical",
                                "Elements": [
                                    {
                                        "type": "TextView",
                                        "height": "wrap_content",
                                        "width": "match_parent",
                                        "weight": "0",
                                        "Value": "Укажите количество",
                                        "Variable": "",
                                        "BackgroundColor": "#3B5958",
                                        "TextSize": "20",
                                        "TextColor": "#FFFFFF",
                                        "TextBold": true
                                    },
                                    {
                                        "type": "TextView",
                                        "height": "wrap_content",
                                        "width": "match_parent",
                                        "weight": "0",
                                        "Value": "Ячейка",
                                        "Variable": "",
                                        "TextSize": "20"
                                    },
                                    {
                                        "type": "TextView",
                                        "height": "wrap_content",
                                        "width": "match_parent",
                                        "weight": "0",
                                        "Value": "@cell",
                                        "Variable": "",
                                        "TextBold": true,
                                        "TextSize": "22"
                                    },
                                    {
                                        "type": "TextView",
                                        "height": "wrap_content",
                                        "width": "match_parent",
                                        "weight": "0",
                                        "Value": "Товар",
                                        "Variable": "",
                                        "TextSize": "20"
                                    },
                                    {
                                        "type": "TextView",
                                        "height": "wrap_content",
                                        "width": "match_parent",
                                        "weight": "0",
                                        "Value": "@nom",
                                        "Variable": "",
                                        "TextBold": true,
                                        "TextSize": "22"
                                    },
                                    {
                                        "type": "LinearLayout",
                                        "height": "wrap_content",
                                        "width": "match_parent",
                                        "weight": "0",
                                        "Value": "",
                                        "Variable": "",
                                        "orientation": "horizontal",
                                        "Elements": [
                                            {
                                                "type": "TextView",
                                                "height": "wrap_content",
                                                "width": "match_parent",
                                                "weight": "1",
                                                "Value": "Кол-во",
                                                "Variable": ""
                                            },
                                            {
                                                "type": "EditTextNumeric",
                                                "height": "wrap_content",
                                                "width": "match_parent",
                                                "weight": "1",
                                                "Value": "@qty",
                                                "Variable": "qty",
                                                "BackgroundColor": "#F7ECEB",
                                                "TextBold": true
                                            }
                                        ]
                                    }
                                ]
                            }
                        ],
                        "Timer": false,
                        "hideToolBarScreen": false,
                        "noScroll": false,
                        "handleKeyUp": false,
                        "hideBottomBarScreen": true,
                        "onlineOnStart": false,
                        "onlineOnInput": false,
                        "DefOnInput": "_outcome_qty_input",
                        "onlineOnAfterStart": false
                    }
                ],
                "PlanFactHeader": "Состав"
            },
            {
                "ProcessName": "Остатки",
                "type": "Process",
                "Operations": [
                    {
                        "Name": "Остатки",
                        "type": "Operation",
                        "Elements": [
                            {
                                "Value": "",
                                "Variable": "",
                                "type": "LinearLayout",
                                "weight": "0",
                                "height": "match_parent",
                                "width": "match_parent",
                                "orientation": "vertical",
                                "Elements": [
                                    {
                                        "type": "TextView",
                                        "height": "wrap_content",
                                        "width": "match_parent",
                                        "weight": "0",
                                        "Value": "Сканируйте ячейку или товар чтобы посмотреть остатки",
                                        "Variable": "",
                                        "TextSize": "20",
                                        "BackgroundColor": "#3B5958",
                                        "TextColor": "#FFFFFF"
                                    },
                                    {
                                        "type": "TableLayout",
                                        "height": "match_parent",
                                        "width": "match_parent",
                                        "weight": "0",
                                        "Value": "@table",
                                        "Variable": ""
                                    }
                                ]
                            },
                            {
                                "Value": "",
                                "Variable": "barcode",
                                "type": "barcode"
                            }
                        ],
                        "Timer": false,
                        "hideToolBarScreen": false,
                        "noScroll": false,
                        "handleKeyUp": false,
                        "hideBottomBarScreen": true,
                        "onlineOnStart": false,
                        "onlineOnInput": false,
                        "DefOnCreate": "_stock_on_create",
                        "DefOnInput": "_stock_input",
                        "noConfirmation": true,
                        "send_when_opened": true,
                        "onlineOnAfterStart": false
                    },
                    {
                        "Name": "Остатки по объекту",
                        "type": "Operation",
                        "Elements": [
                            {
                                "Value": "",
                                "Variable": "",
                                "type": "LinearLayout",
                                "weight": "0",
                                "height": "match_parent",
                                "width": "match_parent",
                                "orientation": "vertical",
                                "Elements": [
                                    {
                                        "type": "TextView",
                                        "height": "wrap_content",
                                        "width": "match_parent",
                                        "weight": "0",
                                        "Value": "Объект",
                                        "Variable": "",
                                        "TextSize": "20"
                                    },
                                    {
                                        "type": "TextView",
                                        "height": "wrap_content",
                                        "width": "match_parent",
                                        "weight": "0",
                                        "Value": "@object",
                                        "Variable": "",
                                        "TextBold": true,
                                        "TextSize": "22"
                                    },
                                    {
                                        "type": "TableLayout",
                                        "height": "match_parent",
                                        "width": "match_parent",
                                        "weight": "0",
                                        "Value": "@table_object",
                                        "Variable": ""
                                    }
                                ]
                            }
                        ],
                        "Timer": false,
                        "hideToolBarScreen": false,
                        "noScroll": false,
                        "handleKeyUp": false,
                        "hideBottomBarScreen": true,
                        "onlineOnStart": false,
                        "onlineOnInput": false,
                        "noConfirmation": true,
                        "DefOnInput": "_stock_object_input",
                        "onlineOnAfterStart": false
                    }
                ]
            },
            {
                "ProcessName": "Инвентаризация Active CV",
                "type": "Process",
                "Operations": [
                    {
                        "Name": "Документы",
                        "type": "Operation",
                        "Elements": [
                            {
                                "Value": "",
                                "Variable": "",
                                "type": "LinearLayout",
                                "weight": "0",
                                "height": "match_parent",
                                "width": "match_parent",
                                "orientation": "vertical",
                                "Elements": [
                                    {
                                        "type": "TextView",
                                        "height": "wrap_content",
                                        "width": "match_parent",
                                        "weight": "0",
                                        "Value": "Создайте новый или продолжите существующий документ",
                                        "Variable": "",
                                        "BackgroundColor": "#3B5958",
                                        "TextSize": "20",
                                        "TextColor": "#FFFFFF",
                                        "TextBold": true
                                    },
                                    {
                                        "type": "Button",
                                        "height": "wrap_content",
                                        "width": "match_parent",
                                        "weight": "0",
                                        "Value": "Создать инвентаризацию",
                                        "Variable": "btn_new",
                                        "BackgroundColor": "#3CB371"
                                    },
                                    {
                                        "type": "CardsLayout",
                                        "height": "wrap_content",
                                        "width": "match_parent",
                                        "weight": "0",
                                        "Value": "@inventory",
                                        "Variable": "doc"
                                    }
                                ]
                            }
                        ],
                        "Timer": false,
                        "hideToolBarScreen": false,
                        "noScroll": false,
                        "handleKeyUp": false,
                        "hideBottomBarScreen": true,
                        "onlineOnStart": false,
                        "onlineOnInput": false,
                        "DefOnCreate": "_inventory_on_start",
                        "DefOnInput": "_inventory_input",
                        "send_when_opened": true,
                        "onlineOnAfterStart": false
                    },
                    {
                        "Name": "Новая инвентаризация",
                        "type": "Operation",
                        "Elements": [
                            {
                                "Value": "",
                                "Variable": "",
                                "type": "LinearLayout",
                                "weight": "0",
                                "height": "match_parent",
                                "width": "match_parent",
                                "orientation": "vertical",
                                "Elements": [
                                    {
                                        "type": "TextView",
                                        "height": "wrap_content",
                                        "width": "match_parent",
                                        "weight": "0",
                                        "Value": "Комментарий/Название",
                                        "Variable": ""
                                    },
                                    {
                                        "type": "EditTextText",
                                        "height": "wrap_content",
                                        "width": "match_parent",
                                        "weight": "0",
                                        "Value": "",
                                        "Variable": "name"
                                    }
                                ]
                            }
                        ],
                        "Timer": false,
                        "hideToolBarScreen": false,
                        "noScroll": false,
                        "handleKeyUp": false,
                        "hideBottomBarScreen": true,
                        "onlineOnStart": false,
                        "onlineOnInput": false,
                        "DefOnInput": "_newinv_input",
                        "onlineOnAfterStart": false
                    },
                    {
                        "Name": "ДиалогВводКоличества",
                        "type": "Operation",
                        "Elements": [
                            {
                                "Value": "",
                                "Variable": "",
                                "type": "LinearLayout",
                                "weight": "0",
                                "height": "match_parent",
                                "width": "match_parent",
                                "orientation": "vertical",
                                "Elements": [
                                    {
                                        "type": "TextView",
                                        "height": "wrap_content",
                                        "width": "wrap_content",
                                        "weight": "0",
                                        "Value": "@nom",
                                        "Variable": ""
                                    },
                                    {
                                        "type": "LinearLayout",
                                        "height": "wrap_content",
                                        "width": "match_parent",
                                        "weight": "0",
                                        "Value": "",
                                        "Variable": "",
                                        "orientation": "horizontal",
                                        "Elements": [
                                            {
                                                "type": "TextView",
                                                "height": "wrap_content",
                                                "width": "match_parent",
                                                "weight": "1",
                                                "Value": "Кол.:",
                                                "Variable": ""
                                            },
                                            {
                                                "type": "EditTextNumeric",
                                                "height": "wrap_content",
                                                "width": "match_parent",
                                                "weight": "1",
                                                "Value": "",
                                                "Variable": "qty"
                                            }
                                        ]
                                    }
                                ]
                            }
                        ],
                        "Timer": false,
                        "hideToolBarScreen": false,
                        "noScroll": false,
                        "handleKeyUp": false,
                        "hideBottomBarScreen": true,
                        "onlineOnStart": false,
                        "onlineOnInput": false,
                        "onlineOnAfterStart": false
                    },
                    {
                        "Name": "Инвентаризация Результаты",
                        "type": "Operation",
                        "Elements": [
                            {
                                "Value": "",
                                "Variable": "",
                                "type": "LinearLayout",
                                "weight": "0",
                                "height": "match_parent",
                                "width": "match_parent",
                                "orientation": "vertical",
                                "Elements": [
                                    {
                                        "type": "TextView",
                                        "height": "wrap_content",
                                        "width": "match_parent",
                                        "weight": "0",
                                        "Value": "@inv",
                                        "Variable": "",
                                        "TextSize": "18"
                                    },
                                    {
                                        "type": "Button",
                                        "height": "wrap_content",
                                        "width": "match_parent",
                                        "weight": "0",
                                        "Value": "Начать сканирование",
                                        "Variable": "btn_run"
                                    },
                                    {
                                        "type": "TableLayout",
                                        "height": "match_parent",
                                        "width": "match_parent",
                                        "weight": "0",
                                        "Value": "@table",
                                        "Variable": ""
                                    }
                                ],
                                "BackgroundColor": "",
                                "StrokeWidth": "",
                                "Padding": ""
                            }
                        ],
                        "Timer": false,
                        "hideToolBarScreen": false,
                        "noScroll": false,
                        "handleKeyUp": false,
                        "hideBottomBarScreen": true,
                        "onlineOnStart": false,
                        "onlineOnInput": false,
                        "DefOnCreate": "_invres_on_start",
                        "DefOnInput": "_invres_input",
                        "send_when_opened": true,
                        "onlineOnAfterStart": false
                    }
                ],
                "hidden": false
            },
            {
                "CVOperationName": "ИнвCV",
                "type": "CVOperation",
                "CVFrames": [
                    {
                        "Name": "Выбор ячейки",
                        "type": "CVFrame",
                        "CVOnline": false,
                        "CVDetector": "Barcode",
                        "CVResolution": "HD720",
                        "CVMode": "green_and_grey",
                        "CVActionButtons": "",
                        "CVAction": "Сканируйте Штрихкод ячейки",
                        "CVInfo": "@inv",
                        "CVCameraDevice": "Back",
                        "CVDetectorMode": "train",
                        "CVFrameDefOnCreate": "_invcv_cell_on_start",
                        "CVFrameDefOnNewObject": "_invcv_cell_on_new_object",
                        "VisionSettings": "{\n    \"name\": \"Распознавание артикула\",\n    \"TypeRecognition\": \"Распознавание текста\",\n    \"mesure_qty\": \"1\",\n    \"min_freq\": \"1\",\n    \"min_length\": \"3\",\n    \"max_length\": \"15\",\n    \"query\": \"c2VsZWN0ICogZnJvbSBTV19Hb29kcyB3aGVyZSBwcm9kdWN0X251bWJlciBsaWtlICA/\",\n    \"ReplaceO\": true,\n    \"ToUpcase\": false,\n    \"control_field\": \"product_number\",\n    \"result_field\": \"id\",\n    \"cursor\": [\n        {\n            \"title\": \"id\",\n            \"var\": \"_nom_id\",\n            \"field\": \"id\"\n        }\n    ],\n    \"result_var\": \"_nom_id\"\n}",
                        "RecognitionTemplate": "Распознавание артикула"
                    },
                    {
                        "Name": "Товары ячейки",
                        "type": "CVFrame",
                        "CVOnline": false,
                        "CVDetector": "Barcode",
                        "CVResolution": "HD720",
                        "CVMode": "list_and_grey",
                        "CVActionButtons": "К ЯЧЕЙКЕ",
                        "CVAction": "Сканируйте штрихкоды товара",
                        "CVInfo": "@inv",
                        "CVCameraDevice": "Back",
                        "CVDetectorMode": "train",
                        "CVFrameDefOnNewObject": "_invcv_goods_on_new_object",
                        "CVFrameDefAction": "_invcv_goods_action",
                        "VisionSettings": "{\n    \"name\": \"Распознавание артикула\",\n    \"TypeRecognition\": \"Распознавание текста\",\n    \"mesure_qty\": \"1\",\n    \"min_freq\": \"1\",\n    \"min_length\": \"3\",\n    \"max_length\": \"15\",\n    \"query\": \"c2VsZWN0ICogZnJvbSBTV19Hb29kcyB3aGVyZSBwcm9kdWN0X251bWJlciBsaWtlICA/\",\n    \"ReplaceO\": true,\n    \"ToUpcase\": false,\n    \"control_field\": \"product_number\",\n    \"result_field\": \"id\",\n    \"cursor\": [\n        {\n            \"title\": \"id\",\n            \"var\": \"_nom_id\",\n            \"field\": \"id\"\n        }\n    ],\n    \"result_var\": \"_nom_id\"\n}",
                        "RecognitionTemplate": "Распознавание артикула",
                        "CVRecognitionSettings": "{\n    \"name\": \"Распознавание артикула\",\n    \"TypeRecognition\": \"Распознавание текста\",\n    \"mesure_qty\": \"1\",\n    \"min_freq\": \"1\",\n    \"min_length\": \"3\",\n    \"max_length\": \"15\",\n    \"query\": \"c2VsZWN0ICogZnJvbSBTV19Hb29kcyB3aGVyZSBwcm9kdWN0X251bWJlciBsaWtlICA/\",\n    \"ReplaceO\": true,\n    \"ToUpcase\": false,\n    \"control_field\": \"product_number\",\n    \"result_field\": \"id\",\n    \"cursor\": [\n        {\n            \"title\": \"id\",\n            \"var\": \"_nom_id\",\n            \"field\": \"id\"\n        }\n    ],\n    \"result_var\": \"_nom_id\"\n}"
                    }
                ],
                "hidden": true
            }
        ],
        "ConfigurationSettings": {
            "uid": "f164e78e7f8f480da045102a42812cdb"
        },
        "ConfigurationTags": "Py,off-line,ActiveCV®",
        "RunPython": true,
        "PyHandlers": "aW1wb3J0IG9zCmltcG9ydCBzcWxpdGUzICAjIFRoaXMgaXMgYW5vdGhlciB3YXkgdG8gd29yayB3aXRoIFNRTApmcm9tIHNxbGl0ZTMuZGJhcGkyIGltcG9ydCBFcnJvcgpmcm9tIGRhdGV0aW1lIGltcG9ydCBkYXRldGltZQpmcm9tIFBJTCBpbXBvcnQgSW1hZ2UKZnJvbSBmbGFzayBpbXBvcnQgRmxhc2sKZnJvbSBmbGFzayBpbXBvcnQgcmVxdWVzdAppbXBvcnQganNvbgpmcm9tIHBvbnkub3JtIGltcG9ydCBzZWxlY3QsIGRiX3Nlc3Npb24sIGNvbW1pdAppbXBvcnQgdWlfZ2xvYmFsCgoKYXBwID0gRmxhc2soX19uYW1lX18pCgoKIyAtQkVHSU4gQ1VTVE9NIEhBTkRMRVJTCgpEQl9QQVRIX2RlYnVnID0gJ2RiLmRiJyAgICAjREJfUEFUSCA9ICdkYi5kYicgI25ldzIg0LfQsNC80LXQvdCwINC/0LXRgNC10LzQtdC90L3QvtC5Cgp1bml0X2lkID0gLTEKX25vbV9pZCA9IC0xCmNlbGxfaWQgPSAtMQpjZWxscyA9IHt9CmNlbGxpZCA9IE5vbmUKZm91bmQgPSBbXQpncmVlbl9zaXplID0gMAp5ZWxsb3dfc2l6ZSA9IDAKCgojZnVuYyA9IG1ldGhvZC5yZXBsYWNlKCdfJywgJycsIDEpCgpkZWYgaW5pdF9vbl9zdGFydCgpOiNoYXNoTWFwLCBfZmlsZXM9Tm9uZSwgX2RhdGE9Tm9uZSk6CiAgICB1aV9nbG9iYWwuaW5pdCgpCiAgICByZXR1cm4gaGFzaE1hcAoKCmRlZiBtZW51X2lucHV0KGhhc2hNYXAsIF9maWxlcz1Ob25lLCBfZGF0YT1Ob25lKToKICAgIGlmIGhhc2hNYXAuZ2V0KCJsaXN0ZW5lciIpID09ICJtZW51IjoKICAgICAgICBpZiBoYXNoTWFwLmdldCgibWVudSIpID09ICLQlNC+0LHQsNCy0LjRgtGMINGC0L7QstCw0YAiOgogICAgICAgICAgICBoYXNoTWFwLnB1dCgiU2hvd1NjcmVlbiIsICLQlNC+0LHQsNCy0LjRgtGMINGC0L7QstCw0YAiKQogICAgICAgIGlmIGhhc2hNYXAuZ2V0KCJtZW51IikgPT0gItCU0L7QsdCw0LLQuNGC0Ywg0Y/Rh9C10LnQutGDIjoKICAgICAgICAgICAgaGFzaE1hcC5wdXQoIlNob3dTY3JlZW4iLCAi0JTQvtCx0LDQstC40YLRjCDRj9GH0LXQudC60YMiKQogICAgICAgIGlmIGhhc2hNYXAuZ2V0KCJtZW51IikgPT0gItCU0L7QsdCw0LLQuNGC0Ywg0LPRgNGD0L/Qv9GDINGC0L7QstCw0YDQvtCyIjoKICAgICAgICAgICAgaGFzaE1hcC5wdXQoIlNob3dTY3JlZW4iLCAi0JTQvtCx0LDQstC40YLRjCDQs9GA0YPQv9C/0YMg0YLQvtCy0LDRgNC+0LIiKQoKICAgICAgICBlbGlmIGhhc2hNYXAuZ2V0KCJtZW51IikgPT0gItCU0L7QsdCw0LLQuNGC0Ywg0LXQtNC40L3QuNGG0YMg0LjQt9C80LXRgNC10L3QuNGPIjoKICAgICAgICAgICAgaGFzaE1hcC5wdXQoIlNob3dTY3JlZW4iLCAi0JTQvtCx0LDQstC40YLRjCDQtdC00LjQvdC40YbRgyDQuNC30LzQtdGA0LXQvdC40Y8iKQogICAgZWxpZiBoYXNoTWFwLmdldCgibGlzdGVuZXIiKSA9PSAnT05fQkFDS19QUkVTU0VEJzoKICAgICAgICBoYXNoTWFwLnB1dCgiRmluaXNoUHJvY2VzcyIsICIiKQogICAgcmV0dXJuIGhhc2hNYXAKCgpkZWYgbWVudV9vbl9zdGFydChoYXNoTWFwLCBfZmlsZXM9Tm9uZSwgX2RhdGE9Tm9uZSk6CiAgICAjIGhhc2hNYXAucHV0KCJnZXRmaWxlcyIsIiIpCiAgICAjIGhhc2hNYXAucHV0KCJ0b2FzdCIsInRlc3QxIikKICAgIHJldHVybiBoYXNoTWFwCgoKIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS3QtNC+0L8g0YTRg9C90LrRhtC40LgKZGVmIGdldF90YWJsZV9ieV9jZWxsKGlkKToKICAgIHRhYmxlID0gewogICAgICAgICJ0eXBlIjogInRhYmxlIiwKICAgICAgICAidGV4dHNpemUiOiAiMTciLAoKICAgICAgICAiY29sdW1ucyI6IFsKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgIm5hbWUiOiAiY2VsbCIsCiAgICAgICAgICAgICAgICAiaGVhZGVyIjogItCv0YfQtdC50LrQsCIsCiAgICAgICAgICAgICAgICAid2VpZ2h0IjogIjEiCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICJuYW1lIjogIm5vbSIsCiAgICAgICAgICAgICAgICAiaGVhZGVyIjogItCi0L7QstCw0YAiLAogICAgICAgICAgICAgICAgIndlaWdodCI6ICIyIgogICAgICAgICAgICB9LAogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAibmFtZSI6ICJxdHkiLAogICAgICAgICAgICAgICAgImhlYWRlciI6ICLQntGB0YLQsNGC0L7QuiIsCiAgICAgICAgICAgICAgICAid2VpZ2h0IjogIjEiCiAgICAgICAgICAgIH0KICAgICAgICBdCiAgICB9CgogICAgY29ubiA9IE5vbmUKICAgIHRyeToKICAgICAgICBjb25uID0gc3FsaXRlMy5jb25uZWN0KERCX1BBVEhfZGVidWcpCiAgICBleGNlcHQgRXJyb3IgYXMgZToKICAgICAgICByYWlzZSBWYWx1ZUVycm9yKCfQndC10YIg0YHQvtC10LTQuNC90LXQvdC40Y8g0YEg0LHQsNC30L7QuSEnKQoKICAgIGN1cnNvciA9IGNvbm4uY3Vyc29yKCkKICAgIGN1cnNvci5leGVjdXRlKAogICAgICAgICJTRUxFQ1QgU1dfQ2VsbHMubmFtZSBhcyBjZWxsLFNXX0dvb2RzLm5hbWUgYXMgbm9tLCBpZm51bGwoc3VtKHF0eSksMCkgYXMgcXR5IEZST00gU1dfQWNjb3VudCBMRUZUIEpPSU4gU1dfR29vZHMgT04gU1dfQWNjb3VudC5za3U9U1dfR29vZHMuaWQgTEVGVCBKT0lOIFNXX0NlbGxzIE9OIFNXX0FjY291bnQuY2VsbD1TV19DZWxscy5pZCBXSEVSRSBTV19BY2NvdW50LmNlbGwgPSAiICsgc3RyKAogICAgICAgICAgICBpZCkgKyAiIEdST1VQIEJZIFNXX0dvb2RzLm5hbWUgLFNXX0NlbGxzLm5hbWUgSEFWSU5HIGlmbnVsbChzdW0ocXR5KSwwKTw+MCIpCgogICAgcmVzdWx0cyA9IGN1cnNvci5mZXRjaGFsbCgpCgogICAgcm93cyA9IFtdCiAgICBmb3IgcmVjb3JkIGluIHJlc3VsdHM6CiAgICAgICAgcm93cy5hcHBlbmQoeyJjZWxsIjogcmVjb3JkWzBdLCAibm9tIjogcmVjb3JkWzFdLCAicXR5IjogcmVjb3JkWzJdfSkKCiAgICB0YWJsZVsncm93cyddID0gcm93cwoKICAgIHJldHVybiBqc29uLmR1bXBzKHRhYmxlKQoKCgoKCiMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0t0JTQvtCx0LDQstC40YLRjCDQtdC00LjQvdC40YbRgyDQuNC30LzQtdGA0LXQvdC40Y8KZGVmIHVuaXRzX29uX3N0YXJ0KGhhc2hNYXAsIF9maWxlcz1Ob25lLCBfZGF0YT1Ob25lKToKICAgIHRhYmxlID0gewogICAgICAgICJ0eXBlIjogInRhYmxlIiwKICAgICAgICAidGV4dHNpemUiOiAiMjAiLAoKICAgICAgICAiY29sdW1ucyI6IFsKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgIm5hbWUiOiAibmFtZSIsCiAgICAgICAgICAgICAgICAiaGVhZGVyIjogItCd0LDQuNC80LXQvdC+0LLQsNC90LjQtSIsCiAgICAgICAgICAgICAgICAid2VpZ2h0IjogIjEiCiAgICAgICAgICAgIH0KICAgICAgICBdCiAgICB9CiAgICAjIHdvcmsgd2l0aCBTUUwgdmlhIFBvbnkgT1JNCiAgICB3aXRoIGRiX3Nlc3Npb246IyDQl9Cw0LzQtdC90LjQuyEhIQogICAgICAgIHF1ZXJ5ID0gc2VsZWN0KGMgZm9yIGMgaW4gdWlfZ2xvYmFsLlNXX1VuaXRzKQogICAgICAgIHJvd3MgPSBbXQogICAgICAgIGZvciByZWNvcmQgaW4gcXVlcnk6CiAgICAgICAgICAgIHJvd3MuYXBwZW5kKHsibmFtZSI6IHJlY29yZC5uYW1lLCAiaWQiOiByZWNvcmQuaWR9KQoKICAgIHRhYmxlWydyb3dzJ10gPSByb3dzCiAgICBoYXNoTWFwLnB1dCgibGlzdCIsIGpzb24uZHVtcHModGFibGUpKQoKICAgIHJldHVybiBoYXNoTWFwCgoKZGVmIHVuaXRzX2lucHV0KGhhc2hNYXAsIF9maWxlcz1Ob25lLCBfZGF0YT1Ob25lKToKICAgIGdsb2JhbCB1bml0X2lkCgogICAgaWYgaGFzaE1hcC5nZXQoImxpc3RlbmVyIikgPT0gJ09OX0JBQ0tfUFJFU1NFRCc6CiAgICAgICAgaGFzaE1hcC5wdXQoIlNob3dTY3JlZW4iLCAi0JzQtdC90Y4g0J3QodCYIikKCiAgICBlbGlmIGhhc2hNYXAuZ2V0KCJsaXN0ZW5lciIpID09ICJidG5fYWRkIjoKICAgICAgICBoYXNoTWFwLnB1dCgibmFtZSIsICIiKQogICAgICAgIHVuaXRfaWQgPSAtMQogICAgICAgIGhhc2hNYXAucHV0KCJTaG93RGlhbG9nIiwgItCU0LjQsNC70L7Qs9CV0LTQuNC90LjRhtGLIikKICAgICAgICBoYXNoTWFwLnB1dCgiU2hvd0RpYWxvZ1N0eWxlIiwganNvbi5kdW1wcyh7InRpdGxlIjogItCU0L7QsdCw0LLQu9C10L3QuNC1INC30LDQv9C40YHQuCIsICJ5ZXMiOiAi0KHQvtGF0YDQsNC90LjRgtGMIiwgIm5vIjogItCe0YLQvNC10L3QsCJ9KSkKCiAgICBlbGlmIGhhc2hNYXAuZ2V0KCJsaXN0ZW5lciIpID09ICJUYWJsZUNsaWNrIjoKCiAgICAgICAganJlY29yZCA9IGpzb24ubG9hZHMoaGFzaE1hcC5nZXQoInNlbGVjdGVkX2xpbmUiKSkKICAgICAgICAjIGhhc2hNYXAucHV0KCJ0b2FzdCIsc3RyKGpyZWNvcmRbJ2lkJ10pKQogICAgICAgIHVuaXRfaWQgPSBqcmVjb3JkWydpZCddCiAgICAgICAgaGFzaE1hcC5wdXQoIm5hbWUiLCBqcmVjb3JkWyduYW1lJ10pCgogICAgICAgIGhhc2hNYXAucHV0KCJTaG93RGlhbG9nIiwgItCU0LjQsNC70L7Qs9CV0LTQuNC90LjRhtGLIikKICAgICAgICBoYXNoTWFwLnB1dCgiU2hvd0RpYWxvZ1N0eWxlIiwganNvbi5kdW1wcyh7InRpdGxlIjogItCU0L7QsdCw0LLQu9C10L3QuNC1INC30LDQv9C40YHQuCIsICJ5ZXMiOiAi0KHQvtGF0YDQsNC90LjRgtGMIiwgIm5vIjogItCe0YLQvNC10L3QsCJ9KSkKICAgIGVsaWYgaGFzaE1hcC5nZXQoImV2ZW50IikgPT0gIm9uUmVzdWx0UG9zaXRpdmUiOgogICAgICAgICMgaGFzaE1hcC5wdXQoInRvYXN0IixzdHIodW5pdF9pZCkpCiAgICAgICAgaWYgdW5pdF9pZCA8IDA6CiAgICAgICAgICAgIHdpdGggZGJfc2Vzc2lvbjoKICAgICAgICAgICAgICAgIHIgPSB1aV9nbG9iYWwuU1dfVW5pdHMobmFtZT1oYXNoTWFwLmdldCgnbmFtZScpKQogICAgICAgICAgICAgICAgY29tbWl0KCkKICAgICAgICBlbHNlOgogICAgICAgICAgICB3aXRoIGRiX3Nlc3Npb246CiAgICAgICAgICAgICAgICBpZiBoYXNoTWFwLmdldCgnbmFtZScpID09ICIiOiAgIyDRg9C00LDQu9C10L3QuNC1CiAgICAgICAgICAgICAgICAgICAgciA9IHVpX2dsb2JhbC5TV19Vbml0c1t1bml0X2lkXQogICAgICAgICAgICAgICAgICAgIHIuZGVsZXRlKCkKICAgICAgICAgICAgICAgIGVsc2U6ICAjINGA0LXQtNCw0LrRgtC40YDQvtCy0LDQvdC40LUKICAgICAgICAgICAgICAgICAgICByID0gdWlfZ2xvYmFsLlNXX1VuaXRzW3VuaXRfaWRdCiAgICAgICAgICAgICAgICAgICAgci5uYW1lID0gaGFzaE1hcC5nZXQoJ25hbWUnKQoKICAgICAgICAgICAgICAgIGNvbW1pdCgpCgogICAgcmV0dXJuIGhhc2hNYXAKCgojIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLdCU0L7QsdCw0LLQuNGC0Ywg0LPRgNGD0L/Qv9GDINGC0L7QstCw0YDQvtCyCmRlZiBncm91cHNfb25fc3RhcnQoaGFzaE1hcCwgX2ZpbGVzPU5vbmUsIF9kYXRhPU5vbmUpOgogICAgdGFibGUgPSB7CiAgICAgICAgInR5cGUiOiAidGFibGUiLAogICAgICAgICJ0ZXh0c2l6ZSI6ICIyMCIsCgogICAgICAgICJjb2x1bW5zIjogWwogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAibmFtZSI6ICJuYW1lIiwKICAgICAgICAgICAgICAgICJoZWFkZXIiOiAi0J3QsNC40LzQtdC90L7QstCw0L3QuNC1IiwKICAgICAgICAgICAgICAgICJ3ZWlnaHQiOiAiMSIKICAgICAgICAgICAgfQogICAgICAgIF0KICAgIH0KICAgICMgd29yayB3aXRoIFNRTCB2aWEgUG9ueSBPUk0KICAgIHdpdGggZGJfc2Vzc2lvbjojINCX0LDQvNC10L3QuNC7ISEhCiAgICAgICAgcXVlcnkgPSBzZWxlY3QoYyBmb3IgYyBpbiB1aV9nbG9iYWwuU1dfR3JvdXBzKQogICAgICAgIHJvd3MgPSBbXQogICAgICAgIGZvciByZWNvcmQgaW4gcXVlcnk6CiAgICAgICAgICAgIHJvd3MuYXBwZW5kKHsibmFtZSI6IHJlY29yZC5uYW1lLCAiaWQiOiByZWNvcmQuaWR9KQoKICAgIHRhYmxlWydyb3dzJ10gPSByb3dzCiAgICBoYXNoTWFwLnB1dCgibGlzdCIsIGpzb24uZHVtcHModGFibGUpKQoKICAgIHJldHVybiBoYXNoTWFwCgoKZGVmIGdyb3Vwc19pbnB1dChoYXNoTWFwLCBfZmlsZXM9Tm9uZSwgX2RhdGE9Tm9uZSk6CiAgICBnbG9iYWwgdW5pdF9pZAoKICAgIGlmIGhhc2hNYXAuZ2V0KCJsaXN0ZW5lciIpID09ICdPTl9CQUNLX1BSRVNTRUQnOgogICAgICAgIGhhc2hNYXAucHV0KCJTaG93U2NyZWVuIiwgItCc0LXQvdGOINCd0KHQmCIpCiAgICBlbGlmIGhhc2hNYXAuZ2V0KCJsaXN0ZW5lciIpID09ICJidG5fYWRkIjoKICAgICAgICBoYXNoTWFwLnB1dCgibmFtZSIsICIiKQogICAgICAgIHVuaXRfaWQgPSAtMQogICAgICAgIGhhc2hNYXAucHV0KCJTaG93RGlhbG9nIiwgItCU0LjQsNC70L7Qs9CT0YDRg9C/0L/RiyIpCiAgICAgICAgaGFzaE1hcC5wdXQoIlNob3dEaWFsb2dTdHlsZSIsIGpzb24uZHVtcHMoeyJ0aXRsZSI6ICLQlNC+0LHQsNCy0LvQtdC90LjQtSDQt9Cw0L/QuNGB0LgiLCAieWVzIjogItCh0L7RhdGA0LDQvdC40YLRjCIsICJubyI6ICLQntGC0LzQtdC90LAifSkpCgogICAgZWxpZiBoYXNoTWFwLmdldCgibGlzdGVuZXIiKSA9PSAiVGFibGVDbGljayI6CgogICAgICAgIGpyZWNvcmQgPSBqc29uLmxvYWRzKGhhc2hNYXAuZ2V0KCJzZWxlY3RlZF9saW5lIikpCiAgICAgICAgIyBoYXNoTWFwLnB1dCgidG9hc3QiLHN0cihqcmVjb3JkWydpZCddKSkKICAgICAgICB1bml0X2lkID0ganJlY29yZFsnaWQnXQogICAgICAgIGhhc2hNYXAucHV0KCJuYW1lIiwganJlY29yZFsnbmFtZSddKQoKICAgICAgICBoYXNoTWFwLnB1dCgiU2hvd0RpYWxvZyIsICLQlNC40LDQu9C+0LPQk9GA0YPQv9C/0YsiKQogICAgICAgIGhhc2hNYXAucHV0KCJTaG93RGlhbG9nU3R5bGUiLCBqc29uLmR1bXBzKHsidGl0bGUiOiAi0JTQvtCx0LDQstC70LXQvdC40LUg0LfQsNC/0LjRgdC4IiwgInllcyI6ICLQodC+0YXRgNCw0L3QuNGC0YwiLCAibm8iOiAi0J7RgtC80LXQvdCwIn0pKQogICAgZWxpZiBoYXNoTWFwLmdldCgiZXZlbnQiKSA9PSAib25SZXN1bHRQb3NpdGl2ZSI6CiAgICAgICAgIyBoYXNoTWFwLnB1dCgidG9hc3QiLHN0cih1bml0X2lkKSkKICAgICAgICBpZiB1bml0X2lkIDwgMDoKICAgICAgICAgICAgd2l0aCBkYl9zZXNzaW9uOgogICAgICAgICAgICAgICAgciA9IHVpX2dsb2JhbC5TV19Hcm91cHMobmFtZT1oYXNoTWFwLmdldCgnbmFtZScpKQogICAgICAgICAgICAgICAgY29tbWl0KCkKICAgICAgICBlbHNlOgogICAgICAgICAgICB3aXRoIGRiX3Nlc3Npb246CiAgICAgICAgICAgICAgICBpZiBoYXNoTWFwLmdldCgnbmFtZScpID09ICIiOiAgIyDRg9C00LDQu9C10L3QuNC1CiAgICAgICAgICAgICAgICAgICAgciA9IHVpX2dsb2JhbC5TV19Hcm91cHNbdW5pdF9pZF0KICAgICAgICAgICAgICAgICAgICByLmRlbGV0ZSgpCiAgICAgICAgICAgICAgICBlbHNlOiAgIyDRgNC10LTQsNC60YLQuNGA0L7QstCw0L3QuNC1CiAgICAgICAgICAgICAgICAgICAgciA9IHVpX2dsb2JhbC5TV19Hcm91cHNbdW5pdF9pZF0KICAgICAgICAgICAgICAgICAgICByLm5hbWUgPSBoYXNoTWFwLmdldCgnbmFtZScpCgogICAgICAgICAgICAgICAgY29tbWl0KCkKCiAgICByZXR1cm4gaGFzaE1hcAoKCiMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS3QlNC+0LHQsNCy0LjRgtGMINGC0L7QstCw0YAKZGVmIGdvb2RzX29uX3N0YXJ0KGhhc2hNYXAsIF9maWxlcz1Ob25lLCBfZGF0YT1Ob25lKToKICAgIGhhc2hNYXAucHV0KCJtbV9sb2NhbCIsICIiKQogICAgaGFzaE1hcC5wdXQoIm1tX2NvbXByZXNzaW9uIiwgIjcwIikKICAgIGhhc2hNYXAucHV0KCJtbV9zaXplIiwgIjY1IikKCiAgICBsaXN0ID0geyJjdXN0b21jYXJkcyI6IHsKCiAgICAgICAgImxheW91dCI6IHsKICAgICAgICAgICAgInR5cGUiOiAiTGluZWFyTGF5b3V0IiwKICAgICAgICAgICAgIm9yaWVudGF0aW9uIjogInZlcnRpY2FsIiwKICAgICAgICAgICAgImhlaWdodCI6ICJtYXRjaF9wYXJlbnQiLAogICAgICAgICAgICAid2lkdGgiOiAibWF0Y2hfcGFyZW50IiwKICAgICAgICAgICAgIndlaWdodCI6ICIwIiwKICAgICAgICAgICAgIkVsZW1lbnRzIjogWwogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICJ0eXBlIjogIkxpbmVhckxheW91dCIsCiAgICAgICAgICAgICAgICAgICAgIm9yaWVudGF0aW9uIjogImhvcml6b250YWwiLAogICAgICAgICAgICAgICAgICAgICJoZWlnaHQiOiAid3JhcF9jb250ZW50IiwKICAgICAgICAgICAgICAgICAgICAid2lkdGgiOiAibWF0Y2hfcGFyZW50IiwKICAgICAgICAgICAgICAgICAgICAid2VpZ2h0IjogIjAiLAogICAgICAgICAgICAgICAgICAgICJFbGVtZW50cyI6IFsKICAgICAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgInR5cGUiOiAiUGljdHVyZSIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAic2hvd19ieV9jb25kaXRpb24iOiAiIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICJWYWx1ZSI6ICJAcGljIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICJOb1JlZnJlc2giOiBGYWxzZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICJkb2N1bWVudF90eXBlIjogIiIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAibWFzayI6ICIiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgIlZhcmlhYmxlIjogIiIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAiVGV4dFNpemUiOiAiMTYiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgIlRleHRDb2xvciI6ICIjREI3MDkzIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICJUZXh0Qm9sZCI6IFRydWUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAiVGV4dEl0YWxpYyI6IEZhbHNlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgIkJhY2tncm91bmRDb2xvciI6ICIiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgIndpZHRoIjogIjc1IiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICJoZWlnaHQiOiAiNzUiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgIndlaWdodCI6IDAKICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgInR5cGUiOiAiTGluZWFyTGF5b3V0IiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICJvcmllbnRhdGlvbiI6ICJ2ZXJ0aWNhbCIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAiaGVpZ2h0IjogIndyYXBfY29udGVudCIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAid2lkdGgiOiAibWF0Y2hfcGFyZW50IiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICJ3ZWlnaHQiOiAiMSIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAiRWxlbWVudHMiOiBbCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAidHlwZSI6ICJUZXh0VmlldyIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJzaG93X2J5X2NvbmRpdGlvbiI6ICIiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiVmFsdWUiOiAiQG5hbWUiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiTm9SZWZyZXNoIjogRmFsc2UsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJkb2N1bWVudF90eXBlIjogIiIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJtYXNrIjogIiIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJWYXJpYWJsZSI6ICIiCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJ0eXBlIjogIlRleHRWaWV3IiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgInNob3dfYnlfY29uZGl0aW9uIjogIiIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJWYWx1ZSI6ICJAcHJvZHVjdF9udW1iZXIiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiTm9SZWZyZXNoIjogRmFsc2UsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJkb2N1bWVudF90eXBlIjogIiIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJtYXNrIjogIiIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJWYXJpYWJsZSI6ICIiCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJ0eXBlIjogIlRleHRWaWV3IiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgInNob3dfYnlfY29uZGl0aW9uIjogIiIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJWYWx1ZSI6ICJAYmFyY29kZSIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJOb1JlZnJlc2giOiBGYWxzZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgImRvY3VtZW50X3R5cGUiOiAiIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIm1hc2siOiAiIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIlZhcmlhYmxlIjogIiIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBdCiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBdCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIF0KICAgICAgICB9CgogICAgfQogICAgfQoKICAgICMgX2ZpbGVzID0ganNvbi5sb2FkcyhoYXNoTWFwLmdldCgiX2ZpbGVzIikpCiAgICB3aXRoIGRiX3Nlc3Npb246IyDQl9Cw0LzQtdC90LjQuyEhIQogICAgICAgIHF1ZXJ5ID0gc2VsZWN0KGMgZm9yIGMgaW4gdWlfZ2xvYmFsLlNXX0dvb2RzKQogICAgICAgIGxpc3RbImN1c3RvbWNhcmRzIl1bImNhcmRzZGF0YSJdID0gW10KCiAgICAgICAgZm9yIHJlY29yZCBpbiBxdWVyeToKCiAgICAgICAgICAgIHBpYyA9ICIiCiAgICAgICAgICAgIGlmICdwaG90bycgaW4gcmVjb3JkLnBpY3R1cmVzOgoKICAgICAgICAgICAgICAgIHAgPSByZWNvcmQucGljdHVyZXNbJ3Bob3RvJ10KCiAgICAgICAgICAgICAgICBpZiBsZW4ocCkgPiAwOgoKICAgICAgICAgICAgICAgICAgICBmb3IgamYgaW4gX2ZpbGVzOiMg0L3QsNGF0L7QtNC40Lwg0L/Rg9GC0Ywg0Log0YTQsNC50LvRgyDQv9C+INC40LTQtdC90YLQuNGE0LjQutCw0YLQvtGA0YMKICAgICAgICAgICAgICAgICAgICAgICAgaWYgamZbJ2lkJ10gPT0gcFswXToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIG9zLnBhdGguZXhpc3RzKGpmWydwYXRoJ10pOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBpYyA9ICJ+IiArIGpmWydwYXRoJ10KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrCgogICAgICAgICAgICBsaXN0WyJjdXN0b21jYXJkcyJdWyJjYXJkc2RhdGEiXS5hcHBlbmQoCiAgICAgICAgICAgICAgICB7Im5hbWUiOiByZWNvcmQubmFtZSwgImtleSI6IHJlY29yZC5pZCwgInByb2R1Y3RfbnVtYmVyIjogc3RyKHJlY29yZC5wcm9kdWN0X251bWJlciksCiAgICAgICAgICAgICAgICAgImJhcmNvZGUiOiBzdHIocmVjb3JkLmJhcmNvZGUpLCAidW5pdCI6IHN0cihyZWNvcmQudW5pdCksICJza3Vncm91cCI6IHN0cihyZWNvcmQuZ3JvdXApLAogICAgICAgICAgICAgICAgICJwcmljZSI6IHJlY29yZC5wcmljZSwgInVuaXF1ZSI6IHJlY29yZC51bmlxdWUsICJwaWN0dXJlcyI6IGpzb24uZHVtcHMocmVjb3JkLnBpY3R1cmVzKSwgInBpYyI6IHBpY30pCiAgICBoYXNoTWFwLnB1dCgibGlzdCIsIGpzb24uZHVtcHMobGlzdCkpCgogICAgcmV0dXJuIGhhc2hNYXAKCgpkZWYgb3Blbl9ub20oaGFzaE1hcCwga2V5KTojLCBfbm9tX2lkLCBrZXkpOgogICAgamxpc3QgPSBqc29uLmxvYWRzKGhhc2hNYXAuZ2V0KCJsaXN0IikpCiAgICBnb29kc2FycmF5ID0gamxpc3RbImN1c3RvbWNhcmRzIl1bJ2NhcmRzZGF0YSddCgogICAganJlY29yZCA9IG5leHQoaXRlbSBmb3IgaXRlbSBpbiBnb29kc2FycmF5IGlmIHN0cihpdGVtWyJrZXkiXSkgPT0ga2V5KQoKICAgIGhhc2hNYXAucHV0KCdfbm9tX2lkJywgc3RyKGpyZWNvcmRbJ2tleSddKSkjINCy0LLQvtC0IF9ub21faWQgVGltZSEhIQogICAgaGFzaE1hcC5wdXQoIm5hbWUiLCBqcmVjb3JkWyduYW1lJ10pCiAgICBoYXNoTWFwLnB1dCgiYmFyY29kZSIsIGpyZWNvcmRbJ2JhcmNvZGUnXSkKICAgIGhhc2hNYXAucHV0KCJ1bml0IiwganJlY29yZFsndW5pdCddKQogICAgaGFzaE1hcC5wdXQoImdyb3VwIiwganJlY29yZFsnc2t1Z3JvdXAnXSkKICAgIGhhc2hNYXAucHV0KCJwcmljZSIsIHN0cihqcmVjb3JkWydwcmljZSddKSkKICAgIGhhc2hNYXAucHV0KCJwcm9kdWN0X251bWJlciIsIGpyZWNvcmRbJ3Byb2R1Y3RfbnVtYmVyJ10pCgogICAgaWYganJlY29yZFsndW5pcXVlJ10gPT0gMToKICAgICAgICBoYXNoTWFwLnB1dCgidW5pcXVlIiwgInRydWUiKQogICAgZWxzZToKICAgICAgICBoYXNoTWFwLnB1dCgidW5pcXVlIiwgImZhbHNlIikKCiAgICAjIGlmIGxlbihzdHIoanJlY29yZFsncGljdHVyZXMnXSkpPjA6CiAgICBqZyA9IGpzb24ubG9hZHMoanJlY29yZFsncGljdHVyZXMnXSkKICAgIGlmICdwaG90bycgaW4gamc6CiAgICAgICAgaGFzaE1hcC5wdXQoInBob3RvR2FsbGVyeSIsIGpzb24uZHVtcHMoamdbJ3Bob3RvJ10pKQogICAgZWxzZToKICAgICAgICBoYXNoTWFwLnB1dCgicGhvdG9HYWxsZXJ5IiwganNvbi5kdW1wcyhbXSkpCgogICAgaGFzaE1hcC5wdXQoIlNob3dTY3JlZW4iLCAi0KLQvtCy0LDRgNGL0JfQsNC/0LjRgdGMIikKCiAgICByZXR1cm4gaGFzaE1hcCMsIF9ub21faWQKCgpkZWYgZ29vZHNfaW5wdXQoaGFzaE1hcCwgX2ZpbGVzPU5vbmUsIF9kYXRhPU5vbmUpOgogICAgI2dsb2JhbCBfbm9tX2lkCgogICAgaWYgaGFzaE1hcC5nZXQoImxpc3RlbmVyIikgPT0gImJ0bl9hZGQiOgogICAgICAgIGhhc2hNYXAucHV0KCJuYW1lIiwgIiIpCiAgICAgICAgaGFzaE1hcC5wdXQoImJhcmNvZGUiLCAiIikKICAgICAgICBoYXNoTWFwLnB1dCgidW5pdCIsICIiKQogICAgICAgIGhhc2hNYXAucHV0KCJncm91cCIsICIiKQogICAgICAgIGhhc2hNYXAucHV0KCJwcmljZSIsICIwIikKICAgICAgICBoYXNoTWFwLnB1dCgidW5pcXVlIiwgImZhbHNlIikKICAgICAgICBoYXNoTWFwLnB1dCgicHJvZHVjdF9udW1iZXIiLCAiIikKCiAgICAgICAgaGFzaE1hcC5wdXQoInBob3RvR2FsbGVyeSIsIGpzb24uZHVtcHMoW10pKSAgIyDQv9GD0YHRgtC+0Lkg0YHQv9C40YHQvtC6INC/0L7QtCDQs9Cw0LvQtdGA0LXRjgoKICAgICAgICBfbm9tX2lkID0gLTEjINC40LfQvNC10L3Rj9C10YLRgdGPIF9ub21faWQhISEKICAgICAgICBoYXNoTWFwLnB1dCgnX25vbV9pZCcsIHN0cihfbm9tX2lkKSkgICMg0LLQstC+0LQgX25vbV9pZCBUaW1lISEhCiAgICAgICAgaGFzaE1hcC5wdXQoInRvYXN0Iiwgc3RyKF9ub21faWQpICsgIiDQtNC+0LHQsNCy0LjRgtGMINC90L7QstGL0Lkg0YLQvtCy0LDRgCIpICAjIFRpbWUhISEhCiAgICAgICAgaGFzaE1hcC5wdXQoIlNob3dTY3JlZW4iLCAi0KLQvtCy0LDRgNGL0JfQsNC/0LjRgdGMIikKCgogICAgZWxpZiBoYXNoTWFwLmdldCgibGlzdGVuZXIiKSA9PSAiQ2FyZHNDbGljayI6CgogICAgICAgIF9ub21faWQgPSBpbnQoaGFzaE1hcC5nZXQoJ19ub21faWQnKSkgICMg0L/RgNC+0YfQuNGC0LDQu9C4IF9ub21faWQgVGltZSEhIQogICAgICAgIGhhc2hNYXAucHV0KCJ0b2FzdCIsIHN0cihfbm9tX2lkKSArICIg0L3QvtC80LXRgElEINC60LvQuNC6INC90LAg0YHRgtGA0L7QutGDINGC0LDQsdC70LjRhtGLIikjIFRpbWUhISEhCiAgICAgICAgaGFzaE1hcCA9IG9wZW5fbm9tKGhhc2hNYXAsIGhhc2hNYXAuZ2V0KCJzZWxlY3RlZF9jYXJkX2tleSIpKSMg0LjQt9C80LXQvdGP0LXRgtGB0Y8g0L/QtdGA0LXQvNC10L3QvdCw0Y8KCgogICAgZWxpZiBoYXNoTWFwLmdldCgibGlzdGVuZXIiKSA9PSAiYmFyY29kZSI6CiAgICAgICAgIyBoYXNoTWFwLnB1dCgidG9hc3QiLGhhc2hNYXAuZ2V0KCJiYXJjb2RlX2lucHV0IikpCiAgICAgICAgd2l0aCBkYl9zZXNzaW9uOiAgIyDQl9Cw0LzQtdC90LjQuyEhIQogICAgICAgICAgICBub20gPSB1aV9nbG9iYWwuU1dfR29vZHMuZ2V0KGJhcmNvZGU9aGFzaE1hcC5nZXQoImJhcmNvZGVfc2VhcmNoIikpCiAgICAgICAgICAgIGlmIG5vbSA9PSBOb25lOgogICAgICAgICAgICAgICAgaGFzaE1hcC5wdXQoInRvYXN0IiwgItCi0L7QstCw0YAg0L3QtSDQvdCw0LnQtNC10L0iKQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgaGFzaE1hcCA9IG9wZW5fbm9tKGhhc2hNYXAsIHN0cihub20uaWQpKQoKICAgICAgICAgICAgICAgIGhhc2hNYXAucHV0KCJzcGVhayIsIG5vbS5uYW1lKQoKCiAgICBlbGlmIGhhc2hNYXAuZ2V0KCJsaXN0ZW5lciIpID09ICJ2aXNpb24iOgogICAgICAgICMgaGFzaE1hcC5wdXQoInRvYXN0IixoYXNoTWFwLmdldCgiX25vbV9pZCIpKQogICAgICAgIHdpdGggZGJfc2Vzc2lvbjogICMg0JfQsNC80LXQvdC40LshISEKICAgICAgICAgICAgbm9tID0gdWlfZ2xvYmFsLlNXX0dvb2RzLmdldChpZD1pbnQoaGFzaE1hcC5nZXQoIl9ub21faWQiKSkpCiAgICAgICAgICAgIGlmIG5vbSA9PSBOb25lOgogICAgICAgICAgICAgICAgaGFzaE1hcC5wdXQoInRvYXN0IiwgItCi0L7QstCw0YAg0L3QtSDQvdCw0LnQtNC10L0iKQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgaGFzaE1hcCA9IG9wZW5fbm9tKGhhc2hNYXAsIHN0cihub20uaWQpKQogICAgICAgICAgICAgICAgaGFzaE1hcC5wdXQoInNwZWFrIiwgbm9tLm5hbWUpCiAgICBlbGlmIGhhc2hNYXAuZ2V0KCJsaXN0ZW5lciIpID09ICdPTl9CQUNLX1BSRVNTRUQnOgogICAgICAgIGhhc2hNYXAucHV0KCJTaG93U2NyZWVuIiwgItCc0LXQvdGOINCd0KHQmCIpCgogICAgcmV0dXJuIGhhc2hNYXAKCgoKCmRlZiBnZXRfaWZfZXhpc3QoaGFzaE1hcCwgZmllbGQpOgogICAgaWYgaGFzaE1hcC5jb250YWluc0tleShmaWVsZCk6CiAgICAgICAgcmVzID0gaGFzaE1hcC5nZXQoZmllbGQpCiAgICBlbHNlOgogICAgICAgIHJlcyA9ICIiCiAgICByZXR1cm4gcmVzCgoKZGVmIGdldGJvb2xlYW5faWZfZXhpc3QoaGFzaE1hcCwgZmllbGQpOgogICAgaWYgbm90IGhhc2hNYXAuY29udGFpbnNLZXkoZmllbGQpOgogICAgICAgIHJlcyA9IDAKICAgIGVsc2U6CiAgICAgICAgaWYgaGFzaE1hcC5nZXQoZmllbGQpID09ICJ0cnVlIjoKICAgICAgICAgICAgcmVzID0gMQogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJlcyA9IDAKCiAgICByZXR1cm4gcmVzCgoKZGVmIGdldGZsb2F0X2lmX2V4aXN0KGhhc2hNYXAsIGZpZWxkKToKICAgIGlmIG5vdCBoYXNoTWFwLmNvbnRhaW5zS2V5KGZpZWxkKToKICAgICAgICByZXMgPSAwCiAgICBlbHNlOgogICAgICAgIHRyeToKICAgICAgICAgICAgcmVzID0gZmxvYXQoaGFzaE1hcC5nZXQoZmllbGQpKQoKICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgIHJldHVybiAwCiAgICByZXR1cm4gcmVzCgoKZGVmIHNhdmVfbm9tKGhhc2hNYXApOgogICAgI2dsb2JhbCBfbm9tX2lkCiAgICBpZiBub3QgaGFzaE1hcC5jb250YWluc0tleSgibmFtZSIpOgogICAgICAgIGhhc2hNYXAucHV0KCJ0b2FzdCIsICLQndC1INGD0LrQsNC30LDQvdC+INC90LDQuNC80LXQvdC+0LLQsNC90LjQtSIpCiAgICAgICAgcmV0dXJuIGhhc2hNYXAsIEZhbHNlCiAgICBlbHNlOgogICAgICAgIGlmIGxlbihoYXNoTWFwLmdldCgibmFtZSIpKSA9PSAwOgogICAgICAgICAgICBoYXNoTWFwLnB1dCgidG9hc3QiLCAi0J3QtSDRg9C60LDQt9Cw0L3QviDQvdCw0LjQvNC10L3QvtCy0LDQvdC40LUiKQogICAgICAgICAgICByZXR1cm4gaGFzaE1hcCwgRmFsc2UKCiAgICBpZiBub3QgaGFzaE1hcC5jb250YWluc0tleSgidW5pdCIpOgogICAgICAgIGhhc2hNYXAucHV0KCJ0b2FzdCIsICLQndC1INGD0LrQsNC30LDQvdCwINC10LTQuNC90LjRhtCwIikKICAgICAgICByZXR1cm4gaGFzaE1hcCwgRmFsc2UKICAgIGVsc2U6CiAgICAgICAgaWYgbGVuKGhhc2hNYXAuZ2V0KCJ1bml0IikpID09IDA6CiAgICAgICAgICAgIGhhc2hNYXAucHV0KCJ0b2FzdCIsICLQndC1INGD0LrQsNC30LDQvdCwINC10LTQuNC90LjRhtCwIikKICAgICAgICAgICAgcmV0dXJuIGhhc2hNYXAsIEZhbHNlCgogICAgaWYgaW50KGhhc2hNYXAuZ2V0KCdfbm9tX2lkJykpIDwgMDogICMg0L/RgNC+0YfQuNGC0LDQu9C4IF9ub21faWQgVGltZSEhIQoKICAgICAgICB3aXRoIGRiX3Nlc3Npb246I9GB0L7Qt9C00LDQtdC8INC90L7QstGD0Y4g0LfQsNC/0LjRgdGMCiAgICAgICAgICAgIHIgPSB1aV9nbG9iYWwuU1dfR29vZHMobmFtZT1nZXRfaWZfZXhpc3QoaGFzaE1hcCwgIm5hbWUiKSwgYmFyY29kZT1nZXRfaWZfZXhpc3QoaGFzaE1hcCwgImJhcmNvZGUiKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1bml0PWdldF9pZl9leGlzdChoYXNoTWFwLCAidW5pdCIpLCBncm91cD1nZXRfaWZfZXhpc3QoaGFzaE1hcCwgImdyb3VwIiksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJvZHVjdF9udW1iZXI9Z2V0X2lmX2V4aXN0KGhhc2hNYXAsICJwcm9kdWN0X251bWJlciIpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByaWNlPWdldGZsb2F0X2lmX2V4aXN0KGhhc2hNYXAsICJwcmljZSIpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVuaXF1ZT1nZXRib29sZWFuX2lmX2V4aXN0KGhhc2hNYXAsICJ1bmlxdWUiKSkKICAgICAgICAgICAgX25vbV9pZCA9IHIuaWQjINC40LfQvNC10L3Rj9C10YLRgdGPIF9ub21faWQgVGltZSEhIQogICAgICAgICAgICBoYXNoTWFwLnB1dCgidG9hc3QiLCBzdHIoX25vbV9pZCkgKyAgIiDRgdC+0LfQtNCw0LXQvCDQvdC+0LLRg9GOINC30LDQv9C40YHRjCIpI3RpbWUhISEKICAgICAgICAgICAgaGFzaE1hcC5wdXQoJ19ub21faWQnLCBzdHIoX25vbV9pZCkpICAjINCy0LLQvtC0IF9ub21faWQgVGltZSEhIQogICAgICAgICAgICBjb21taXQoKQogICAgZWxzZTojINC/0LXRgNC10LfQsNC/0LjRgdGL0LLQsNC1bSDRgdGC0LDRgNGD0Y4g0LfQsNC/0LjRgdGMCiAgICAgICAgd2l0aCBkYl9zZXNzaW9uOgoKICAgICAgICAgICAgciA9IHVpX2dsb2JhbC5TV19Hb29kc1tpbnQoaGFzaE1hcC5nZXQoJ19ub21faWQnKSldIyDQv9GA0L7Rh9C40YLQsNC70LggX25vbV9pZCBUaW1lISEhCiAgICAgICAgICAgIHIubmFtZSA9IGdldF9pZl9leGlzdChoYXNoTWFwLCAibmFtZSIpCiAgICAgICAgICAgIHIuYmFyY29kZSA9IGdldF9pZl9leGlzdChoYXNoTWFwLCAiYmFyY29kZSIpCiAgICAgICAgICAgIHIudW5pdCA9IGdldF9pZl9leGlzdChoYXNoTWFwLCAidW5pdCIpCiAgICAgICAgICAgIHIuZ3JvdXAgPSBnZXRfaWZfZXhpc3QoaGFzaE1hcCwgImdyb3VwIikKICAgICAgICAgICAgci5wcm9kdWN0X251bWJlciA9IGdldF9pZl9leGlzdChoYXNoTWFwLCAicHJvZHVjdF9udW1iZXIiKQogICAgICAgICAgICByLnByaWNlID0gZ2V0ZmxvYXRfaWZfZXhpc3QoaGFzaE1hcCwgInByaWNlIikKICAgICAgICAgICAgci51bmlxdWUgPSBnZXRib29sZWFuX2lmX2V4aXN0KGhhc2hNYXAsICJ1bmlxdWUiKQoKICAgICAgICAgICAgaiA9IHt9CgogICAgICAgICAgICBqWydwaG90byddID0ganNvbi5sb2FkcyhoYXNoTWFwLmdldCgicGhvdG9HYWxsZXJ5IikpCiAgICAgICAgICAgIHIucGljdHVyZXMgPSBqCiAgICAgICAgICAgIGhhc2hNYXAucHV0KCJ0b2FzdCIsICBzdHIoaW50KGhhc2hNYXAuZ2V0KCdfbm9tX2lkJykpKSArICAiINC/0LXRgNC10LfQsNC/0LjRgdGL0LLQsNC1bSDRgdGC0LDRgNGD0Y4g0LfQsNC/0LjRgdGMIikgICMgdGltZSEhIQoKICAgICAgICAgICAgY29tbWl0KCkKICAgIHJldHVybiBoYXNoTWFwLCBUcnVlCgoKCmRlZiBnb29kc19yZWNvcmRfb25fc3RhcnQoaGFzaE1hcCwgX2ZpbGVzPU5vbmUsIF9kYXRhPU5vbmUpOgogICAgI2dsb2JhbCBfbm9tX2lkCiAgICBoYXNoTWFwLnB1dCgibW1fbG9jYWwiLCAiIikKICAgIGhhc2hNYXAucHV0KCJtbV9jb21wcmVzc2lvbiIsICI3MCIpCiAgICBoYXNoTWFwLnB1dCgibW1fc2l6ZSIsICI2NSIpCgogICAgaGFzaE1hcC5wdXQoImZpbGxfbmFtZSIsIGpzb24uZHVtcHMoeyJoaW50IjogItCS0LLQtdC00LjRgtC1INC90LDQuNC80LXQvdC+0LLQsNC90LjQtSDRgtC+0LLQsNGA0LAiICsgc3RyKGludChoYXNoTWFwLmdldCgnX25vbV9pZCcpKSksICJkZWZhdWx0X3RleHQiOiBoYXNoTWFwLmdldCgibmFtZSIpfSkpCiAgICBoYXNoTWFwLnB1dCgiZmlsbF9iYXJjb2RlIiwganNvbi5kdW1wcyh7ImhpbnQiOiAi0JLQstC10LTQuNGC0LUv0L7RgtGB0LrQsNC90LjRgNGD0LnRgtC1INGI0YLRgNC40YXQutC+0LQg0YLQvtCy0LDRgNCwIiwgImRlZmF1bHRfdGV4dCI6IGhhc2hNYXAuZ2V0KCJiYXJjb2RlIil9KSkKICAgIGhhc2hNYXAucHV0KCJmaWxsX3Byb2R1Y3RfbnVtYmVyIiwganNvbi5kdW1wcyh7ImhpbnQiOiAi0JLQstC10LTQuNGC0LUg0LDRgNGC0LjQutGD0Lsg0YLQvtCy0LDRgNCwIiwgImRlZmF1bHRfdGV4dCI6IGhhc2hNYXAuZ2V0KCJwcm9kdWN0X251bWJlciIpfSkpCiAgICBoYXNoTWFwLnB1dCgiZmlsbF9wcmljZSIsIGpzb24uZHVtcHMoeyJoaW50IjogItCS0LLQtdC00LjRgtC1INGG0LXQvdGDIiwgImRlZmF1bHRfdGV4dCI6IGhhc2hNYXAuZ2V0KCJwcmljZSIpfSkpCgogICAgdW5pdHMgPSBbXQogICAgdW5pdHMuYXBwZW5kKCI80JLRi9Cx0LXRgNC40YLQtSDQtdC0LdGG0YMg0LjQt9C80LXRgNC10L3QuNGPIC4uLj4iKQoKICAgIHdpdGggZGJfc2Vzc2lvbjojINCX0LDQvNC10L3QuNC7ISEhCiAgICAgICAgcXVlcnkgPSBzZWxlY3QoYyBmb3IgYyBpbiB1aV9nbG9iYWwuU1dfVW5pdHMpCiAgICAgICAgZm9yIHJlY29yZCBpbiBxdWVyeToKICAgICAgICAgICAgdW5pdHMuYXBwZW5kKHJlY29yZC5uYW1lKQoKICAgICAgICBoYXNoTWFwLnB1dCgidW5pdHMiLCAiOyIuam9pbih1bml0cykpCgogICAgICAgIGdyb3VwcyA9IFtdCiAgICAgICAgZ3JvdXBzLmFwcGVuZCgiPNCS0YvQsdC10YDQuNGC0LUg0LPRgNGD0L/Qv9GDINGC0L7QstCw0YDQvtCyIC4uLj4iKQogICAgICAgIHF1ZXJ5ID0gc2VsZWN0KGMgZm9yIGMgaW4gdWlfZ2xvYmFsLlNXX0dyb3VwcykKICAgICAgICBmb3IgcmVjb3JkIGluIHF1ZXJ5OgogICAgICAgICAgICBncm91cHMuYXBwZW5kKHJlY29yZC5uYW1lKQoKICAgICAgICBoYXNoTWFwLnB1dCgiZ3JvdXBzIiwgIjsiLmpvaW4oZ3JvdXBzKSkKCiAgICAgICAgIyBoYXNoTWFwLnB1dCgidG9hc3QiLGhhc2hNYXAuZ2V0KCJwaG90b0dhbGxlcnkiKSkKCiAgICByZXR1cm4gaGFzaE1hcAoKCgpkZWYgZ29vZHNfcmVjb3JkX2lucHV0KGhhc2hNYXAsIF9maWxlcz1Ob25lLCBfZGF0YT1Ob25lKToKICAgICNnbG9iYWwgX25vbV9pZAogICAgaWYgaGFzaE1hcC5nZXQoImxpc3RlbmVyIikgPT0gImJ0bl9zYXZlIjoKICAgICAgICAjIGhhc2hNYXAucHV0KCJ0b2FzdCIsc3RyKGhhc2hNYXAuZ2V0KCJ1bmlxdWUiKSkpCiAgICAgICAgaGFzaE1hcC5wdXQoInRvYXN0Iiwgc3RyKGludChoYXNoTWFwLmdldCgnX25vbV9pZCcpKSkgKyAnIGJ0biBzYXZlJykjINCS0YDQtdC80LXQvdC90LDRjyB0aW1lISEhIQogICAgICAgIGhhc2hNYXAsIHN1Y2Nlc3MgPSBzYXZlX25vbShoYXNoTWFwKQogICAgICAgIGlmIHN1Y2Nlc3M6CiAgICAgICAgICAgIGhhc2hNYXAucHV0KCJTaG93U2NyZWVuIiwgItCU0L7QsdCw0LLQuNGC0Ywg0YLQvtCy0LDRgCIpCgogICAgZWxpZiBoYXNoTWFwLmdldCgibGlzdGVuZXIiKSA9PSAiYmFyY29kZSI6CiAgICAgICAgaGFzaE1hcC5wdXQoImJhcmNvZGUiLCBoYXNoTWFwLmdldCgiYmFyY29kZV9ub20iKSkKCiAgICBlbGlmIGhhc2hNYXAuZ2V0KCJsaXN0ZW5lciIpID09ICJDYXJkc0NsaWNrIjoKICAgICAgICBoYXNoTWFwLnB1dCgidG9hc3QiLCBzdHIoaW50KGhhc2hNYXAuZ2V0KCdfbm9tX2lkJykpKSArICcgQ2FyZHNDbGljaycpIyDQktGA0LXQvNC10L3QvdCw0Y8gdGltZSEhISEKICAgICAgICBoYXNoTWFwLnB1dCgidG9hc3QiLCBzdHIoaGFzaE1hcC5nZXQoInNlbGVjdGVkX2NhcmRfa2V5IikpKQoKICAgIGVsaWYgaGFzaE1hcC5nZXQoImxpc3RlbmVyIikgPT0gJ09OX0JBQ0tfUFJFU1NFRCc6CiAgICAgICAgaGFzaE1hcC5wdXQoIlNob3dTY3JlZW4iLCAi0JTQvtCx0LDQstC40YLRjCDRgtC+0LLQsNGAIikKCiAgICBlbGlmIGhhc2hNYXAuZ2V0KCJsaXN0ZW5lciIpID09ICdtZW51X2RlbCc6CiAgICAgICAgaGFzaE1hcC5wdXQoInRvYXN0Iiwgc3RyKGludChoYXNoTWFwLmdldCgnX25vbV9pZCcpKSkgKyAiINC90L7QvNC10YBJRCDQo9C00LDQu9C10L0uLi4iKQogICAgICAgIHdpdGggZGJfc2Vzc2lvbjoKICAgICAgICAgICAgciA9IHVpX2dsb2JhbC5TV19Hb29kc1tpbnQoaGFzaE1hcC5nZXQoJ19ub21faWQnKSldCiAgICAgICAgICAgIHIuZGVsZXRlKCkKICAgICAgICAjaGFzaE1hcC5wdXQoInRvYXN0IiwgItCj0LTQsNC70LXQvdC+Li4uIikKICAgICAgICBoYXNoTWFwLnB1dCgiU2hvd1NjcmVlbiIsICLQlNC+0LHQsNCy0LjRgtGMINGC0L7QstCw0YAiKQoKCiAgICBlbGlmIGhhc2hNYXAuZ2V0KCJsaXN0ZW5lciIpID09ICJwaG90byI6CgogICAgICAgICMg0JzQvtC20L3QviDQstC+0L7QsdGJ0LUg0Y3RgtC+0LPQviDQvdC1INC00LXQu9Cw0YLRjC3QvtGB0YLQsNCy0LvRj9GC0Ywg0LrQsNC6INC10YHRgtGMLiDQrdGC0L4g0LTQu9GPINC/0YDQuNC80LXRgNCwLgogICAgICAgIGltYWdlX2ZpbGUgPSBzdHIoCiAgICAgICAgICAgIGhhc2hNYXAuZ2V0KCJwaG90b19wYXRoIikpICAjICLQv9C10YDQtdC80LXQvdC90LDRjyIrIl9wYXRoIiAtINGB0Y7QtNCwINC/0L7QvNC10YnQsNC10YLRgdGPINC/0YPRgtGMINC6INC/0L7Qu9GD0YfQtdC90L3QvtC5INGE0L7RgtC+0LPRgNCw0YTQuNC4CiAgICAgICAgIyBoYXNoTWFwLnB1dCgidG9hc3QiLHN0cihoYXNoTWFwLmdldCgicGhvdG9fcGF0aCIpKSkKCiAgICAgICAgIyDRgdGA0LDQt9GDINGB0LTQtdC70LDQtdC8INGE0L7RgtC60YMgLSDQutCy0LDQtNGA0LDRgtC90L7QuSAtINGN0YLQviDQv9GA0L7RgdGC0L7QuSDQstCw0YDQuNCw0L3Rgi4g0JzQvtC20L3QviDRgdC00LXQu9Cw0YLRjCDQvdCw0L/RgNC40LzQtdGAINC+0YLQtNC10LvRjNC+INC80LjQvdC40LDRgtGO0YDRiyDQtNC70Y8g0YHQv9C40YHQutCwLCDRjdGC0L4g0L3QtdC80L3QvtCz0L4g0YHQu9C+0LbQvdC10LUKICAgICAgICBpbWFnZSA9IEltYWdlLm9wZW4oaW1hZ2VfZmlsZSkKICAgICAgICBpbSA9IGltYWdlLnJlc2l6ZSgoNTAwLCA1MDApKQogICAgICAgIGltLnNhdmUoaW1hZ2VfZmlsZSkKCiAgICAgICAganBob3RvYXJyID0ganNvbi5sb2FkcyhoYXNoTWFwLmdldCgicGhvdG9HYWxsZXJ5IikpCiAgICAgICAgaGFzaE1hcC5wdXQoInBob3RvR2FsbGVyeSIsIGpzb24uZHVtcHMoanBob3RvYXJyKSkKICAgICAgICAjIGhhc2hNYXAucHV0KCJ0b2FzdCIsanNvbi5kdW1wcyhqcGhvdG9hcnIpKQoKICAgIGVsaWYgaGFzaE1hcC5nZXQoCiAgICAgICAgICAgICJsaXN0ZW5lciIpID09ICJnYWxsZXJ5X2NoYW5nZSI6ICAjINC/0L7Qu9GM0LfQvtCy0LDRgtC10LvRjCDQvNC+0LbQtdGCINGD0LTQsNC70LjRgtGMINGE0L7RgtC+INC40Lcg0LPQsNC70LXRgNC10LguINCd0L7QstGL0Lkg0LzQsNGB0YHQuNCyINC90LDQtNC+INC/0L7QvNC10YHRgtC40YLRjCDQuiDQtNC+0LrRg9C80LXQvdGC0YMKCiAgICAgICAgaWYgaGFzaE1hcC5jb250YWluc0tleSgicGhvdG9HYWxsZXJ5Iik6ICAjINGN0YLQuCAyINC+0LHRgNCw0LHQvtGC0YfQuNC60LAgLSDQsNC90LDQu9C+0LPQuNGH0L3Ri9C1LCDQv9GA0L7RgdGC0L4g0LTQu9GPINGA0LDQt9C90YvRhSDRgdC+0LHRi9GC0LjQuQogICAgICAgICAgICBqcGhvdG9hcnIgPSBqc29uLmxvYWRzKGhhc2hNYXAuZ2V0KCJwaG90b0dhbGxlcnkiKSkKICAgICAgICAgICAgaGFzaE1hcC5wdXQoInBob3RvR2FsbGVyeSIsIGpzb24uZHVtcHMoanBob3RvYXJyKSkKICAgICAgICAgICAgIyBoYXNoTWFwLnB1dCgidG9hc3QiLCIjMiIranNvbi5kdW1wcyhqcGhvdG9hcnIpKQoKICAgIHJldHVybiBoYXNoTWFwCgogICAgIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0t0JTQvtCx0LDQstC40YLRjCDRj9GH0LXQudC60YMKCgpkZWYgY2VsbHNfb25fc3RhcnQoaGFzaE1hcCwgX2ZpbGVzPU5vbmUsIF9kYXRhPU5vbmUpOgogICAgbGlzdCA9IHsiY3VzdG9tY2FyZHMiOiB7CgogICAgICAgICJsYXlvdXQiOiB7CiAgICAgICAgICAgICJ0eXBlIjogIkxpbmVhckxheW91dCIsCiAgICAgICAgICAgICJvcmllbnRhdGlvbiI6ICJ2ZXJ0aWNhbCIsCiAgICAgICAgICAgICJoZWlnaHQiOiAibWF0Y2hfcGFyZW50IiwKICAgICAgICAgICAgIndpZHRoIjogIm1hdGNoX3BhcmVudCIsCiAgICAgICAgICAgICJ3ZWlnaHQiOiAiMCIsCiAgICAgICAgICAgICJFbGVtZW50cyI6IFsKCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgInR5cGUiOiAiVGV4dFZpZXciLAogICAgICAgICAgICAgICAgICAgICJzaG93X2J5X2NvbmRpdGlvbiI6ICIiLAogICAgICAgICAgICAgICAgICAgICJWYWx1ZSI6ICJAbmFtZSIsCiAgICAgICAgICAgICAgICAgICAgIk5vUmVmcmVzaCI6IEZhbHNlLAogICAgICAgICAgICAgICAgICAgICJkb2N1bWVudF90eXBlIjogIiIsCiAgICAgICAgICAgICAgICAgICAgIm1hc2siOiAiIiwKICAgICAgICAgICAgICAgICAgICAiVmFyaWFibGUiOiAiIgogICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgInR5cGUiOiAiVGV4dFZpZXciLAogICAgICAgICAgICAgICAgICAgICJzaG93X2J5X2NvbmRpdGlvbiI6ICIiLAogICAgICAgICAgICAgICAgICAgICJWYWx1ZSI6ICJAYmFyY29kZSIsCiAgICAgICAgICAgICAgICAgICAgIk5vUmVmcmVzaCI6IEZhbHNlLAogICAgICAgICAgICAgICAgICAgICJkb2N1bWVudF90eXBlIjogIiIsCiAgICAgICAgICAgICAgICAgICAgIm1hc2siOiAiIiwKICAgICAgICAgICAgICAgICAgICAiVmFyaWFibGUiOiAiIgogICAgICAgICAgICAgICAgfQogICAgICAgICAgICBdCiAgICAgICAgfQoKICAgIH0KICAgIH0KCiAgICB3aXRoIGRiX3Nlc3Npb246IyDQl9Cw0LzQtdC90LjQuyEhIQogICAgICAgIHF1ZXJ5ID0gc2VsZWN0KGMgZm9yIGMgaW4gdWlfZ2xvYmFsLlNXX0NlbGxzKQogICAgICAgIGxpc3RbImN1c3RvbWNhcmRzIl1bImNhcmRzZGF0YSJdID0gW10KCiAgICAgICAgZm9yIHJlY29yZCBpbiBxdWVyeToKICAgICAgICAgICAgbGlzdFsiY3VzdG9tY2FyZHMiXVsiY2FyZHNkYXRhIl0uYXBwZW5kKHsibmFtZSI6IHJlY29yZC5uYW1lLCAia2V5IjogcmVjb3JkLmlkLCAiYmFyY29kZSI6IHN0cihyZWNvcmQuYmFyY29kZSl9KQogICAgICAgIGhhc2hNYXAucHV0KCJsaXN0IiwganNvbi5kdW1wcyhsaXN0KSkKCiAgICByZXR1cm4gaGFzaE1hcAoKCmRlZiBjZWxsc19pbnB1dChoYXNoTWFwLCBfZmlsZXM9Tm9uZSwgX2RhdGE9Tm9uZSk6CiAgICBnbG9iYWwgY2VsbF9pZAoKICAgIGlmIGhhc2hNYXAuZ2V0KCJsaXN0ZW5lciIpID09ICJidG5fYWRkIjoKICAgICAgICBoYXNoTWFwLnB1dCgibmFtZSIsICIiKQogICAgICAgIGhhc2hNYXAucHV0KCJiYXJjb2RlIiwgIiIpCgogICAgICAgIGNlbGxfaWQgPSAtMQogICAgICAgIGhhc2hNYXAucHV0KCJTaG93U2NyZWVuIiwgItCv0YfQtdC50LrQuNCX0LDQv9C40YHRjCIpCgoKICAgIGVsaWYgaGFzaE1hcC5nZXQoImxpc3RlbmVyIikgPT0gIkNhcmRzQ2xpY2siOgoKICAgICAgICBqbGlzdCA9IGpzb24ubG9hZHMoaGFzaE1hcC5nZXQoImxpc3QiKSkKICAgICAgICBnb29kc2FycmF5ID0gamxpc3RbImN1c3RvbWNhcmRzIl1bJ2NhcmRzZGF0YSddCgogICAgICAgIGpyZWNvcmQgPSBuZXh0KGl0ZW0gZm9yIGl0ZW0gaW4gZ29vZHNhcnJheSBpZiBzdHIoaXRlbVsia2V5Il0pID09IGhhc2hNYXAuZ2V0KCJzZWxlY3RlZF9jYXJkX2tleSIpKQoKICAgICAgICBjZWxsX2lkID0ganJlY29yZFsna2V5J10KICAgICAgICBoYXNoTWFwLnB1dCgibmFtZSIsIGpyZWNvcmRbJ25hbWUnXSkKICAgICAgICBoYXNoTWFwLnB1dCgiYmFyY29kZSIsIGpyZWNvcmRbJ2JhcmNvZGUnXSkKCiAgICAgICAgaGFzaE1hcC5wdXQoIlNob3dTY3JlZW4iLCAi0K/Rh9C10LnQutC40JfQsNC/0LjRgdGMIikKCiAgICBlbGlmIGhhc2hNYXAuZ2V0KCJsaXN0ZW5lciIpID09ICdPTl9CQUNLX1BSRVNTRUQnOgogICAgICAgIGhhc2hNYXAucHV0KCJTaG93U2NyZWVuIiwgItCc0LXQvdGOINCd0KHQmCIpCgogICAgcmV0dXJuIGhhc2hNYXAKCgpkZWYgY2VsbHNfcmVjb3JkX29uX3N0YXJ0KGhhc2hNYXAsIF9maWxlcz1Ob25lLCBfZGF0YT1Ob25lKToKICAgIGhhc2hNYXAucHV0KCJmaWxsX25hbWUiLCBqc29uLmR1bXBzKHsiaGludCI6ICLQndCw0LjQvNC10L3QvtCy0LDQvdC40LUiLCAiZGVmYXVsdF90ZXh0IjogaGFzaE1hcC5nZXQoIm5hbWUiKX0pKQogICAgaGFzaE1hcC5wdXQoImZpbGxfYmFyY29kZSIsIGpzb24uZHVtcHMoeyJoaW50IjogItCo0YLRgNC40YXQutC+0LQiLCAiZGVmYXVsdF90ZXh0IjogaGFzaE1hcC5nZXQoImJhcmNvZGUiKX0pKQoKICAgIHJldHVybiBoYXNoTWFwCgoKZGVmIGNlbGxzX3JlY29yZF9pbnB1dChoYXNoTWFwLCBfZmlsZXM9Tm9uZSwgX2RhdGE9Tm9uZSk6CiAgICBnbG9iYWwgY2VsbF9pZAoKICAgIGlmIGhhc2hNYXAuZ2V0KCJsaXN0ZW5lciIpID09ICJidG5fc2F2ZSI6CiAgICAgICAgIyBoYXNoTWFwLnB1dCgidG9hc3QiLHN0cihjZWxsX2lkKSkKCiAgICAgICAgaWYgbm90IGhhc2hNYXAuY29udGFpbnNLZXkoIm5hbWUiKToKICAgICAgICAgICAgaGFzaE1hcC5wdXQoInRvYXN0IiwgItCd0LUg0YPQutCw0LfQsNC90L4g0L3QsNC40LzQtdC90L7QstCw0L3QuNC1IikKICAgICAgICAgICAgcmV0dXJuIGhhc2hNYXAKICAgICAgICBlbHNlOgogICAgICAgICAgICBpZiBsZW4oaGFzaE1hcC5nZXQoIm5hbWUiKSkgPT0gMDoKICAgICAgICAgICAgICAgIGhhc2hNYXAucHV0KCJ0b2FzdCIsICLQndC1INGD0LrQsNC30LDQvdC+INC90LDQuNC80LXQvdC+0LLQsNC90LjQtSIpCiAgICAgICAgICAgICAgICByZXR1cm4gaGFzaE1hcAoKICAgICAgICBpZiBjZWxsX2lkIDwgMDoKCiAgICAgICAgICAgIHdpdGggZGJfc2Vzc2lvbjoKICAgICAgICAgICAgICAgIHIgPSB1aV9nbG9iYWwuU1dfQ2VsbHMobmFtZT1nZXRfaWZfZXhpc3QoaGFzaE1hcCwgIm5hbWUiKSwgYmFyY29kZT1nZXRfaWZfZXhpc3QoaGFzaE1hcCwgImJhcmNvZGUiKSkKICAgICAgICAgICAgICAgIGNvbW1pdCgpCiAgICAgICAgZWxzZToKICAgICAgICAgICAgd2l0aCBkYl9zZXNzaW9uOgoKICAgICAgICAgICAgICAgIHIgPSB1aV9nbG9iYWwuU1dfQ2VsbHNbY2VsbF9pZF0KICAgICAgICAgICAgICAgIHIubmFtZSA9IGdldF9pZl9leGlzdChoYXNoTWFwLCAibmFtZSIpCiAgICAgICAgICAgICAgICByLmJhcmNvZGUgPSBnZXRfaWZfZXhpc3QoaGFzaE1hcCwgImJhcmNvZGUiKQoKICAgICAgICAgICAgICAgIGNvbW1pdCgpCiAgICAgICAgaGFzaE1hcC5wdXQoIlNob3dTY3JlZW4iLCAi0JTQvtCx0LDQstC40YLRjCDRj9GH0LXQudC60YMiKQoKICAgIGVsaWYgaGFzaE1hcC5nZXQoImxpc3RlbmVyIikgPT0gImJhcmNvZGUiOgogICAgICAgIGhhc2hNYXAucHV0KCJiYXJjb2RlIiwgaGFzaE1hcC5nZXQoImJhcmNvZGVfY2VsbCIpKQoKICAgIGVsaWYgaGFzaE1hcC5nZXQoImxpc3RlbmVyIikgPT0gIkNhcmRzQ2xpY2siOgogICAgICAgIGEgPSBUcnVlCiAgICAgICAgIyBoYXNoTWFwLnB1dCgidG9hc3QiLHN0cihoYXNoTWFwLmdldCgic2VsZWN0ZWRfY2FyZF9rZXkiKSkpCgogICAgZWxpZiBoYXNoTWFwLmdldCgibGlzdGVuZXIiKSA9PSAnT05fQkFDS19QUkVTU0VEJzoKICAgICAgICBoYXNoTWFwLnB1dCgiU2hvd1NjcmVlbiIsICLQnNC10L3RjiDQndCh0JgiKQogICAgZWxpZiBoYXNoTWFwLmdldCgibGlzdGVuZXIiKSA9PSAnbWVudV9kZWwnOgogICAgICAgIHdpdGggZGJfc2Vzc2lvbjoKICAgICAgICAgICAgciA9IHVpX2dsb2JhbC5TV19DZWxsc1tjZWxsX2lkXQogICAgICAgICAgICByLmRlbGV0ZSgpCiAgICAgICAgaGFzaE1hcC5wdXQoIlNob3dTY3JlZW4iLCAi0JTQvtCx0LDQstC40YLRjCDRj9GH0LXQudC60YMiKQogICAgICAgIGhhc2hNYXAucHV0KCJ0b2FzdCIsICLQo9C00LDQu9C10L3Qvi4uLiIpCgogICAgcmV0dXJuIGhhc2hNYXAKCgpkZWYgaW5jb21lX2NlbGxfb25fc3RhcnQoaGFzaE1hcCwgX2ZpbGVzPU5vbmUsIF9kYXRhPU5vbmUpOgogICAganQgPSB7CiAgICAgICAgInR5cGUiOiAidGFibGUiLAogICAgICAgICJ0ZXh0c2l6ZSI6ICIyNSIsCiAgICAgICAgImhpZGVjYXB0aW9uIjogImZhbHNlIiwKICAgICAgICAiaGlkZWludGVybGluZSI6ICJmYWxzZSIsCiAgICAgICAgImNvbHVtbnMiOiBbCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICJuYW1lIjogImNlbGwiLAogICAgICAgICAgICAgICAgImhlYWRlciI6ICLQr9GH0LXQudC60LAiLAogICAgICAgICAgICAgICAgIndlaWdodCI6ICIxIgogICAgICAgICAgICB9LAogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAibmFtZSI6ICJub20iLAogICAgICAgICAgICAgICAgImhlYWRlciI6ICLQotC+0LLQsNGAIiwKICAgICAgICAgICAgICAgICJ3ZWlnaHQiOiAiMiIKICAgICAgICAgICAgfSwKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgIm5hbWUiOiAicXR5IiwKICAgICAgICAgICAgICAgICJoZWFkZXIiOiAi0JrQvtC7LdCy0L4iLAogICAgICAgICAgICAgICAgIndlaWdodCI6ICIxIgogICAgICAgICAgICB9CiAgICAgICAgXSwKICAgICAgICAicm93cyI6IFtdCiAgICB9CgogICAgaWYgbm90IGhhc2hNYXAuY29udGFpbnNLZXkoInBmIik6CiAgICAgICAgIyBoYXNoTWFwLnB1dCgidG9hc3QiLCLQndC+0LLRi9C5IikKICAgICAgICBoYXNoTWFwLnB1dCgicGYiLCAiMSIpICAjINGE0LvQsNCzINC00LvRjyDQvtC/0YDQtdC00LXQu9C10L3QuNGPINC90LDRh9Cw0LvQsCDQv9GA0L7RhtC10YHRgdCwCiAgICAgICAgaGFzaE1hcC5wdXQoImNlbnRyYWxfdGFibGUiLCBqc29uLmR1bXBzKGp0KSkKCiAgICBjZWxscyA9IFtdCiAgICBjZWxscy5hcHBlbmQoIjzQstGL0LHQtdGA0LjRgtC1INGP0YfQtdC50LrRgy4uLj4iKQogICAgd2l0aCBkYl9zZXNzaW9uOiMg0JfQsNC80LXQvdC40LshISEKICAgICAgICBxdWVyeSA9IHNlbGVjdChjIGZvciBjIGluIHVpX2dsb2JhbC5TV19DZWxscykKICAgICAgICBmb3IgcmVjb3JkIGluIHF1ZXJ5OgogICAgICAgICAgICBjZWxscy5hcHBlbmQocmVjb3JkLm5hbWUpCgogICAgaGFzaE1hcC5wdXQoImNlbGxzIiwgIjsiLmpvaW4oY2VsbHMpKQoKICAgIHJldHVybiBoYXNoTWFwCgoKZGVmIGluY29tZV9jZWxsX29uX2lucHV0KGhhc2hNYXAsIF9maWxlcz1Ob25lLCBfZGF0YT1Ob25lKToKICAgICMgaGFzaE1hcC5wdXQoInRvYXN0IixoYXNoTWFwLmdldCgibGlzdGVuZXIiKSkKCiAgICBpZiBoYXNoTWFwLmdldCgibGlzdGVuZXIiKSA9PSAiIjoKICAgICAgICAjIGhhc2hNYXAucHV0KCJ0b2FzdCIsItCS0YvQsdC+0YAg0YLQvtCy0LDRgNCwLS0iKQoKICAgICAgICBpZiBub3QgaGFzaE1hcC5jb250YWluc0tleSgiY2VsbCIpOgogICAgICAgICAgICBoYXNoTWFwLnB1dCgidG9hc3QiLCAi0J3QtSDRg9C60LDQt9Cw0L3QsCDRj9GH0LXQudC60LAiKQogICAgICAgICAgICByZXR1cm4gaGFzaE1hcAogICAgICAgIGVsc2U6CiAgICAgICAgICAgIGlmIGxlbihoYXNoTWFwLmdldCgiY2VsbCIpKSA9PSAwOgogICAgICAgICAgICAgICAgaGFzaE1hcC5wdXQoInRvYXN0IiwgItCd0LUg0YPQutCw0LfQsNC90LAg0Y/Rh9C10LnQutCwIikKICAgICAgICAgICAgICAgIHJldHVybiBoYXNoTWFwCgogICAgICAgIGhhc2hNYXAucHV0KCJTaG93U2NyZWVuIiwgItCS0YvQsdC+0YAg0YLQvtCy0LDRgNCwIikKCiAgICBlbGlmIGhhc2hNYXAuZ2V0KCJsaXN0ZW5lciIpID09ICJiYXJjb2RlIjoKICAgICAgICB3aXRoIGRiX3Nlc3Npb246ICAjINCX0LDQvNC10L3QuNC7ISEhCiAgICAgICAgICAgIGNlbGwgPSB1aV9nbG9iYWwuU1dfQ2VsbHMuZ2V0KGJhcmNvZGU9aGFzaE1hcC5nZXQoImJhcmNvZGVfY2VsbCIpKQogICAgICAgIGlmIGNlbGwgPT0gTm9uZToKICAgICAgICAgICAgaGFzaE1hcC5wdXQoInRvYXN0IiwgItCv0YfQtdC50LrQsCDQvdC1INC90LDQudC00LXQvdCwIikKICAgICAgICBlbHNlOgogICAgICAgICAgICBoYXNoTWFwLnB1dCgiY2VsbCIsIGNlbGwubmFtZSkKICAgICAgICAgICAgaGFzaE1hcC5wdXQoImNlbGxfaWQiLCBzdHIoY2VsbC5pZCkpCiAgICAgICAgICAgIGhhc2hNYXAucHV0KCJ0YWJsZV9vYmplY3QiLCBnZXRfdGFibGVfYnlfY2VsbChjZWxsLmlkKSkjbmV3INC00L7QsdCw0LLQuNC7INGC0LDQsdC70LjRhtGDINC00LvRjyDQvtGB0YLQsNGC0LrQvtCyINGC0L7QstCw0YDQsCDQsiDRjdGC0L7QuSDRj9GH0LXQudC60LUKICAgICAgICAgICAgaGFzaE1hcC5wdXQoIlNob3dTY3JlZW4iLCAi0JLRi9Cx0L7RgCDRgtC+0LLQsNGA0LAiKQoKICAgIGVsaWYgaGFzaE1hcC5nZXQoImxpc3RlbmVyIikgPT0gJ2NlbGwnOgogICAgICAgIHdpdGggZGJfc2Vzc2lvbjogICMg0JfQsNC80LXQvdC40LshISEKICAgICAgICAgICAgY2VsbCA9IHVpX2dsb2JhbC5TV19DZWxscy5nZXQobmFtZT1oYXNoTWFwLmdldCgiY2VsbCIpKQogICAgICAgIGlmIGNlbGwgPT0gTm9uZToKICAgICAgICAgICAgaGFzaE1hcC5wdXQoInRvYXN0IiwgItCv0YfQtdC50LrQsCDQvdC1INC90LDQudC00LXQvdCwIikKICAgICAgICBlbHNlOgogICAgICAgICAgICBoYXNoTWFwLnB1dCgiY2VsbCIsIGNlbGwubmFtZSkKICAgICAgICAgICAgaGFzaE1hcC5wdXQoImNlbGxfaWQiLCBzdHIoY2VsbC5pZCkpCiAgICAgICAgICAgIGhhc2hNYXAucHV0KCJ0YWJsZV9vYmplY3QiLGdldF90YWJsZV9ieV9jZWxsKGNlbGwuaWQpKSAgI25ldyDQtNC+0LHQsNCy0LjQuyDRgtCw0LHQu9C40YbRgyDQtNC70Y8g0L7RgdGC0LDRgtC60L7QsiDRgtC+0LLQsNGA0LAg0LIg0Y3RgtC+0Lkg0Y/Rh9C10LnQutC1CiAgICAgICAgICAgIGhhc2hNYXAucHV0KCJTaG93U2NyZWVuIiwgItCS0YvQsdC+0YAg0YLQvtCy0LDRgNCwIikKCiAgICByZXR1cm4gaGFzaE1hcAoKCmRlZiBpbmNvbWVfbm9tX2lucHV0KGhhc2hNYXAsIF9maWxlcz1Ob25lLCBfZGF0YT1Ob25lKToKICAgICMgaGFzaE1hcC5wdXQoInRvYXN0IixoYXNoTWFwLmdldCgibGlzdGVuZXIiKSkKCiAgICBpZiBoYXNoTWFwLmdldCgibGlzdGVuZXIiKSA9PSAiIjoKCiAgICAgICAgaWYgbm90IGhhc2hNYXAuY29udGFpbnNLZXkoIm5vbSIpOgogICAgICAgICAgICBoYXNoTWFwLnB1dCgidG9hc3QiLCAi0J3QtSDRg9C60LDQt9Cw0L0g0YLQvtCy0LDRgCIpCiAgICAgICAgICAgIHJldHVybiBoYXNoTWFwCiAgICAgICAgZWxzZToKICAgICAgICAgICAgaWYgbGVuKGhhc2hNYXAuZ2V0KCJjZWxsIikpID09IDA6CiAgICAgICAgICAgICAgICBoYXNoTWFwLnB1dCgidG9hc3QiLCAi0J3QtSDRg9C60LDQt9Cw0L0g0YLQvtCy0LDRgCIpCiAgICAgICAgICAgICAgICByZXR1cm4gaGFzaE1hcAoKICAgICAgICBoYXNoTWFwLnB1dCgiU2hvd1NjcmVlbiIsICLQktCy0L7QtCDQutC+0LvQuNGH0LXRgdGC0LLQsCIpCiAgICBlbGlmIGhhc2hNYXAuZ2V0KCJsaXN0ZW5lciIpID09ICJCQUNLX0JVVFRPTiI6CiAgICAgICAgaGFzaE1hcC5wdXQoIlNob3dTY3JlZW4iLCAi0JLRi9Cx0L7RgCDRj9GH0LXQudC60LgiKQogICAgZWxpZiBoYXNoTWFwLmdldCgibGlzdGVuZXIiKSA9PSAiYmFyY29kZSI6CiAgICAgICAgd2l0aCBkYl9zZXNzaW9uOiAgIyDQl9Cw0LzQtdC90LjQuyEhIQogICAgICAgICAgICBub20gPSB1aV9nbG9iYWwuU1dfR29vZHMuZ2V0KGJhcmNvZGU9aGFzaE1hcC5nZXQoImJhcmNvZGUiKSkKICAgICAgICBpZiBub20gPT0gTm9uZToKICAgICAgICAgICAgaGFzaE1hcC5wdXQoInRvYXN0IiwgItCi0L7QstCw0YAg0L3QtSDQvdCw0LnQtNC10L0iKQogICAgICAgIGVsc2U6CiAgICAgICAgICAgIGhhc2hNYXAucHV0KCJub20iLCBub20ubmFtZSkKICAgICAgICAgICAgaGFzaE1hcC5wdXQoIl9ub21faWQiLCBzdHIobm9tLmlkKSkKICAgICAgICAgICAgaGFzaE1hcC5wdXQoInNwZWFrIiwgbm9tLm5hbWUpCiAgICAgICAgICAgIGhhc2hNYXAucHV0KCJTaG93U2NyZWVuIiwgItCS0LLQvtC0INC60L7Qu9C40YfQtdGB0YLQstCwIikKICAgICAgICAgICAgaGFzaE1hcC5wdXQoInF0eSIsICIxIikKCiAgICBlbGlmIGhhc2hNYXAuZ2V0KCJsaXN0ZW5lciIpID09ICJ2aXNpb24iOgogICAgICAgICMgaGFzaE1hcC5wdXQoInRvYXN0IixoYXNoTWFwLmdldCgibm9tX2lkIikpCiAgICAgICAgd2l0aCBkYl9zZXNzaW9uOiAgIyDQl9Cw0LzQtdC90LjQuyEhIQogICAgICAgICAgICBub20gPSB1aV9nbG9iYWwuU1dfR29vZHMuZ2V0KGlkPWludChoYXNoTWFwLmdldCgiX25vbV9pZCIpKSkKICAgICAgICBpZiBub20gPT0gTm9uZToKICAgICAgICAgICAgaGFzaE1hcC5wdXQoInRvYXN0IiwgItCi0L7QstCw0YAg0L3QtSDQvdCw0LnQtNC10L0iKQogICAgICAgIGVsc2U6CiAgICAgICAgICAgIGhhc2hNYXAucHV0KCJub20iLCBub20ubmFtZSkKICAgICAgICAgICAgaGFzaE1hcC5wdXQoIl9ub21faWQiLCBzdHIobm9tLmlkKSkKICAgICAgICAgICAgaGFzaE1hcC5wdXQoInNwZWFrIiwgbm9tLm5hbWUpCiAgICAgICAgICAgIGhhc2hNYXAucHV0KCJTaG93U2NyZWVuIiwgItCS0LLQvtC0INC60L7Qu9C40YfQtdGB0YLQstCwIikKICAgICAgICAgICAgaGFzaE1hcC5wdXQoInF0eSIsICIxIikKCiAgICByZXR1cm4gaGFzaE1hcAoKCmRlZiBpbmNvbWVfcXR5X2lucHV0KGhhc2hNYXAsIF9maWxlcz1Ob25lLCBfZGF0YT1Ob25lKToKICAgIGlmIGhhc2hNYXAuZ2V0KCJsaXN0ZW5lciIpID09ICIiOgoKICAgICAgICBpZiBnZXRmbG9hdF9pZl9leGlzdChoYXNoTWFwLCAicXR5IikgPiAwOgogICAgICAgICAgICB3aXRoIGRiX3Nlc3Npb246CiAgICAgICAgICAgICAgICByID0gdWlfZ2xvYmFsLlNXX0FjY291bnQocXR5PWdldGZsb2F0X2lmX2V4aXN0KGhhc2hNYXAsICJxdHkiKSwgc2t1PWludChoYXNoTWFwLmdldCgiX25vbV9pZCIpKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjZWxsPWludChoYXNoTWFwLmdldCgiY2VsbF9pZCIpKSkKICAgICAgICAgICAgICAgIGNvbW1pdCgpCgoKICAgICAgICBlbHNlOgoKICAgICAgICAgICAgaGFzaE1hcC5wdXQoInRvYXN0IiwgItCd0LUg0YPQutCw0LfQsNC90L4g0LrQvtC7LdCy0L4iKQogICAgICAgICAgICByZXR1cm4gaGFzaE1hcAoKICAgIGp0ID0ganNvbi5sb2FkcyhoYXNoTWFwLmdldCgiY2VudHJhbF90YWJsZSIpKQogICAganRbJ3Jvd3MnXS5hcHBlbmQoeyJjZWxsIjogaGFzaE1hcC5nZXQoImNlbGwiKSwgIm5vbSI6IGhhc2hNYXAuZ2V0KCJub20iKSwgInF0eSI6IGhhc2hNYXAuZ2V0KCJxdHkiKX0pCgogICAgaGFzaE1hcC5wdXQoImNlbnRyYWxfdGFibGUiLCBqc29uLmR1bXBzKGp0KSkKICAgIGhhc2hNYXAucHV0KCJ0YWJsZV9vYmplY3QiLCBnZXRfdGFibGVfYnlfY2VsbChpbnQoaGFzaE1hcC5nZXQoJ2NlbGxfaWQnKSkpKSAgIyBuZXcg0LTQvtCx0LDQstC40Lsg0YLQsNCx0LvQuNGG0YMg0LTQu9GPINC+0YHRgtCw0YLQutC+0LIg0YLQvtCy0LDRgNCwINCyINGN0YLQvtC5INGP0YfQtdC50LrQtQogICAgaGFzaE1hcC5wdXQoIlNob3dTY3JlZW4iLCAi0JLRi9Cx0L7RgCDRgtC+0LLQsNGA0LAiKQoKICAgIHJldHVybiBoYXNoTWFwCgoKZGVmIG91dGNvbWVfcXR5X2lucHV0KGhhc2hNYXAsIF9maWxlcz1Ob25lLCBfZGF0YT1Ob25lKToKICAgIGlmIGhhc2hNYXAuZ2V0KCJsaXN0ZW5lciIpID09ICIiOgoKICAgICAgICBpZiBnZXRmbG9hdF9pZl9leGlzdChoYXNoTWFwLCAicXR5IikgPiAwOgogICAgICAgICAgICB3aXRoIGRiX3Nlc3Npb246CiAgICAgICAgICAgICAgICBzZWxlY3RfZ29vZHMgPSBzZWxlY3QoZy5xdHkgZm9yIGcgaW4gdWlfZ2xvYmFsLlNXX0FjY291bnQgaWYgZy5za3U9PWludChoYXNoTWFwLmdldCgiX25vbV9pZCIpKSBhbmQgZy5jZWxsPT1pbnQoaGFzaE1hcC5nZXQoImNlbGxfaWQiKSkpWzpdCgogICAgICAgICAgICAgICAgaWYgc3VtKHNlbGVjdF9nb29kcykgKyAoLTEgKiBnZXRmbG9hdF9pZl9leGlzdChoYXNoTWFwLCAicXR5IikpIDwgMDoKICAgICAgICAgICAgICAgICAgICBoYXNoTWFwLnB1dCgidG9hc3QiLCAi0J7RgtCz0YDRg9C20LXQvdC+INCx0L7Qu9GM0YjQtSDRh9C10Lwg0LHRi9C70L4g0LIg0L3QsNC70LjRh9C40LghISEiKQogICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICByID0gdWlfZ2xvYmFsLlNXX0FjY291bnQocXR5PS0xICogZ2V0ZmxvYXRfaWZfZXhpc3QoaGFzaE1hcCwgInF0eSIpLCBza3U9aW50KGhhc2hNYXAuZ2V0KCJfbm9tX2lkIikpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjZWxsPWludChoYXNoTWFwLmdldCgiY2VsbF9pZCIpKSkKICAgICAgICAgICAgICAgICAgICBjb21taXQoKQoKICAgICAgICBlbHNlOgoKICAgICAgICAgICAgaGFzaE1hcC5wdXQoInRvYXN0IiwgItCd0LUg0YPQutCw0LfQsNC90L4g0LrQvtC7LdCy0L4iKQogICAgICAgICAgICByZXR1cm4gaGFzaE1hcAoKICAgIGp0ID0ganNvbi5sb2FkcyhoYXNoTWFwLmdldCgiY2VudHJhbF90YWJsZSIpKQogICAganRbJ3Jvd3MnXS5hcHBlbmQoeyJjZWxsIjogaGFzaE1hcC5nZXQoImNlbGwiKSwgIm5vbSI6IGhhc2hNYXAuZ2V0KCJub20iKSwgInF0eSI6IGhhc2hNYXAuZ2V0KCJxdHkiKX0pCgogICAgaGFzaE1hcC5wdXQoImNlbnRyYWxfdGFibGUiLCBqc29uLmR1bXBzKGp0KSkKICAgIGhhc2hNYXAucHV0KCJ0YWJsZV9vYmplY3QiLCBnZXRfdGFibGVfYnlfY2VsbChpbnQoaGFzaE1hcC5nZXQoJ2NlbGxfaWQnKSkpKSAgIyBuZXcg0LTQvtCx0LDQstC40Lsg0YLQsNCx0LvQuNGG0YMg0LTQu9GPINC+0YHRgtCw0YLQutC+0LIg0YLQvtCy0LDRgNCwINCyINGN0YLQvtC5INGP0YfQtdC50LrQtQogICAgaGFzaE1hcC5wdXQoIlNob3dTY3JlZW4iLCAi0JLRi9Cx0L7RgCDRgtC+0LLQsNGA0LAiKQoKICAgIHJldHVybiBoYXNoTWFwCgoKZGVmIHN0b2NrX29uX2NyZWF0ZShoYXNoTWFwLCBfZmlsZXM9Tm9uZSwgX2RhdGE9Tm9uZSk6CiAgICB0YWJsZSA9IHsKICAgICAgICAidHlwZSI6ICJ0YWJsZSIsCiAgICAgICAgInRleHRzaXplIjogIjE3IiwKCiAgICAgICAgImNvbHVtbnMiOiBbCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICJuYW1lIjogImNlbGwiLAogICAgICAgICAgICAgICAgImhlYWRlciI6ICLQr9GH0LXQudC60LAiLAogICAgICAgICAgICAgICAgIndlaWdodCI6ICIxIgogICAgICAgICAgICB9LAogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAibmFtZSI6ICJub20iLAogICAgICAgICAgICAgICAgImhlYWRlciI6ICLQotC+0LLQsNGAIiwKICAgICAgICAgICAgICAgICJ3ZWlnaHQiOiAiMiIKICAgICAgICAgICAgfSwKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgIm5hbWUiOiAicXR5IiwKICAgICAgICAgICAgICAgICJoZWFkZXIiOiAi0J7RgdGC0LDRgtC+0LoiLAogICAgICAgICAgICAgICAgIndlaWdodCI6ICIxIgogICAgICAgICAgICB9LAogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAibmFtZSI6ICJ1bml0IiwKICAgICAgICAgICAgICAgICJoZWFkZXIiOiAi0JXQtC7QmNC30LwiLAogICAgICAgICAgICAgICAgIndlaWdodCI6ICIxIgogICAgICAgICAgICB9CiAgICAgICAgXQogICAgfQoKICAgIGNvbm4gPSBOb25lCiAgICB0cnk6CiAgICAgICAgY29ubiA9IHNxbGl0ZTMuY29ubmVjdChEQl9QQVRIX2RlYnVnKQogICAgZXhjZXB0IEVycm9yIGFzIGU6CiAgICAgICAgcmFpc2UgVmFsdWVFcnJvcign0J3QtdGCINGB0L7QtdC00LjQvdC10L3QuNGPINGBINCx0LDQt9C+0LkhJykKICAgIHdpdGggZGJfc2Vzc2lvbjogICMg0JfQsNC80LXQvdC40LshISEKICAgICAgICBjdXJzb3IgPSBjb25uLmN1cnNvcigpCiAgICAgICAgY3Vyc29yLmV4ZWN1dGUoCiAgICAgICAgICAgICcnJ1NFTEVDVCBTV19DZWxscy5uYW1lIGFzIGNlbGwsIFNXX0dvb2RzLm5hbWUgYXMgbm9tLCBpZm51bGwoc3VtKHF0eSksMCkgYXMgcXR5LCBTV19Hb29kcy51bml0IGFzIHVuaXQKICAgICAgICAgICAgRlJPTSBTV19BY2NvdW50IExFRlQgSk9JTiBTV19Hb29kcyBPTiBTV19BY2NvdW50LnNrdT1TV19Hb29kcy5pZCBMRUZUIEpPSU4gU1dfQ2VsbHMgT04gU1dfQWNjb3VudC5jZWxsPVNXX0NlbGxzLmlkIEdST1VQIEJZIFNXX0dvb2RzLm5hbWUgLFNXX0NlbGxzLm5hbWUgSEFWSU5HIGlmbnVsbChzdW0ocXR5KSwwKTw+MCcnJykKCiAgICAgICAgcmVzdWx0cyA9IGN1cnNvci5mZXRjaGFsbCgpCgogICAgICAgIHJvd3MgPSBbXQogICAgICAgIGZvciByZWNvcmQgaW4gcmVzdWx0czoKICAgICAgICAgICAgcm93cy5hcHBlbmQoeyJjZWxsIjogcmVjb3JkWzBdLCAibm9tIjogcmVjb3JkWzFdLCAicXR5IjogcmVjb3JkWzJdLCAidW5pdCI6IHJlY29yZFszXX0pCgogICAgdGFibGVbJ3Jvd3MnXSA9IHJvd3MKICAgIGhhc2hNYXAucHV0KCJ0YWJsZSIsIGpzb24uZHVtcHModGFibGUpKQoKICAgIHJldHVybiBoYXNoTWFwCgoKCmRlZiBnZXRfdGFibGVfYnlfbm9tKGlkKToKICAgIHRhYmxlID0gewogICAgICAgICJ0eXBlIjogInRhYmxlIiwKICAgICAgICAidGV4dHNpemUiOiAiMTciLAoKICAgICAgICAiY29sdW1ucyI6IFsKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgIm5hbWUiOiAiY2VsbCIsCiAgICAgICAgICAgICAgICAiaGVhZGVyIjogItCv0YfQtdC50LrQsCIsCiAgICAgICAgICAgICAgICAid2VpZ2h0IjogIjEiCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICJuYW1lIjogIm5vbSIsCiAgICAgICAgICAgICAgICAiaGVhZGVyIjogItCi0L7QstCw0YAiLAogICAgICAgICAgICAgICAgIndlaWdodCI6ICIyIgogICAgICAgICAgICB9LAogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAibmFtZSI6ICJxdHkiLAogICAgICAgICAgICAgICAgImhlYWRlciI6ICLQntGB0YLQsNGC0L7QuiIsCiAgICAgICAgICAgICAgICAid2VpZ2h0IjogIjEiCiAgICAgICAgICAgIH0KICAgICAgICBdCiAgICB9CgogICAgY29ubiA9IE5vbmUKICAgIHRyeToKICAgICAgICBjb25uID0gc3FsaXRlMy5jb25uZWN0KERCX1BBVEhfZGVidWcpCiAgICBleGNlcHQgRXJyb3IgYXMgZToKICAgICAgICByYWlzZSBWYWx1ZUVycm9yKCfQndC10YIg0YHQvtC10LTQuNC90LXQvdC40Y8g0YEg0LHQsNC30L7QuSEnKQoKICAgIGN1cnNvciA9IGNvbm4uY3Vyc29yKCkKICAgIGN1cnNvci5leGVjdXRlKAogICAgICAgICJTRUxFQ1QgU1dfQ2VsbHMubmFtZSBhcyBjZWxsLFNXX0dvb2RzLm5hbWUgYXMgbm9tLCBpZm51bGwoc3VtKHF0eSksMCkgYXMgcXR5IEZST00gU1dfQWNjb3VudCBMRUZUIEpPSU4gU1dfR29vZHMgT04gU1dfQWNjb3VudC5za3U9U1dfR29vZHMuaWQgTEVGVCBKT0lOIFNXX0NlbGxzIE9OIFNXX0FjY291bnQuY2VsbD1TV19DZWxscy5pZCBXSEVSRSBTV19BY2NvdW50LnNrdSA9ICIgKyBzdHIoCiAgICAgICAgICAgIGlkKSArICIgR1JPVVAgQlkgU1dfR29vZHMubmFtZSAsU1dfQ2VsbHMubmFtZSBIQVZJTkcgaWZudWxsKHN1bShxdHkpLDApPD4wIikKCiAgICByZXN1bHRzID0gY3Vyc29yLmZldGNoYWxsKCkKCiAgICByb3dzID0gW10KICAgIGZvciByZWNvcmQgaW4gcmVzdWx0czoKICAgICAgICByb3dzLmFwcGVuZCh7ImNlbGwiOiByZWNvcmRbMF0sICJub20iOiByZWNvcmRbMV0sICJxdHkiOiByZWNvcmRbMl19KQoKICAgIHRhYmxlWydyb3dzJ10gPSByb3dzCgogICAgcmV0dXJuIGpzb24uZHVtcHModGFibGUpCgoKZGVmIHN0b2NrX2lucHV0KGhhc2hNYXAsIF9maWxlcz1Ob25lLCBfZGF0YT1Ob25lKToKICAgIGlmIGhhc2hNYXAuZ2V0KCJsaXN0ZW5lciIpID09ICJiYXJjb2RlIjoKICAgICAgICB3aXRoIGRiX3Nlc3Npb246ICAjINCX0LDQvNC10L3QuNC7ISEhCiAgICAgICAgICAgIG5vbSA9IHVpX2dsb2JhbC5TV19Hb29kcy5nZXQoYmFyY29kZT1oYXNoTWFwLmdldCgiYmFyY29kZSIpKQogICAgICAgIGlzX25vbSA9IEZhbHNlCgogICAgICAgIG9iamVjdCA9ICIiCgogICAgICAgIGlmIG5vbSA9PSBOb25lOgogICAgICAgICAgICBpc19ub20gPSBGYWxzZQogICAgICAgIGVsc2U6CiAgICAgICAgICAgIGlzX25vbSA9IFRydWUKICAgICAgICAgICAgaGFzaE1hcC5wdXQoIm9iamVjdCIsIG5vbS5uYW1lKQogICAgICAgICAgICBoYXNoTWFwLnB1dCgidGFibGVfb2JqZWN0IiwgZ2V0X3RhYmxlX2J5X25vbShub20uaWQpKQogICAgICAgICAgICBoYXNoTWFwLnB1dCgiU2hvd1NjcmVlbiIsICLQntGB0YLQsNGC0LrQuCDQv9C+INC+0LHRitC10LrRgtGDIikKCiAgICAgICAgaWYgbm90IGlzX25vbToKICAgICAgICAgICAgd2l0aCBkYl9zZXNzaW9uOiAgIyDQl9Cw0LzQtdC90LjQuyEhIQogICAgICAgICAgICAgICAgY2VsbCA9IHVpX2dsb2JhbC5TV19DZWxscy5nZXQoYmFyY29kZT1oYXNoTWFwLmdldCgiYmFyY29kZSIpKQogICAgICAgICAgICBpZiBjZWxsID09IE5vbmU6CiAgICAgICAgICAgICAgICBoYXNoTWFwLnB1dCgidG9hc3QiLCAi0KjRgtGA0LjRhdC60L7QtCDQvdC4INGP0YfQtdC50LrQuCDQvdC4INGC0L7QstCw0YDQsCIpCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBoYXNoTWFwLnB1dCgib2JqZWN0IiwgY2VsbC5uYW1lKQogICAgICAgICAgICAgICAgaGFzaE1hcC5wdXQoInRhYmxlX29iamVjdCIsIGdldF90YWJsZV9ieV9jZWxsKGNlbGwuaWQpKQogICAgICAgICAgICAgICAgaGFzaE1hcC5wdXQoIlNob3dTY3JlZW4iLCAi0J7RgdGC0LDRgtC60Lgg0L/QviDQvtCx0YrQtdC60YLRgyIpCgogICAgcmV0dXJuIGhhc2hNYXAKCgpkZWYgc3RvY2tfb2JqZWN0X2lucHV0KGhhc2hNYXAsIF9maWxlcz1Ob25lLCBfZGF0YT1Ob25lKToKICAgIGlmIGhhc2hNYXAuZ2V0KCJsaXN0ZW5lciIpID09ICJCQUNLX0JVVFRPTiI6CiAgICAgICAgaGFzaE1hcC5wdXQoIlNob3dTY3JlZW4iLCAi0J7RgdGC0LDRgtC60LgiKQoKICAgIHJldHVybiBoYXNoTWFwCgoKZGVmIGludmVudG9yeV9vbl9zdGFydChoYXNoTWFwLCBfZmlsZXM9Tm9uZSwgX2RhdGE9Tm9uZSk6CiAgICBsaXN0ID0geyJjdXN0b21jYXJkcyI6IHsKCiAgICAgICAgImxheW91dCI6IHsKICAgICAgICAgICAgInR5cGUiOiAiTGluZWFyTGF5b3V0IiwKICAgICAgICAgICAgIm9yaWVudGF0aW9uIjogInZlcnRpY2FsIiwKICAgICAgICAgICAgImhlaWdodCI6ICJtYXRjaF9wYXJlbnQiLAogICAgICAgICAgICAid2lkdGgiOiAibWF0Y2hfcGFyZW50IiwKICAgICAgICAgICAgIndlaWdodCI6ICIwIiwKICAgICAgICAgICAgIkVsZW1lbnRzIjogWwoKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAidHlwZSI6ICJUZXh0VmlldyIsCiAgICAgICAgICAgICAgICAgICAgInNob3dfYnlfY29uZGl0aW9uIjogIiIsCiAgICAgICAgICAgICAgICAgICAgIlZhbHVlIjogIkBkZXNjciIsCiAgICAgICAgICAgICAgICAgICAgIk5vUmVmcmVzaCI6IEZhbHNlLAogICAgICAgICAgICAgICAgICAgICJkb2N1bWVudF90eXBlIjogIiIsCiAgICAgICAgICAgICAgICAgICAgIm1hc2siOiAiIiwKICAgICAgICAgICAgICAgICAgICAiVmFyaWFibGUiOiAiIgogICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgInR5cGUiOiAiVGV4dFZpZXciLAogICAgICAgICAgICAgICAgICAgICJzaG93X2J5X2NvbmRpdGlvbiI6ICIiLAogICAgICAgICAgICAgICAgICAgICJWYWx1ZSI6ICJAZGF0ZSIsCiAgICAgICAgICAgICAgICAgICAgIk5vUmVmcmVzaCI6IEZhbHNlLAogICAgICAgICAgICAgICAgICAgICJkb2N1bWVudF90eXBlIjogIiIsCiAgICAgICAgICAgICAgICAgICAgIm1hc2siOiAiIiwKICAgICAgICAgICAgICAgICAgICAiVmFyaWFibGUiOiAiIgogICAgICAgICAgICAgICAgfQogICAgICAgICAgICBdCiAgICAgICAgfQoKICAgIH0KICAgIH0KCiAgICB3aXRoIGRiX3Nlc3Npb246IyDQl9Cw0LzQtdC90LjQuyEhIQogICAgICAgIHF1ZXJ5ID0gc2VsZWN0KGMgZm9yIGMgaW4gdWlfZ2xvYmFsLlNXX0ludmVudG9yeSkKICAgICAgICBsaXN0WyJjdXN0b21jYXJkcyJdWyJjYXJkc2RhdGEiXSA9IFtdCgogICAgICAgIGZvciByZWNvcmQgaW4gcXVlcnk6CiAgICAgICAgICAgIGxpc3RbImN1c3RvbWNhcmRzIl1bImNhcmRzZGF0YSJdLmFwcGVuZCgKICAgICAgICAgICAgICAgIHsiZGVzY3IiOiByZWNvcmQuZGVzY3JpcHRpb24sICJrZXkiOiByZWNvcmQuaWQsICJkYXRlIjogc3RyKHJlY29yZC5jcmVhdGVkX2F0KX0pCiAgICAgICAgaGFzaE1hcC5wdXQoImludmVudG9yeSIsIGpzb24uZHVtcHMobGlzdCkpCgogICAgcmV0dXJuIGhhc2hNYXAKCgpkZWYgaW52ZW50b3J5X2lucHV0KGhhc2hNYXAsIF9maWxlcz1Ob25lLCBfZGF0YT1Ob25lKToKICAgIGdsb2JhbCBjZWxsX2lkCgogICAgaWYgaGFzaE1hcC5nZXQoImxpc3RlbmVyIikgPT0gImJ0bl9uZXciOgoKICAgICAgICBoYXNoTWFwLnB1dCgiU2hvd1NjcmVlbiIsICLQndC+0LLQsNGPINC40L3QstC10L3RgtCw0YDQuNC30LDRhtC40Y8iKQoKCiAgICBlbGlmIGhhc2hNYXAuZ2V0KCJsaXN0ZW5lciIpID09ICJDYXJkc0NsaWNrIjoKCiAgICAgICAgamxpc3QgPSBqc29uLmxvYWRzKGhhc2hNYXAuZ2V0KCJpbnZlbnRvcnkiKSkKICAgICAgICBnb29kc2FycmF5ID0gamxpc3RbImN1c3RvbWNhcmRzIl1bJ2NhcmRzZGF0YSddCgogICAgICAgIGpyZWNvcmQgPSBuZXh0KGl0ZW0gZm9yIGl0ZW0gaW4gZ29vZHNhcnJheSBpZiBzdHIoaXRlbVsia2V5Il0pID09IGhhc2hNYXAuZ2V0KCJzZWxlY3RlZF9jYXJkX2tleSIpKQoKICAgICAgICBpbnZfaWQgPSBqcmVjb3JkWydrZXknXQogICAgICAgIGhhc2hNYXAucHV0KCJpbnZfbmFtZSIsIGpyZWNvcmRbJ2Rlc2NyJ10pCiAgICAgICAgaGFzaE1hcC5wdXQoImludl9pZCIsIHN0cihpbnZfaWQpKQogICAgICAgIGhhc2hNYXAucHV0KCJpbnZfZGF0ZSIsIHN0cihqcmVjb3JkWydkYXRlJ10pKQoKICAgICAgICBoYXNoTWFwLnB1dCgiU2hvd1NjcmVlbiIsICLQmNC90LLQtdC90YLQsNGA0LjQt9Cw0YbQuNGPINCg0LXQt9GD0LvRjNGC0LDRgtGLIikKCiAgICByZXR1cm4gaGFzaE1hcAoKCmRlZiBuZXdpbnZfaW5wdXQoaGFzaE1hcCwgX2ZpbGVzPU5vbmUsIF9kYXRhPU5vbmUpOgogICAgZ2xvYmFsIGNlbGxfaWQKCiAgICBpZiBoYXNoTWFwLmdldCgibGlzdGVuZXIiKSA9PSAiIjoKICAgICAgICB3aXRoIGRiX3Nlc3Npb246CiAgICAgICAgICAgIHIgPSB1aV9nbG9iYWwuU1dfSW52ZW50b3J5KGRlc2NyaXB0aW9uPWhhc2hNYXAuZ2V0KCduYW1lJykpCiAgICAgICAgICAgIGNvbW1pdCgpCgogICAgICAgICAgICBoYXNoTWFwLnB1dCgiaW52X25hbWUiLCBoYXNoTWFwLmdldCgnbmFtZScpKQogICAgICAgICAgICBoYXNoTWFwLnB1dCgiaW52X2lkIiwgc3RyKHIuaWQpKQogICAgICAgICAgICBoYXNoTWFwLnB1dCgiaW52X2RhdGUiLCBzdHIoci5jcmVhdGVkX2F0KSkKICAgICAgICAgICAgIyBoYXNoTWFwLnB1dCgidG9hc3QiLHN0cihyLmlkKSkKCiAgICAgICAgICAgIGhhc2hNYXAucHV0KCJTaG93U2NyZWVuIiwgItCY0L3QstC10L3RgtCw0YDQuNC30LDRhtC40Y8g0KDQtdC30YPQu9GM0YLQsNGC0YsiKQoKICAgIHJldHVybiBoYXNoTWFwCgoKZGVmIGludnJlc19vbl9zdGFydChoYXNoTWFwLCBfZmlsZXM9Tm9uZSwgX2RhdGE9Tm9uZSk6CiAgICBpbnZkYXRlID0gZGF0ZXRpbWUuZnJvbWlzb2Zvcm1hdChzdHIoaGFzaE1hcC5nZXQoImludl9kYXRlIikpKQogICAgaGFzaE1hcC5wdXQoImludiIsCiAgICAgICAgICAgICAgICAi0JjQvdCy0LXQvdGC0LDRgNC40LfQsNGG0LjRjyAiICsgc3RyKGhhc2hNYXAuZ2V0KCJpbnZfbmFtZSIpKSArICIg0L7RgiAiICsgaW52ZGF0ZS5zdHJmdGltZSgiJW0uJWQuJVksICVIOiVNOiVTIikpCgogICAgdGFibGUgPSB7CiAgICAgICAgInR5cGUiOiAidGFibGUiLAogICAgICAgICJ0ZXh0c2l6ZSI6ICIxNyIsCgogICAgICAgICJjb2x1bW5zIjogWwogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAibmFtZSI6ICJjZWxsIiwKICAgICAgICAgICAgICAgICJoZWFkZXIiOiAi0K/Rh9C10LnQutCwIiwKICAgICAgICAgICAgICAgICJ3ZWlnaHQiOiAiMSIKICAgICAgICAgICAgfSwKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgIm5hbWUiOiAibm9tIiwKICAgICAgICAgICAgICAgICJoZWFkZXIiOiAi0KLQvtCy0LDRgCIsCiAgICAgICAgICAgICAgICAid2VpZ2h0IjogIjIiCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICJuYW1lIjogInF0eXBsYW4iLAogICAgICAgICAgICAgICAgImhlYWRlciI6ICLQn9C70LDQvSIsCiAgICAgICAgICAgICAgICAid2VpZ2h0IjogIjEiCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICJuYW1lIjogInF0eWZhY3QiLAogICAgICAgICAgICAgICAgImhlYWRlciI6ICLQpNCw0LrRgiIsCiAgICAgICAgICAgICAgICAid2VpZ2h0IjogIjEiCiAgICAgICAgICAgIH0KICAgICAgICBdCiAgICB9CgogICAgY29ubiA9IE5vbmUKICAgIHRyeToKICAgICAgICBjb25uID0gc3FsaXRlMy5jb25uZWN0KERCX1BBVEhfZGVidWcpCiAgICBleGNlcHQgRXJyb3IgYXMgZToKICAgICAgICByYWlzZSBWYWx1ZUVycm9yKCfQndC10YIg0YHQvtC10LTQuNC90LXQvdC40Y8g0YEg0LHQsNC30L7QuSEnKQoKICAgIGN1cnNvciA9IGNvbm4uY3Vyc29yKCkKICAgIGN1cnNvci5leGVjdXRlKAogICAgICAgICJzZWxlY3QgVC5jZWxsLFQubm9tLG1heChULnF0eXBsYW4pIGFzIHF0eXBsYW4sIGlmbnVsbChzdW0oRi5xdHkpLDApIGFzIHF0eWZhY3QgRlJPTSAoU0VMRUNUIFNXX0NlbGxzLm5hbWUgYXMgY2VsbCxTV19Hb29kcy5uYW1lIGFzIG5vbSwgaWZudWxsKHN1bShTV19BY2NvdW50LnF0eSksMCkgYXMgcXR5cGxhbixTV19BY2NvdW50LnNrdSBhcyBza3VpZCwgU1dfQWNjb3VudC5jZWxsIGFzIGNlbGxpZCBGUk9NIFNXX0FjY291bnQgTEVGVCBKT0lOIFNXX0dvb2RzIE9OIFNXX0FjY291bnQuc2t1PVNXX0dvb2RzLmlkIExFRlQgSk9JTiBTV19DZWxscyBPTiBTV19BY2NvdW50LmNlbGw9U1dfQ2VsbHMuaWQgICBHUk9VUCBCWSBTV19Hb29kcy5uYW1lICxTV19DZWxscy5uYW1lLCBTV19BY2NvdW50LmNlbGwsIFNXX0FjY291bnQuc2t1IEhBVklORyBpZm51bGwoc3VtKFNXX0FjY291bnQucXR5KSwwKTw+MCkgYXMgVCBMRUZUIEpPSU4gU1dfSW52ZW50b3J5X2xpbmUgQVMgRiBPTiBULmNlbGxpZD1GLmNlbGwgQU5EIFQuc2t1aWQ9RiAuc2t1IGFuZCBGIC5pbnZlbnRvcnk9IiArIGhhc2hNYXAuZ2V0KAogICAgICAgICAgICAiaW52X2lkIikgKyAiIEdST1VQIEJZIFQuY2VsbCxULm5vbSIpCgogICAgcmVzdWx0cyA9IGN1cnNvci5mZXRjaGFsbCgpCgogICAgcm93cyA9IFtdCiAgICBjb2xvcmNlbGxzID0gW10KICAgIHJvdyA9IDAKICAgIGZvciByZWNvcmQgaW4gcmVzdWx0czoKCiAgICAgICAgcm93cy5hcHBlbmQoeyJjZWxsIjogcmVjb3JkWzBdLCAibm9tIjogcmVjb3JkWzFdLCAicXR5cGxhbiI6IHJlY29yZFsyXSwgInF0eWZhY3QiOiByZWNvcmRbM119KQogICAgICAgICMg0L/QvtC00LrRgNCw0YjQuNCy0LDQtdC8INGA0LXQt9GD0LvRjNGC0LDRgtGLINCyINC30LXQu9C10L3Ri9C5INC4INC60YDQsNGB0L3Ri9C5INGG0LLQtdGC0LAKICAgICAgICBpZiByZWNvcmRbM10gPiAwOgogICAgICAgICAgICBpZiByZWNvcmRbM10gPj0gcmVjb3JkWzJdOgogICAgICAgICAgICAgICAgY29sb3JjZWxscy5hcHBlbmQoeyJyb3ciOiByb3csICJjb2x1bW4iOiAiMyIsICJjb2xvciI6ICIjMzJhODUyIn0pCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBjb2xvcmNlbGxzLmFwcGVuZCh7InJvdyI6IHJvdywgImNvbHVtbiI6ICIzIiwgImNvbG9yIjogIiNlNjRjNGMifSkKICAgICAgICByb3cgKz0gMQoKICAgIHRhYmxlWydyb3dzJ10gPSByb3dzCiAgICB0YWJsZVsnY29sb3JjZWxscyddID0gY29sb3JjZWxscwoKICAgIGhhc2hNYXAucHV0KCJ0YWJsZSIsIGpzb24uZHVtcHModGFibGUpKQoKICAgIHJldHVybiBoYXNoTWFwCgoKZGVmIGludnJlc19pbnB1dChoYXNoTWFwLCBfZmlsZXM9Tm9uZSwgX2RhdGE9Tm9uZSk6CiAgICBnbG9iYWwgY2VsbF9pZAoKICAgIGlmIGhhc2hNYXAuZ2V0KCJsaXN0ZW5lciIpID09ICJidG5fcnVuIjoKICAgICAgICBoYXNoTWFwLnB1dCgiUnVuQ1YiLCAi0JjQvdCyQ1YiKQoKICAgIHJldHVybiBoYXNoTWFwCgoKZGVmIGludmN2X2NlbGxfb25fc3RhcnQoaGFzaE1hcCwgX2ZpbGVzPU5vbmUsIF9kYXRhPU5vbmUpOgogICAgZ2xvYmFsIGNlbGxzCiAgICBnbG9iYWwgY2VsbGlkCgogICAgY2VsbGlkID0gTm9uZQoKICAgIGlmIGhhc2hNYXAuY29udGFpbnNLZXkoInN0b3BfbGlzdGVuZXJfbGlzdCIpOgogICAgICAgIGhhc2hNYXAucmVtb3ZlKCJzdG9wX2xpc3RlbmVyX2xpc3QiKQoKICAgICMgY3JlYXRlIGNvbm5lY3Rpb24gd2l0aCBkYXRhYmFzZQogICAgY29ubiA9IE5vbmUKICAgIHRyeToKICAgICAgICBjb25uID0gc3FsaXRlMy5jb25uZWN0KERCX1BBVEhfZGVidWcpIyDQsdGL0LvQviAtINC30LDQvNC10L3QuNC7KCcvL2RhdGEvZGF0YS9ydS50cmF2ZWxmb29kLnNpbXBsZV91aS9kYXRhYmFzZXMvU2ltcGxlV01TJykKICAgIGV4Y2VwdCBFcnJvciBhcyBlOgogICAgICAgIHJhaXNlIFZhbHVlRXJyb3IoJ9Cd0LXRgiDRgdC+0LXQtNC40L3QtdC90LjRjyDRgSDQsdCw0LfQvtC5IScpCgogICAgY3Vyc29yID0gY29ubi5jdXJzb3IoKQogICAgY3Vyc29yLmV4ZWN1dGUoIlNFTEVDVCBiYXJjb2RlLGlkLG5hbWUgRlJPTSBTV19DZWxscyIpCgogICAgcmVzdWx0cyA9IGN1cnNvci5mZXRjaGFsbCgpCgogICAgZ3JlZW5fbGlzdCA9IFtdCiAgICByZWRfbGlzdCA9IFtdCiAgICBpbmZvX2xpc3QgPSBbXQogICAgY2VsbHMgPSB7fQogICAgZm9yIGxpbmsgaW4gcmVzdWx0czoKICAgICAgICAjIGpvYiA9IHsib2JqZWN0IjpzdHIobGlua1swXSksImluZm8iOnN0cihsaW5rWzFdKSsiIDwvbj4g0J7RgdGC0LDRgtC+0Lo6IDxiaWc+IitzdHIobGlua1syXSkrIjwvYmlnPiJ9CiAgICAgICAgIyBpbmZvX2xpc3QuYXBwZW5kKGpvYikKICAgICAgICBncmVlbl9saXN0LmFwcGVuZChsaW5rWzBdKQogICAgICAgIGNlbGxzW2xpbmtbMF1dID0gbGlua1sxXQoKICAgIGNvbm4uY2xvc2UoKQoKICAgICMgaGFzaE1hcC5wdXQoIm9iamVjdF9pbmZvX2xpc3QiLGpzb24uZHVtcHMoaW5mb19saXN0LGVuc3VyZV9hc2NpaT1GYWxzZSkpCiAgICBoYXNoTWFwLnB1dCgiZ3JlZW5fbGlzdCIsICc7Jy5qb2luKGdyZWVuX2xpc3QpKQoKICAgIHJldHVybiBoYXNoTWFwCgoKZGVmIGludmN2X2NlbGxfb25fbmV3X29iamVjdChoYXNoTWFwLCBfZmlsZXM9Tm9uZSwgX2RhdGE9Tm9uZSk6CiAgICBnbG9iYWwgY2VsbHMKICAgIGdsb2JhbCBjZWxsaWQKICAgIGdsb2JhbCBncmVlbl9zaXplLCB5ZWxsb3dfc2l6ZQoKICAgIGhhc2hNYXAucHV0KCJ2aWJyYXRlIiwgIiIpCgogICAgY2VsbGlkID0gY2VsbHMuZ2V0KGhhc2hNYXAuZ2V0KCJjdXJyZW50X29iamVjdCIpKQoKICAgIGlmIG5vdCBjZWxsaWQgPT0gTm9uZToKCiAgICAgICAgIyBjcmVhdGUgY29ubmVjdGlvbiB3aXRoIGRhdGFiYXNlCiAgICAgICAgY29ubiA9IE5vbmUKICAgICAgICB0cnk6CiAgICAgICAgICAgIGNvbm4gPSBzcWxpdGUzLmNvbm5lY3QoREJfUEFUSF9kZWJ1ZykKICAgICAgICBleGNlcHQgRXJyb3IgYXMgZToKICAgICAgICAgICAgcmFpc2UgVmFsdWVFcnJvcign0J3QtdGCINGB0L7QtdC00LjQvdC10L3QuNGPINGBINCx0LDQt9C+0LkhJykKCiAgICAgICAgY3Vyc29yID0gY29ubi5jdXJzb3IoKQogICAgICAgIHRyeToKICAgICAgICAgICAgIyDRgtGD0YIg0Y8g0L/QvtC90Y/QuyDRh9GC0L4g0LvQsNC20LDQvdGD0LvRgdGPLCDQuNGB0L/QvtC70YzQt9C+0LLQsNCyIHVuaXF1ZSDQsiDQutCw0YfQtdGB0YLQstC1INC40LzQtdC90LgsINC90L4g0LHRi9C70L4g0YPQttC1INC/0L7Qt9C00L3QvgogICAgICAgICAgICBjdXJzb3IuZXhlY3V0ZSgKICAgICAgICAgICAgICAgICJTRUxFQ1QgU1dfR29vZHMuYmFyY29kZSBhcyBiYXJjb2RlLFNXX0NlbGxzLm5hbWUgYXMgY2VsbCxTV19Hb29kcy5uYW1lIGFzIG5vbSwgaWZudWxsKHN1bShxdHkpLDApIGFzIHF0eSwgXCJ1bmlxdWVcIiBhcyB1bixTV19Hb29kcy5pZCBhcyBfbm9tX2lkICBGUk9NIFNXX0FjY291bnQgTEVGVCBKT0lOIFNXX0dvb2RzIE9OIFNXX0FjY291bnQuc2t1PVNXX0dvb2RzLmlkIExFRlQgSk9JTiBTV19DZWxscyBPTiBTV19BY2NvdW50LmNlbGw9U1dfQ2VsbHMuaWQgV0hFUkUgU1dfQWNjb3VudC5jZWxsID0gIiArIHN0cigKICAgICAgICAgICAgICAgICAgICBjZWxsaWQpICsgIiBHUk9VUCBCWSBTV19Hb29kcy5uYW1lICxTV19DZWxscy5uYW1lIEhBVklORyBpZm51bGwoc3VtKHF0eSksMCk8PjAiKQogICAgICAgIGV4Y2VwdCBFcnJvciBhcyBlOgogICAgICAgICAgICByYWlzZSBWYWx1ZUVycm9yKGUpCgogICAgICAgIHJlc3VsdHMgPSBjdXJzb3IuZmV0Y2hhbGwoKQoKICAgICAgICBmb3VuZCA9IFtdCgogICAgICAgIHllbGxvd19saXN0ID0gW10KICAgICAgICByZWRfbGlzdCA9IFtdCiAgICAgICAgaW5mb19saXN0ID0gW10KICAgICAgICB5ZWxsb3dfc2l6ZSA9IDAKICAgICAgICBncmVlbl9zaXplID0gMAogICAgICAgICMg0LjRgdC/0L7Qu9GM0LfRg9C10Lwgb2JqZWN0X2luZm9fbGlzdCDQuCDQt9Cw0L/RgNC+0YEg0YfRgtC+0LHRiyDRhdGA0LDQvdC40YLRjCDQt9Cw0L7QtNC90L4g0L3Rg9C20L3Ri9C1INC/0L7Qu9GPLCDQvtC90Lgg0L3Rg9C20L3RiyDQvdC1INC00LvRjyDQvtGC0L7QsdGA0LDQtNCw0LXQvdC40Y8g0LAg0LTQu9GPINC00LDQu9GM0L3QtdC50YjQtdC5INC70L7Qs9C40LrQuCAtIHVuaXF1ZSwgX25vbV9pZAogICAgICAgIGZvciBsaW5rIGluIHJlc3VsdHM6CiAgICAgICAgICAgIGpvYiA9IHsib2JqZWN0Ijogc3RyKGxpbmtbMF0pLCAiaW5mbyI6IHN0cihsaW5rWzJdKSArICIgPC9uPiDQntGB0YLQsNGC0L7QujogPGJpZz4iICsgc3RyKGxpbmtbM10pICsgIjwvYmlnPiIsCiAgICAgICAgICAgICAgICAgICAidW5pcXVlIjogbGlua1s0XSwgIl9ub21faWQiOiBzdHIobGlua1s1XSl9CiAgICAgICAgICAgIGluZm9fbGlzdC5hcHBlbmQoam9iKQogICAgICAgICAgICB5ZWxsb3dfbGlzdC5hcHBlbmQobGlua1swXSkKICAgICAgICAgICAgeWVsbG93X3NpemUgKz0gMQoKICAgICAgICBjb25uLmNsb3NlKCkKCiAgICAgICAgaGFzaE1hcC5wdXQoIm9iamVjdF9pbmZvX2xpc3QiLCBqc29uLmR1bXBzKGluZm9fbGlzdCwgZW5zdXJlX2FzY2lpPUZhbHNlKSkKICAgICAgICBoYXNoTWFwLnB1dCgieWVsbG93X2xpc3QiLCAnOycuam9pbih5ZWxsb3dfbGlzdCkpCgogICAgICAgIGludmRhdGUgPSBkYXRldGltZS5mcm9taXNvZm9ybWF0KHN0cihoYXNoTWFwLmdldCgiaW52X2RhdGUiKSkpCiAgICAgICAgaGFzaE1hcC5wdXQoImludiIsICLQmNC90LLQtdC90YLQsNGA0LjQt9Cw0YbQuNGPICIgKyBzdHIoaGFzaE1hcC5nZXQoImludl9uYW1lIikpICsgIiDQvtGCICIgKyBpbnZkYXRlLnN0cmZ0aW1lKAogICAgICAgICAgICAiJW0uJWQuJVksICVIOiVNOiVTIikgKyAiPC9uPiDQndCw0LnQtNC10L3QvjogPGJpZz4iICsgc3RyKGdyZWVuX3NpemUpICsgIjwvYmlnPiIgKyAiINC40LcgIiArICI8YmlnPiIgKyBzdHIoCiAgICAgICAgICAgIHllbGxvd19zaXplKSArICI8L2JpZz4iKQoKICAgICAgICBoYXNoTWFwLnB1dCgiTmV4dFN0ZXAiLCAi0KLQvtCy0LDRgNGLINGP0YfQtdC50LrQuCIpCgogICAgcmV0dXJuIGhhc2hNYXAKCgpkZWYgaW52Y3ZfZ29vZHNfb25fbmV3X29iamVjdChoYXNoTWFwLCBfZmlsZXM9Tm9uZSwgX2RhdGE9Tm9uZSk6CiAgICBnbG9iYWwgY2VsbHMKICAgIGdsb2JhbCBjZWxsaWQKICAgIGdsb2JhbCBncmVlbl9zaXplLCB5ZWxsb3dfc2l6ZQoKICAgIG5vbV9iYXJjb2RlID0gc3RyKGhhc2hNYXAuZ2V0KCJjdXJyZW50X29iamVjdCIpKQoKICAgIGlmIGhhc2hNYXAuY29udGFpbnNLZXkoInN0b3BfbGlzdGVuZXJfbGlzdCIpOiMg0LXRgdGC0Ywg0LvQuCBzdG9wX2xpc3RlbmVyX2xpc3Qg0LIgaGFzaE1hcAogICAgICAgIHN0b3BfbGlzdCA9IGhhc2hNYXAuZ2V0KCJzdG9wX2xpc3RlbmVyX2xpc3QiKS5zcGxpdCgiOyIpCiAgICAgICAgc3RvcF9saXN0LmFwcGVuZChub21fYmFyY29kZSkjINC00L7QsdCw0LLQuNGC0Ywgbm9tX2JhcmNvZGUg0LIgc3RvcF9saXN0ZW5lcl9saXN0CiAgICAgICAgaGFzaE1hcC5wdXQoInN0b3BfbGlzdGVuZXJfbGlzdCIsICI7Ii5qb2luKHN0b3BfbGlzdCkpCiAgICBlbHNlOgogICAgICAgIGhhc2hNYXAucHV0KCJzdG9wX2xpc3RlbmVyX2xpc3QiLCBub21fYmFyY29kZSkKCiAgICBvYmplY3RfbGlzdCA9IGpzb24ubG9hZHMoaGFzaE1hcC5nZXQoIm9iamVjdF9pbmZvX2xpc3QiKSkKCiAgICB0cnk6I9C/0YDQvtGF0L7QtNC40Lwg0L/QviBvYmplY3RfbGlzdCDQv9C+0LrQsCDQvdC1INC90LDQudC00LXQvCDQvtCx0YrQtdC60YIg0YEg0LHQsNGA0LrQvtC00L7QvCDRgtC10LrRg9GJ0LXQs9C+INC+0LHRitC10LrRgtCwCiAgICAgICAgbm9tX3JlY29yZCA9IG5leHQoaXRlbSBmb3IgaXRlbSBpbiBvYmplY3RfbGlzdCBpZiBzdHIoaXRlbVsib2JqZWN0Il0pID09IHN0cihub21fYmFyY29kZSkpCgogICAgZXhjZXB0IFN0b3BJdGVyYXRpb246CiAgICAgICAgbm9tX3JlY29yZCA9IE5vbmUKCiAgICBpZiBub3Qgbm9tX3JlY29yZCA9PSBOb25lOgogICAgICAgIGhhc2hNYXAucHV0KCJfbm9tX2lkIiwgc3RyKG5vbV9yZWNvcmQuZ2V0KCJfbm9tX2lkIikpKSMg0JfQsNC/0LjRgdGMINC90L7QvNC10YDQsCBJRCDRgtC+0LLQsNGA0LAKICAgICAgICBpZiBoYXNoTWFwLmNvbnRhaW5zS2V5KCd3cml0ZV9pZF9saXN0Jyk6CiAgICAgICAgICAgIHdyaXRlX2xpc3QgPSBoYXNoTWFwLmdldCgnd3JpdGVfaWRfbGlzdCcpLnNwbGl0KCc7JykKICAgICAgICAgICAgd3JpdGVfbGlzdC5hcHBlbmQoc3RyKG5vbV9yZWNvcmQuZ2V0KCdfbm9tX2lkJykpKQogICAgICAgICAgICBoYXNoTWFwLnB1dCgnd3JpdGVfaWRfbGlzdCcsICc7Jy5qb2luKHdyaXRlX2xpc3QpKQogICAgICAgIGVsc2U6CiAgICAgICAgICAgIGhhc2hNYXAucHV0KCd3cml0ZV9pZF9saXN0Jywgc3RyKG5vbV9yZWNvcmQuZ2V0KCdfbm9tX2lkJykpKQogICAgICAgICMgaGFzaE1hcC5wdXQoInRvYXN0IiwiX25vbV9pZD0iK3N0cihoYXNoTWFwLmdldCgiX25vbV9pZCIpKSsiIGludl9pZD0iK3N0cihoYXNoTWFwLmdldCgiaW52X2lkIikpKQogICAgICAgIGlmIG5vbV9yZWNvcmRbJ3VuaXF1ZSddID09IDE6IyDRjdGC0L4g0YPQvdC40LrQsNC70YzQvdGL0Lkg0YjRgtGA0LjRhdC60L7QtD8/PwoKICAgICAgICAgICAgaGFzaE1hcC5wdXQoInZpYnJhdGUiLCAiIikKICAgICAgICAgICAgaGFzaE1hcC5wdXQoImJlZXAiLCAiNSIpCgogICAgICAgICAgICAjINGN0YLQviDRg9C90LjQutCw0LvRjNC90YvQuSDRiNGC0YDQuNGF0LrQvtC0IC0g0LTQvtCx0LDQstC70Y/QtdC8INC10LPQviDQsiDQt9C10LvQtdC90YvQuSDRgdC/0LjRgdC+0Log0YHRgNCw0LfRgyDQuCDRg9Cx0LjRgNCw0LXQvCDQuNC3INC20LXQu9GC0L7Qs9C+CiAgICAgICAgICAgIGdyZWVuX3NpemUgPSAwCiAgICAgICAgICAgIGlmIGhhc2hNYXAuY29udGFpbnNLZXkoImdyZWVuX2xpc3QiKToKICAgICAgICAgICAgICAgIGdyZWVuX2xpc3QgPSBoYXNoTWFwLmdldCgiZ3JlZW5fbGlzdCIpLnNwbGl0KCI7IikKICAgICAgICAgICAgICAgIGdyZWVuX2xpc3QuYXBwZW5kKG5vbV9iYXJjb2RlKQogICAgICAgICAgICAgICAgaGFzaE1hcC5wdXQoImdyZWVuX2xpc3QiLCAiOyIuam9pbihncmVlbl9saXN0KSkKCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBoYXNoTWFwLnB1dCgiZ3JlZW5fbGlzdCIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBub21fYmFyY29kZSkKCiAgICAgICAgICAgIGlmIGhhc2hNYXAuY29udGFpbnNLZXkoInllbGxvd19saXN0Iik6CiAgICAgICAgICAgICAgICB5ZWxsb3dfbGlzdCA9IGhhc2hNYXAuZ2V0KCJ5ZWxsb3dfbGlzdCIpLnNwbGl0KCI7IikKICAgICAgICAgICAgICAgIHllbGxvd19saXN0LnJlbW92ZShub21fYmFyY29kZSkKICAgICAgICAgICAgICAgIGhhc2hNYXAucHV0KCJ5ZWxsb3dfbGlzdCIsICI7Ii5qb2luKHllbGxvd19saXN0KSkKCiAgICAgICAgICAgICAgICAjINC00L7QsdCw0LLQu9GP0LXQvCDQsiDQsdCw0LfRgyAtINC+0L0g0L/QvtGB0YfQuNGC0LDQvQogICAgICAgICAgICB3aXRoIGRiX3Nlc3Npb246CiAgICAgICAgICAgICAgICBmb3VuZC5hcHBlbmQoaW50KGhhc2hNYXAuZ2V0KCJfbm9tX2lkIikpKQogICAgICAgICAgICAgICAgaW52ZW50b3J5ID0gdWlfZ2xvYmFsLlNXX0ludmVudG9yeVtpbnQoaGFzaE1hcC5nZXQoImludl9pZCIpKV0KICAgICAgICAgICAgICAgIHIgPSB1aV9nbG9iYWwuU1dfSW52ZW50b3J5X2xpbmUocXR5PTEsIHNrdT1pbnQoaGFzaE1hcC5nZXQoIl9ub21faWQiKSksIGNlbGw9Y2VsbGlkLCBpbnZlbnRvcnk9aW52ZW50b3J5KQogICAgICAgICAgICAgICAgY29tbWl0KCkKCiAgICAgICAgICAgIGdyZWVuX3NpemUgKz0gMQogICAgICAgICAgICBpbnZkYXRlID0gZGF0ZXRpbWUuZnJvbWlzb2Zvcm1hdChzdHIoaGFzaE1hcC5nZXQoImludl9kYXRlIikpKQogICAgICAgICAgICBoYXNoTWFwLnB1dCgiaW52IiwgItCY0L3QstC10L3RgtCw0YDQuNC30LDRhtC40Y8gIiArIHN0cihoYXNoTWFwLmdldCgiaW52X25hbWUiKSkgKyAiINC+0YIgIiArIGludmRhdGUuc3RyZnRpbWUoCiAgICAgICAgICAgICAgICAiJW0uJWQuJVksICVIOiVNOiVTIikgKyAiPC9uPiDQndCw0LnQtNC10L3QvjogPGJpZz4iICsgc3RyKGdyZWVuX3NpemUpICsgIjwvYmlnPiIgKyAiINC40LcgIiArICI8YmlnPiIgKyBzdHIoCiAgICAgICAgICAgICAgICB5ZWxsb3dfc2l6ZSkgKyAiPC9iaWc+IikKICAgICAgICBlbHNlOiAgIyDQvdC10YPQvdC40LrQsNC70YzQvdGL0Lkg0YjRgtGA0LjRhdC60L7QtCAtINC/0YDQvtGB0LjQvCDQstCy0LXRgdGC0Lgg0LrQvtC7LdCy0L4KICAgICAgICAgICAgaGFzaE1hcC5wdXQoImJlZXAiLCAiNTAiKQogICAgICAgICAgICBpZiBoYXNoTWFwLmNvbnRhaW5zS2V5KCd3cml0ZV9saXN0Jyk6ICAjINC10YHRgtGMINC70Lggd3JpdGVfbGlzdCDQsiBoYXNoTWFwCiAgICAgICAgICAgICAgICB3cml0ZV9saXN0ID0gaGFzaE1hcC5nZXQoIndyaXRlX2xpc3QiKS5zcGxpdCgiOyIpCiAgICAgICAgICAgICAgICB3cml0ZV9saXN0LmFwcGVuZChub21fYmFyY29kZSkgICMg0LTQvtCx0LDQstC40YLRjCBub21fYmFyY29kZSDQsiB3cml0ZV9saXN0CiAgICAgICAgICAgICAgICBoYXNoTWFwLnB1dCgid3JpdGVfbGlzdCIsICI7Ii5qb2luKHdyaXRlX2xpc3QpKQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgaGFzaE1hcC5wdXQoIndyaXRlX2xpc3QiLCBub21fYmFyY29kZSkKCiAgICAgICAgICAgIGhhc2hNYXAucHV0KCJub20iLCBub21fcmVjb3JkLmdldCgiaW5mbyIpKQogICAgICAgICAgICBoYXNoTWFwLnB1dCgibm9tX2JhcmNvZGUiLCBub21fYmFyY29kZSkKICAgICAgICAgICAgaGFzaE1hcC5wdXQoIlNob3dEaWFsb2dQcm9jZXNzIiwgItCY0L3QstC10L3RgtCw0YDQuNC30LDRhtC40Y8gQWN0aXZlIENWIikKICAgICAgICAgICAgaGFzaE1hcC5wdXQoIlNob3dEaWFsb2ciLCAi0JTQuNCw0LvQvtCz0JLQstC+0LTQmtC+0LvQuNGH0LXRgdGC0LLQsCIpCiAgICAgICAgICAgIGhhc2hNYXAucHV0KCJTaG93RGlhbG9nU3R5bGUiLAogICAgICAgICAgICAgICAgICAgICAgICBqc29uLmR1bXBzKHsidGl0bGUiOiAi0JLQstC10LTQuNGC0LUg0LrQvtC70LjRh9C10YHRgtCy0L4g0YTQsNC60YIiLCAieWVzIjogItCf0L7QtNGC0LLQtdGA0LTQuNGC0YwiLCAibm8iOiAi0J7RgtC80LXQvdCwIn0pKQoKICAgIHJldHVybiBoYXNoTWFwCgoKZGVmIGludmN2X2dvb2RzX2FjdGlvbihoYXNoTWFwLCBfZmlsZXM9Tm9uZSwgX2RhdGE9Tm9uZSk6CiAgICBnbG9iYWwgY2VsbGlkCiAgICBnbG9iYWwgZ3JlZW5fc2l6ZSwgeWVsbG93X3NpemUKCiAgICAjIGhhc2hNYXAucHV0KCJ0b2FzdCIsc3RyKGhhc2hNYXAuZ2V0KCJldmVudCIpKSkKCiAgICBpZiBoYXNoTWFwLmdldCgibGlzdGVuZXIiKSA9PSAib25SZXN1bHRQb3NpdGl2ZSI6IyDQsiDQtNC40LDQu9C+0LPQtSDQstCy0L7QtNCwINC60L7Qu9C40YfQtdGB0YLQstCwIC0gItCe0LoiCgogICAgICAgIGhhc2hNYXAucHV0KCJ2aWJyYXRlIiwgIiIpCgogICAgICAgIGlmIGhhc2hNYXAuY29udGFpbnNLZXkoJ3dyaXRlX2xpc3QnKTogICMg0LXRgdGC0Ywg0LvQuCB3cml0ZV9saXN0INCyIGhhc2hNYXAKICAgICAgICAgICAgd3JpdGVfbGlzdCA9IGhhc2hNYXAuZ2V0KCJ3cml0ZV9saXN0Iikuc3BsaXQoIjsiKQogICAgICAgICAgICBub21fYmFyY29kZV93cml0ZSA9IHN0cih3cml0ZV9saXN0Wy0xXSkKICAgICAgICAgICAgd3JpdGVfbGlzdC5yZW1vdmUobm9tX2JhcmNvZGVfd3JpdGUpCiAgICAgICAgICAgIGhhc2hNYXAucHV0KCJ3cml0ZV9saXN0IiwgIjsiLmpvaW4od3JpdGVfbGlzdCkpCgogICAgICAgIGVsc2U6CiAgICAgICAgICAgIG5vbV9iYXJjb2RlX3dyaXRlID0gc3RyKGhhc2hNYXAuZ2V0KCJjdXJyZW50X29iamVjdCIpKQogICAgICAgICMg0L/QtdGA0LXQutGA0LDRiNC40LLQsNC10Lwg0LIg0LfQtdC70LXQvdGL0LkKCiAgICAgICAgaWYgaGFzaE1hcC5jb250YWluc0tleSgiZ3JlZW5fbGlzdCIpOgogICAgICAgICAgICBncmVlbl9saXN0ID0gaGFzaE1hcC5nZXQoImdyZWVuX2xpc3QiKS5zcGxpdCgiOyIpCiAgICAgICAgICAgIGdyZWVuX2xpc3QuYXBwZW5kKG5vbV9iYXJjb2RlX3dyaXRlKQogICAgICAgICAgICBoYXNoTWFwLnB1dCgiZ3JlZW5fbGlzdCIsICI7Ii5qb2luKGdyZWVuX2xpc3QpKQoKICAgICAgICBlbHNlOgogICAgICAgICAgICBoYXNoTWFwLnB1dCgiZ3JlZW5fbGlzdCIsIG5vbV9iYXJjb2RlX3dyaXRlKQoKICAgICAgICBpZiBoYXNoTWFwLmNvbnRhaW5zS2V5KCJ5ZWxsb3dfbGlzdCIpIGFuZCBub21fYmFyY29kZV93cml0ZSBpbiBoYXNoTWFwLmdldCgieWVsbG93X2xpc3QiKToKICAgICAgICAgICAgeWVsbG93X2xpc3QgPSBoYXNoTWFwLmdldCgieWVsbG93X2xpc3QiKS5zcGxpdCgiOyIpCiAgICAgICAgICAgIHllbGxvd19saXN0LnJlbW92ZShub21fYmFyY29kZV93cml0ZSkgICMgVmFsdWVFcnJvcjogbGlzdC5yZW1vdmUoeCk6IHggbm90IGluIGxpc3QKICAgICAgICAgICAgaGFzaE1hcC5wdXQoInllbGxvd19saXN0IiwgIjsiLmpvaW4oeWVsbG93X2xpc3QpKQoKICAgICAgICAj0L7Qv9GA0LXQtNC10LvRj9C10LwgSUQKICAgICAgICBpZiBoYXNoTWFwLmNvbnRhaW5zS2V5KCd3cml0ZV9pZF9saXN0Jyk6ICAjINC10YHRgtGMINC70Lggd3JpdGVfaWRfbGlzdCDQsiBoYXNoTWFwCiAgICAgICAgICAgIHdyaXRlX2lkX2xpc3QgPSBoYXNoTWFwLmdldCgid3JpdGVfaWRfbGlzdCIpLnNwbGl0KCI7IikKICAgICAgICAgICAgX25vbV9pZCA9IHN0cih3cml0ZV9pZF9saXN0Wy0xXSkKICAgICAgICAgICAgd3JpdGVfaWRfbGlzdC5yZW1vdmUoX25vbV9pZCkKICAgICAgICAgICAgaGFzaE1hcC5wdXQoIndyaXRlX2lkX2xpc3QiLCAiOyIuam9pbih3cml0ZV9pZF9saXN0KSkKCiAgICAgICAgZWxzZToKICAgICAgICAgICAgX25vbV9pZCA9IHN0cihoYXNoTWFwLmdldCgnX25vbV9pZCcpKQoKICAgICAgICAgICAgIyDQtNC+0LHQsNCy0LvRj9C10Lwg0LIg0LHQsNC30YMKICAgICAgICBpZiBnZXRmbG9hdF9pZl9leGlzdChoYXNoTWFwLCAicXR5IikgPiAwOgogICAgICAgICAgICB3aXRoIGRiX3Nlc3Npb246CiAgICAgICAgICAgICAgICBpbnZlbnRvcnkgPSB1aV9nbG9iYWwuU1dfSW52ZW50b3J5W2ludChoYXNoTWFwLmdldCgiaW52X2lkIikpXQogICAgICAgICAgICAgICAgciA9IHVpX2dsb2JhbC5TV19JbnZlbnRvcnlfbGluZShxdHk9Z2V0ZmxvYXRfaWZfZXhpc3QoaGFzaE1hcCwgInF0eSIpLCBza3U9aW50KF9ub21faWQpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjZWxsPWNlbGxpZCwgaW52ZW50b3J5PWludmVudG9yeSkKICAgICAgICAgICAgICAgIGNvbW1pdCgpCiAgICAgICAgICAgICAgICBmb3VuZC5hcHBlbmQoaW50KF9ub21faWQpKQogICAgICAgICAgICAgICAgZ3JlZW5fc2l6ZSArPSAxCiAgICAgICAgICAgICAgICBpbnZkYXRlID0gZGF0ZXRpbWUuZnJvbWlzb2Zvcm1hdChzdHIoaGFzaE1hcC5nZXQoImludl9kYXRlIikpKQogICAgICAgICAgICAgICAgaGFzaE1hcC5wdXQoImludiIsICLQmNC90LLQtdC90YLQsNGA0LjQt9Cw0YbQuNGPICIgKyBzdHIoaGFzaE1hcC5nZXQoImludl9uYW1lIikpICsgIiDQvtGCICIgKyBpbnZkYXRlLnN0cmZ0aW1lKAogICAgICAgICAgICAgICAgICAgICIlbS4lZC4lWSwgJUg6JU06JVMiKSArICI8L24+INCd0LDQudC00LXQvdC+OiA8YmlnPiIgKyBzdHIoCiAgICAgICAgICAgICAgICAgICAgZ3JlZW5fc2l6ZSkgKyAiPC9iaWc+IiArICIg0LjQtyA6IiArICI8YmlnPiIgKyBzdHIoeWVsbG93X3NpemUpICsgIjwvYmlnPiIpCgogICAgaWYgaGFzaE1hcC5nZXQoImxpc3RlbmVyIikgPT0gItCaINCv0KfQldCZ0JrQlSI6CiAgICAgICAgaGFzaE1hcC5wdXQoIk5leHRTdGVwIiwgItCS0YvQsdC+0YAg0Y/Rh9C10LnQutC4IikKICAgICAgICBpbnZkYXRlID0gZGF0ZXRpbWUuZnJvbWlzb2Zvcm1hdChzdHIoaGFzaE1hcC5nZXQoImludl9kYXRlIikpKQogICAgICAgIGhhc2hNYXAucHV0KCJpbnYiLAogICAgICAgICAgICAgICAgICAgICLQmNC90LLQtdC90YLQsNGA0LjQt9Cw0YbQuNGPICIgKyBzdHIoaGFzaE1hcC5nZXQoImludl9uYW1lIikpICsgIiDQvtGCICIgKyBpbnZkYXRlLnN0cmZ0aW1lKCIlbS4lZC4lWSwgJUg6JU06JVMiKSkKCiAgICByZXR1cm4gaGFzaE1hcAoKCgojIC1FTkQgQ1VTVE9NIEhBTkRMRVJTCgoKCkBhcHAucm91dGUoJy9zZXRfaW5wdXRfZGlyZWN0LzxtZXRob2Q+JywgbWV0aG9kcz1bJ1BPU1QnXSkKZGVmIHNldF9pbnB1dChtZXRob2QpOgogICAgI2Z1bmMgPSBtZXRob2QKICAgIGZ1bmMgPSBtZXRob2QucmVwbGFjZSgnXycsICcnLCAxKQogICAgamRhdGEgPSBqc29uLmxvYWRzKHJlcXVlc3QuZGF0YS5kZWNvZGUoJ3V0Zi04JykpCiAgICBmID0gZ2xvYmFscygpW2Z1bmNdCiAgICBoYXNoTWFwLmQgPSBqZGF0YVsnaGFzaG1hcCddCiAgICAjIGYoKQogICAgIyBmKCdoYXNobWFwJykKICAgIGYoaGFzaE1hcCkgICMgbmV3CiAgICBqZGF0YVsnaGFzaG1hcCddID0gaGFzaE1hcC5leHBvcnQoKQogICAgamRhdGFbJ3N0b3AnXSA9IEZhbHNlCiAgICBqZGF0YVsnRXJyb3JNZXNzYWdlJ10gPSAnJwogICAgamRhdGFbJ1Jvd3MnXSA9IFtdCgogICAgcmV0dXJuIGpzb24uZHVtcHMoamRhdGEpCgoKQGFwcC5yb3V0ZSgnL3Bvc3Rfc2NyZWVuc2hvdCcsIG1ldGhvZHM9WydQT1NUJ10pCmRlZiBwb3N0X3NjcmVlbnNob3QoKToKICAgIGQgPSByZXF1ZXN0LmRhdGEKICAgIHJldHVybiAnMScKCgpjbGFzcyBoYXNoTWFwOgogICAgZCA9IHt9CgogICAgZGVmIHB1dChrZXksIHZhbCk6CiAgICAgICAgaGFzaE1hcC5kW2tleV0gPSB2YWwKCiAgICBkZWYgZ2V0KGtleSk6CiAgICAgICAgcmV0dXJuIGhhc2hNYXAuZC5nZXQoa2V5KQoKICAgIGRlZiByZW1vdmUoa2V5KToKICAgICAgICBpZiBrZXkgaW4gaGFzaE1hcC5kOgogICAgICAgICAgICBoYXNoTWFwLmQucG9wKGtleSkKCiAgICBkZWYgY29udGFpbnNLZXkoa2V5KToKICAgICAgICByZXR1cm4ga2V5IGluIGhhc2hNYXAuZAoKICAgIGRlZiBleHBvcnQoKTogICMgSXQncyBOT1QgZXJyb3IhISEKICAgICAgICBleF9oYXNoTWFwID0gW10KICAgICAgICBmb3Iga2V5IGluIGhhc2hNYXAuZC5rZXlzKCk6CiAgICAgICAgICAgIGV4X2hhc2hNYXAuYXBwZW5kKHsna2V5Jzoga2V5LCAndmFsdWUnOiBoYXNoTWFwLmRba2V5XX0pCiAgICAgICAgcmV0dXJuIGV4X2hhc2hNYXAKCgppZiBfX25hbWVfXyA9PSAnX19tYWluX18nOgogICAgaW5pdF9vbl9zdGFydCgpICAjIG5ldwogICAgYXBwLnJ1bihob3N0PScwLjAuMC4wJywgcG9ydD0yMDc1LCBkZWJ1Zz1UcnVlKQo=",
        "PyFiles": [],
        "PyTimerTask": [],
        "RecognitionTemplates": [
            {
                "name": "Распознавание артикула",
                "TypeRecognition": "Распознавание текста",
                "mesure_qty": "1",
                "min_freq": "1",
                "min_length": "3",
                "max_length": "15",
                "query": "c2VsZWN0ICogZnJvbSBTV19Hb29kcyB3aGVyZSBwcm9kdWN0X251bWJlciBsaWtlICA/",
                "ReplaceO": true,
                "ToUpcase": false,
                "control_field": "product_number",
                "result_field": "id",
                "cursor": [
                    {
                        "title": "id",
                        "var": "_nom_id",
                        "field": "id"
                    }
                ],
                "result_var": "_nom_id"
            }
        ],
        "MainMenu": [
            {
                "MenuItem": "1",
                "MenuTitle": " ",
                "MenuId": "1",
                "MenuTop": true
            }
        ]
    }
}