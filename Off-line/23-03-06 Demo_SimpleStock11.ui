{
    "ClientConfiguration": {
        "ConfigurationName": "Простой склад",
        "ConfigurationDescription": "Автономное решение для простейшего учета",
        "ConfigurationVersion": "0.9.3",
        "Processes": [
            {
                "type": "Process",
                "ProcessName": "Справочник товаров",
                "PlanFactHeader": "План-факт",
                "DefineOnBackPressed": true,
                "hidden": false,
                "login_screen": false,
                "SC": false,
                "Operations": [
                    {
                        "type": "Operation",
                        "Name": "Меню НСИ",
                        "Timer": false,
                        "hideToolBarScreen": false,
                        "noScroll": true,
                        "handleKeyUp": false,
                        "noConfirmation": true,
                        "hideBottomBarScreen": true,
                        "onlineOnStart": false,
                        "send_when_opened": true,
                        "onlineOnInput": false,
                        "DefOnlineOnCreate": "",
                        "DefOnlineOnInput": "",
                        "DefOnCreate": "menu_on_start",
                        "DefOnInput": "menu_input",
                        "Elements": [
                            {
                                "Value": "",
                                "Variable": "",
                                "type": "LinearLayout",
                                "weight": "0",
                                "height": "match_parent",
                                "width": "match_parent",
                                "orientation": "vertical",
                                "Elements": [
                                    {
                                        "type": "CButtons",
                                        "height": "match_parent",
                                        "width": "match_parent",
                                        "weight": "0",
                                        "Value": "Добавить товар;Добавить ячейку;Добавить группу товаров;Добавить единицу измерения",
                                        "Variable": "menu"
                                    }
                                ]
                            }
                        ],
                        "onlineOnAfterStart": false
                    },
                    {
                        "Name": "ДиалогЕдиницы",
                        "type": "Operation",
                        "Elements": [
                            {
                                "Value": "",
                                "Variable": "",
                                "type": "LinearLayout",
                                "weight": "0",
                                "height": "wrap_content",
                                "width": "match_parent",
                                "orientation": "vertical",
                                "Elements": [
                                    {
                                        "type": "TextView",
                                        "height": "wrap_content",
                                        "width": "match_parent",
                                        "weight": "0",
                                        "Value": "Название",
                                        "Variable": "",
                                        "TextBold": true,
                                        "BackgroundColor": "",
                                        "TextSize": "17",
                                        "TextColor": "#696969"
                                    },
                                    {
                                        "type": "EditTextText",
                                        "height": "wrap_content",
                                        "width": "match_parent",
                                        "weight": "0",
                                        "Value": "@name",
                                        "Variable": "name",
                                        "gravity_horizontal": "left",
                                        "TextSize": "17"
                                    }
                                ]
                            }
                        ],
                        "Timer": false,
                        "hideToolBarScreen": false,
                        "noScroll": false,
                        "handleKeyUp": false,
                        "hideBottomBarScreen": true,
                        "onlineOnStart": false,
                        "onlineOnInput": false,
                        "onlineOnAfterStart": false
                    },
                    {
                        "Name": "Добавить товар",
                        "type": "Operation",
                        "Elements": [
                            {
                                "Value": "",
                                "Variable": "",
                                "type": "LinearLayout",
                                "weight": "0",
                                "height": "match_parent",
                                "width": "match_parent",
                                "orientation": "vertical",
                                "Elements": [
                                    {
                                        "type": "LinearLayout",
                                        "height": "wrap_content",
                                        "width": "match_parent",
                                        "weight": "0",
                                        "Value": "Добавить",
                                        "Variable": "btn_add",
                                        "orientation": "horizontal",
                                        "Elements": [
                                            {
                                                "type": "Button",
                                                "height": "wrap_content",
                                                "width": "match_parent",
                                                "weight": "1",
                                                "Value": "#f055",
                                                "Variable": "btn_add",
                                                "TextSize": "25",
                                                "BackgroundColor": "#3CB371"
                                            }
                                        ]
                                    },
                                    {
                                        "type": "CardsLayout",
                                        "height": "match_parent",
                                        "width": "match_parent",
                                        "weight": "0",
                                        "Value": "@list",
                                        "Variable": ""
                                    }
                                ],
                                "BackgroundColor": "",
                                "StrokeWidth": "",
                                "Padding": ""
                            },
                            {
                                "Value": "",
                                "Variable": "barcode_search",
                                "type": "barcode"
                            }
                        ],
                        "Timer": false,
                        "hideToolBarScreen": false,
                        "noScroll": false,
                        "handleKeyUp": false,
                        "hideBottomBarScreen": true,
                        "onlineOnStart": false,
                        "onlineOnInput": false,
                        "DefOnCreate": "goods_on_start",
                        "DefOnInput": "goods_input",
                        "noConfirmation": true,
                        "send_when_opened": true,
                        "onlineOnAfterStart": false
                    },
                    {
                        "Name": "ТоварыЗапись",
                        "type": "Operation",
                        "Elements": [
                            {
                                "Value": "",
                                "Variable": "",
                                "type": "LinearLayout",
                                "weight": "0",
                                "height": "match_parent",
                                "width": "match_parent",
                                "orientation": "vertical",
                                "Elements": [
                                    {
                                        "type": "TextView",
                                        "height": "wrap_content",
                                        "width": "match_parent",
                                        "weight": "0",
                                        "Value": "Удалить карточку товара",
                                        "Variable": "",
                                        "gravity_horizontal": "right",
                                        "TextSize": "",
                                        "TextBold": true,
                                        "TextItalic": true
                                    },
                                    {
                                        "type": "Button",
                                        "height": "wrap_content",
                                        "width": "match_parent",
                                        "weight": "0",
                                        "Value": "Сохранить...",
                                        "Variable": "btn_save",
                                        "BackgroundColor": "#E4D00A"
                                    },
                                    {
                                        "type": "ModernEditText",
                                        "height": "wrap_content",
                                        "width": "match_parent",
                                        "weight": "0",
                                        "Value": "@fill_name",
                                        "Variable": "name"
                                    },
                                    {
                                        "type": "ModernEditText",
                                        "height": "wrap_content",
                                        "width": "match_parent",
                                        "weight": "0",
                                        "Value": "@fill_product_number",
                                        "Variable": "product_number"
                                    },
                                    {
                                        "type": "ModernEditText",
                                        "height": "wrap_content",
                                        "width": "match_parent",
                                        "weight": "0",
                                        "Value": "@fill_price",
                                        "Variable": "price",
                                        "TextBold": true
                                    },
                                    {
                                        "type": "TextView",
                                        "height": "wrap_content",
                                        "width": "match_parent",
                                        "weight": "0",
                                        "Value": "Единица",
                                        "Variable": "",
                                        "TextBold": false
                                    },
                                    {
                                        "type": "SpinnerLayout",
                                        "height": "wrap_content",
                                        "width": "match_parent",
                                        "weight": "0",
                                        "Value": "@units",
                                        "Variable": "unit"
                                    },
                                    {
                                        "type": "ModernEditText",
                                        "height": "wrap_content",
                                        "width": "match_parent",
                                        "weight": "0",
                                        "Value": "@fill_barcode",
                                        "Variable": "barcode"
                                    },
                                    {
                                        "type": "TextView",
                                        "height": "wrap_content",
                                        "width": "match_parent",
                                        "weight": "0",
                                        "Value": "Группа",
                                        "Variable": ""
                                    },
                                    {
                                        "type": "SpinnerLayout",
                                        "height": "wrap_content",
                                        "width": "match_parent",
                                        "weight": "0",
                                        "Value": "@groups",
                                        "Variable": "group"
                                    },
                                    {
                                        "type": "TextView",
                                        "height": "wrap_content",
                                        "width": "match_parent",
                                        "weight": "1",
                                        "Value": "Сделать фото... Выбрать из галереи...",
                                        "Variable": "",
                                        "height_value": "0",
                                        "gravity_horizontal": "left"
                                    }
                                ],
                                "BackgroundColor": "",
                                "StrokeWidth": "",
                                "Padding": ""
                            },
                            {
                                "Value": "#f2ed",
                                "Variable": "menu_del",
                                "type": "MenuItem"
                            },
                            {
                                "Value": "@photoGallery",
                                "Variable": "photoGallery",
                                "type": "HorizontalGallery"
                            },
                            {
                                "Value": "",
                                "Variable": "photo",
                                "type": "photoGallery"
                            },
                            {
                                "Value": "",
                                "Variable": "barcode_nom",
                                "type": "barcode"
                            },
                            {
                                "Value": "",
                                "Variable": "photo",
                                "type": "photo"
                            }
                        ],
                        "Timer": false,
                        "hideToolBarScreen": false,
                        "noScroll": true,
                        "handleKeyUp": false,
                        "hideBottomBarScreen": true,
                        "onlineOnStart": false,
                        "onlineOnInput": false,
                        "DefOnCreate": "goods_record_on_start",
                        "DefOnInput": "goods_record_input",
                        "noConfirmation": true,
                        "send_when_opened": true,
                        "onlineOnAfterStart": false
                    },
                    {
                        "Name": "ДиалогГруппы",
                        "type": "Operation",
                        "Elements": [
                            {
                                "Value": "",
                                "Variable": "",
                                "type": "LinearLayout",
                                "weight": "0",
                                "height": "wrap_content",
                                "width": "match_parent",
                                "orientation": "vertical",
                                "Elements": [
                                    {
                                        "type": "TextView",
                                        "height": "wrap_content",
                                        "width": "match_parent",
                                        "weight": "0",
                                        "Value": "Название",
                                        "Variable": "",
                                        "TextBold": true,
                                        "BackgroundColor": "",
                                        "TextSize": "17",
                                        "TextColor": "#696969"
                                    },
                                    {
                                        "type": "EditTextText",
                                        "height": "wrap_content",
                                        "width": "match_parent",
                                        "weight": "0",
                                        "Value": "@name",
                                        "Variable": "name",
                                        "gravity_horizontal": "left",
                                        "TextSize": "17"
                                    }
                                ]
                            }
                        ],
                        "Timer": false,
                        "hideToolBarScreen": false,
                        "noScroll": false,
                        "handleKeyUp": false,
                        "hideBottomBarScreen": true,
                        "onlineOnStart": false,
                        "onlineOnInput": false,
                        "onlineOnAfterStart": false
                    },
                    {
                        "Name": "Добавить ячейку",
                        "type": "Operation",
                        "Elements": [
                            {
                                "Value": "",
                                "Variable": "",
                                "type": "LinearLayout",
                                "weight": "0",
                                "height": "match_parent",
                                "width": "match_parent",
                                "orientation": "vertical",
                                "Elements": [
                                    {
                                        "type": "LinearLayout",
                                        "height": "wrap_content",
                                        "width": "match_parent",
                                        "weight": "0",
                                        "Value": "Добавить",
                                        "Variable": "btn_add",
                                        "orientation": "horizontal",
                                        "Elements": [
                                            {
                                                "type": "Button",
                                                "height": "wrap_content",
                                                "width": "match_parent",
                                                "weight": "1",
                                                "Value": "#f055",
                                                "Variable": "btn_add",
                                                "TextSize": "25",
                                                "BackgroundColor": "#3CB371"
                                            }
                                        ]
                                    },
                                    {
                                        "type": "CardsLayout",
                                        "height": "match_parent",
                                        "width": "match_parent",
                                        "weight": "0",
                                        "Value": "@list",
                                        "Variable": ""
                                    }
                                ]
                            }
                        ],
                        "Timer": false,
                        "hideToolBarScreen": false,
                        "noScroll": false,
                        "handleKeyUp": false,
                        "hideBottomBarScreen": true,
                        "onlineOnStart": false,
                        "onlineOnInput": false,
                        "DefOnCreate": "cells_on_start",
                        "DefOnInput": "cells_input",
                        "send_when_opened": true,
                        "onlineOnAfterStart": false
                    },
                    {
                        "Name": "ЯчейкиЗапись",
                        "type": "Operation",
                        "Elements": [
                            {
                                "Value": "",
                                "Variable": "",
                                "type": "LinearLayout",
                                "weight": "0",
                                "height": "match_parent",
                                "width": "match_parent",
                                "orientation": "vertical",
                                "Elements": [
                                    {
                                        "type": "Button",
                                        "height": "wrap_content",
                                        "width": "match_parent",
                                        "weight": "0",
                                        "Value": "Сохранить...",
                                        "Variable": "btn_save",
                                        "BackgroundColor": "#E4D00A"
                                    },
                                    {
                                        "type": "ModernEditText",
                                        "height": "wrap_content",
                                        "width": "match_parent",
                                        "weight": "0",
                                        "Value": "@fill_name",
                                        "Variable": "name"
                                    },
                                    {
                                        "type": "ModernEditText",
                                        "height": "wrap_content",
                                        "width": "match_parent",
                                        "weight": "0",
                                        "Value": "@fill_barcode",
                                        "Variable": "barcode"
                                    }
                                ]
                            },
                            {
                                "Value": "#f2ed",
                                "Variable": "menu_del",
                                "type": "MenuItem"
                            },
                            {
                                "Value": "",
                                "Variable": "barcode_cell",
                                "type": "barcode"
                            }
                        ],
                        "Timer": false,
                        "hideToolBarScreen": false,
                        "noScroll": true,
                        "handleKeyUp": false,
                        "hideBottomBarScreen": true,
                        "onlineOnStart": false,
                        "onlineOnInput": false,
                        "DefOnCreate": "cells_record_on_start",
                        "DefOnInput": "cells_record_input",
                        "noConfirmation": true,
                        "send_when_opened": true,
                        "onlineOnAfterStart": false
                    },
                    {
                        "Name": "Добавить группу товаров",
                        "type": "Operation",
                        "Elements": [
                            {
                                "Value": "",
                                "Variable": "",
                                "type": "LinearLayout",
                                "weight": "0",
                                "height": "match_parent",
                                "width": "match_parent",
                                "orientation": "vertical",
                                "Elements": [
                                    {
                                        "type": "LinearLayout",
                                        "height": "wrap_content",
                                        "width": "match_parent",
                                        "weight": "0",
                                        "Value": "Добавить",
                                        "Variable": "btn_add",
                                        "orientation": "horizontal",
                                        "Elements": [
                                            {
                                                "type": "Button",
                                                "height": "wrap_content",
                                                "width": "match_parent",
                                                "weight": "1",
                                                "Value": "#f055",
                                                "Variable": "btn_add",
                                                "TextSize": "25",
                                                "BackgroundColor": "#3CB371"
                                            }
                                        ]
                                    },
                                    {
                                        "type": "TableLayout",
                                        "height": "match_parent",
                                        "width": "match_parent",
                                        "weight": "0",
                                        "Value": "@list",
                                        "Variable": ""
                                    }
                                ]
                            }
                        ],
                        "Timer": false,
                        "hideToolBarScreen": false,
                        "noScroll": true,
                        "handleKeyUp": false,
                        "hideBottomBarScreen": true,
                        "onlineOnStart": false,
                        "onlineOnInput": false,
                        "DefOnInput": "groups_input",
                        "DefOnCreate": "groups_on_start",
                        "send_when_opened": true,
                        "onlineOnAfterStart": false
                    },
                    {
                        "Name": "Добавить единицу измерения",
                        "type": "Operation",
                        "Elements": [
                            {
                                "Value": "",
                                "Variable": "",
                                "type": "LinearLayout",
                                "weight": "0",
                                "height": "match_parent",
                                "width": "match_parent",
                                "orientation": "vertical",
                                "Elements": [
                                    {
                                        "type": "LinearLayout",
                                        "height": "wrap_content",
                                        "width": "match_parent",
                                        "weight": "0",
                                        "Value": "Добавить",
                                        "Variable": "btn_add",
                                        "orientation": "horizontal",
                                        "Elements": [
                                            {
                                                "type": "Button",
                                                "height": "wrap_content",
                                                "width": "match_parent",
                                                "weight": "1",
                                                "Value": "#f055",
                                                "Variable": "btn_add",
                                                "TextSize": "25",
                                                "BackgroundColor": "#3CB371"
                                            }
                                        ]
                                    },
                                    {
                                        "type": "TableLayout",
                                        "height": "match_parent",
                                        "width": "match_parent",
                                        "weight": "0",
                                        "Value": "@list",
                                        "Variable": ""
                                    }
                                ]
                            }
                        ],
                        "Timer": false,
                        "hideToolBarScreen": false,
                        "noScroll": true,
                        "handleKeyUp": false,
                        "hideBottomBarScreen": true,
                        "onlineOnStart": false,
                        "onlineOnInput": false,
                        "DefOnInput": "units_input",
                        "DefOnCreate": "units_on_start",
                        "send_when_opened": true,
                        "onlineOnAfterStart": false
                    }
                ]
            },
            {
                "ProcessName": "Приемка",
                "type": "Process",
                "Operations": [
                    {
                        "Name": "Выбор ячейки",
                        "type": "Operation",
                        "Elements": [
                            {
                                "Value": "",
                                "Variable": "",
                                "type": "LinearLayout",
                                "weight": "0",
                                "height": "match_parent",
                                "width": "match_parent",
                                "orientation": "vertical",
                                "Elements": [
                                    {
                                        "type": "TextView",
                                        "height": "wrap_content",
                                        "width": "match_parent",
                                        "weight": "0",
                                        "Value": "Сканируйте или выберите ячейку",
                                        "Variable": "",
                                        "BackgroundColor": "#3B5958",
                                        "TextSize": "20",
                                        "TextColor": "#FFFFFF",
                                        "TextBold": true
                                    },
                                    {
                                        "type": "SpinnerLayout",
                                        "height": "wrap_content",
                                        "width": "match_parent",
                                        "weight": "0",
                                        "Value": "@cells",
                                        "Variable": "cell"
                                    }
                                ],
                                "BackgroundColor": "",
                                "StrokeWidth": "",
                                "Padding": ""
                            },
                            {
                                "Value": "",
                                "Variable": "barcode_cell",
                                "type": "barcode"
                            },
                            {
                                "Value": "",
                                "Variable": "",
                                "type": "LinearLayout",
                                "weight": "0",
                                "height": "wrap_content",
                                "width": "wrap_content",
                                "orientation": "vertical",
                                "Elements": [
                                    {
                                        "type": "TextView",
                                        "height": "match_parent",
                                        "width": "match_parent",
                                        "weight": "0",
                                        "Value": " ",
                                        "Variable": "",
                                        "TextSize": "72"
                                    },
                                    {
                                        "type": "TextView",
                                        "height": "match_parent",
                                        "width": "match_parent",
                                        "weight": "0",
                                        "Value": " ",
                                        "Variable": "",
                                        "TextSize": "72"
                                    },
                                    {
                                        "type": "TextView",
                                        "height": "match_parent",
                                        "width": "match_parent",
                                        "weight": "0",
                                        "Value": " ",
                                        "Variable": "",
                                        "TextSize": "72"
                                    },
                                    {
                                        "type": "TextView",
                                        "height": "match_parent",
                                        "width": "match_parent",
                                        "weight": "0",
                                        "Value": " ",
                                        "Variable": "",
                                        "TextSize": "53"
                                    },
                                    {
                                        "type": "TextView",
                                        "height": "wrap_content",
                                        "width": "match_parent",
                                        "weight": "0",
                                        "Value": "Сканируйте штрихкод камерой устройства",
                                        "Variable": "",
                                        "TextSize": "15",
                                        "gravity_horizontal": "right",
                                        "TextBold": true,
                                        "TextItalic": true
                                    }
                                ],
                                "BackgroundColor": "",
                                "StrokeWidth": "",
                                "Padding": ""
                            }
                        ],
                        "Timer": false,
                        "hideToolBarScreen": false,
                        "noScroll": false,
                        "handleKeyUp": false,
                        "hideBottomBarScreen": true,
                        "onlineOnStart": false,
                        "onlineOnInput": false,
                        "DefOnCreate": "income_cell_on_start",
                        "DefOnInput": "income_cell_on_input",
                        "send_when_opened": true,
                        "onlineOnAfterStart": false
                    },
                    {
                        "Name": "Выбор товара",
                        "type": "Operation",
                        "Elements": [
                            {
                                "Value": "",
                                "Variable": "",
                                "type": "LinearLayout",
                                "weight": "0",
                                "height": "match_parent",
                                "width": "match_parent",
                                "orientation": "vertical",
                                "Elements": [
                                    {
                                        "type": "TextView",
                                        "height": "wrap_content",
                                        "width": "match_parent",
                                        "weight": "0",
                                        "Value": "Сканируйте товар",
                                        "Variable": "",
                                        "BackgroundColor": "#3B5958",
                                        "TextSize": "20",
                                        "TextColor": "#FFFFFF",
                                        "TextBold": true
                                    },
                                    {
                                        "type": "TextView",
                                        "height": "wrap_content",
                                        "width": "match_parent",
                                        "weight": "0",
                                        "Value": "Ячейка",
                                        "Variable": "",
                                        "TextSize": "20"
                                    },
                                    {
                                        "type": "TextView",
                                        "height": "wrap_content",
                                        "width": "match_parent",
                                        "weight": "0",
                                        "Value": "@cell",
                                        "Variable": "",
                                        "TextBold": true,
                                        "TextSize": "22"
                                    },
                                    {
                                        "type": "TextView",
                                        "height": "wrap_content",
                                        "width": "match_parent",
                                        "weight": "0",
                                        "Value": "Товары в ячейке",
                                        "Variable": ""
                                    },
                                    {
                                        "type": "TableLayout",
                                        "height": "match_parent",
                                        "width": "match_parent",
                                        "weight": "0",
                                        "Value": "@table_object",
                                        "Variable": ""
                                    }
                                ],
                                "BackgroundColor": "",
                                "StrokeWidth": "",
                                "Padding": ""
                            },
                            {
                                "Value": "",
                                "Variable": "barcode",
                                "type": "barcode"
                            }
                        ],
                        "Timer": false,
                        "hideToolBarScreen": false,
                        "noScroll": false,
                        "handleKeyUp": false,
                        "hideBottomBarScreen": true,
                        "onlineOnStart": false,
                        "onlineOnInput": false,
                        "DefOnCreate": "",
                        "DefOnInput": "income_nom_input",
                        "onlineOnAfterStart": false
                    },
                    {
                        "Name": "Ввод количества",
                        "type": "Operation",
                        "Elements": [
                            {
                                "Value": "",
                                "Variable": "",
                                "type": "LinearLayout",
                                "weight": "0",
                                "height": "match_parent",
                                "width": "match_parent",
                                "orientation": "vertical",
                                "Elements": [
                                    {
                                        "type": "TextView",
                                        "height": "wrap_content",
                                        "width": "match_parent",
                                        "weight": "0",
                                        "Value": "Укажите количество",
                                        "Variable": "",
                                        "BackgroundColor": "#3B5958",
                                        "TextSize": "20",
                                        "TextColor": "#FFFFFF",
                                        "TextBold": true
                                    },
                                    {
                                        "type": "TextView",
                                        "height": "wrap_content",
                                        "width": "match_parent",
                                        "weight": "0",
                                        "Value": "Ячейка",
                                        "Variable": "",
                                        "TextSize": "20"
                                    },
                                    {
                                        "type": "TextView",
                                        "height": "wrap_content",
                                        "width": "match_parent",
                                        "weight": "0",
                                        "Value": "@cell",
                                        "Variable": "",
                                        "TextBold": true,
                                        "TextSize": "22"
                                    },
                                    {
                                        "type": "TextView",
                                        "height": "wrap_content",
                                        "width": "match_parent",
                                        "weight": "0",
                                        "Value": "Товар",
                                        "Variable": "",
                                        "TextSize": "20"
                                    },
                                    {
                                        "type": "TextView",
                                        "height": "wrap_content",
                                        "width": "match_parent",
                                        "weight": "0",
                                        "Value": "@nom",
                                        "Variable": "",
                                        "TextBold": true,
                                        "TextSize": "22"
                                    },
                                    {
                                        "type": "LinearLayout",
                                        "height": "wrap_content",
                                        "width": "match_parent",
                                        "weight": "0",
                                        "Value": "",
                                        "Variable": "",
                                        "orientation": "horizontal",
                                        "Elements": [
                                            {
                                                "type": "TextView",
                                                "height": "wrap_content",
                                                "width": "match_parent",
                                                "weight": "1",
                                                "Value": "Кол-во",
                                                "Variable": ""
                                            },
                                            {
                                                "type": "EditTextNumeric",
                                                "height": "wrap_content",
                                                "width": "match_parent",
                                                "weight": "1",
                                                "Value": "@qty",
                                                "Variable": "qty",
                                                "BackgroundColor": "#F7ECEB",
                                                "TextBold": true
                                            }
                                        ]
                                    }
                                ]
                            }
                        ],
                        "Timer": false,
                        "hideToolBarScreen": false,
                        "noScroll": false,
                        "handleKeyUp": false,
                        "hideBottomBarScreen": true,
                        "onlineOnStart": false,
                        "onlineOnInput": false,
                        "DefOnInput": "income_qty_input",
                        "onlineOnAfterStart": false
                    }
                ],
                "PlanFactHeader": "Состав"
            },
            {
                "ProcessName": "Отгрузка",
                "type": "Process",
                "Operations": [
                    {
                        "Name": "Выбор ячейки",
                        "type": "Operation",
                        "Elements": [
                            {
                                "Value": "",
                                "Variable": "",
                                "type": "LinearLayout",
                                "weight": "0",
                                "height": "match_parent",
                                "width": "match_parent",
                                "orientation": "vertical",
                                "Elements": [
                                    {
                                        "type": "TextView",
                                        "height": "wrap_content",
                                        "width": "match_parent",
                                        "weight": "0",
                                        "Value": "Сканируйте или выберите ячейку",
                                        "Variable": "",
                                        "BackgroundColor": "#3B5958",
                                        "TextSize": "20",
                                        "TextColor": "#FFFFFF",
                                        "TextBold": true
                                    },
                                    {
                                        "type": "SpinnerLayout",
                                        "height": "wrap_content",
                                        "width": "match_parent",
                                        "weight": "0",
                                        "Value": "@cells",
                                        "Variable": "cell"
                                    }
                                ]
                            },
                            {
                                "Value": "",
                                "Variable": "barcode_cell",
                                "type": "barcode"
                            }
                        ],
                        "Timer": false,
                        "hideToolBarScreen": false,
                        "noScroll": false,
                        "handleKeyUp": false,
                        "hideBottomBarScreen": true,
                        "onlineOnStart": false,
                        "onlineOnInput": false,
                        "DefOnCreate": "income_cell_on_start",
                        "DefOnInput": "income_cell_on_input",
                        "send_when_opened": true,
                        "onlineOnAfterStart": false
                    },
                    {
                        "Name": "Выбор товара",
                        "type": "Operation",
                        "Elements": [
                            {
                                "Value": "",
                                "Variable": "",
                                "type": "LinearLayout",
                                "weight": "0",
                                "height": "match_parent",
                                "width": "match_parent",
                                "orientation": "vertical",
                                "Elements": [
                                    {
                                        "type": "TextView",
                                        "height": "wrap_content",
                                        "width": "match_parent",
                                        "weight": "0",
                                        "Value": "Сканируйте товар",
                                        "Variable": "",
                                        "BackgroundColor": "#3B5958",
                                        "TextSize": "20",
                                        "TextColor": "#FFFFFF",
                                        "TextBold": true
                                    },
                                    {
                                        "type": "TextView",
                                        "height": "wrap_content",
                                        "width": "match_parent",
                                        "weight": "0",
                                        "Value": "Ячейка",
                                        "Variable": "",
                                        "TextSize": "20"
                                    },
                                    {
                                        "type": "TextView",
                                        "height": "wrap_content",
                                        "width": "match_parent",
                                        "weight": "0",
                                        "Value": "@cell",
                                        "Variable": "",
                                        "TextBold": true,
                                        "TextSize": "22"
                                    },
                                    {
                                        "type": "TextView",
                                        "height": "match_parent",
                                        "width": "match_parent",
                                        "weight": "0",
                                        "Value": "Товары в ячейке",
                                        "Variable": ""
                                    },
                                    {
                                        "type": "TableLayout",
                                        "height": "match_parent",
                                        "width": "match_parent",
                                        "weight": 0,
                                        "Value": "@table_object",
                                        "Variable": ""
                                    }
                                ],
                                "BackgroundColor": "",
                                "StrokeWidth": "",
                                "Padding": ""
                            },
                            {
                                "Value": "",
                                "Variable": "barcode",
                                "type": "barcode"
                            }
                        ],
                        "Timer": false,
                        "hideToolBarScreen": false,
                        "noScroll": false,
                        "handleKeyUp": false,
                        "hideBottomBarScreen": true,
                        "onlineOnStart": false,
                        "onlineOnInput": false,
                        "DefOnCreate": "",
                        "DefOnInput": "income_nom_input",
                        "onlineOnAfterStart": false
                    },
                    {
                        "Name": "Ввод количества",
                        "type": "Operation",
                        "Elements": [
                            {
                                "Value": "",
                                "Variable": "",
                                "type": "LinearLayout",
                                "weight": "0",
                                "height": "match_parent",
                                "width": "match_parent",
                                "orientation": "vertical",
                                "Elements": [
                                    {
                                        "type": "TextView",
                                        "height": "wrap_content",
                                        "width": "match_parent",
                                        "weight": "0",
                                        "Value": "Укажите количество",
                                        "Variable": "",
                                        "BackgroundColor": "#3B5958",
                                        "TextSize": "20",
                                        "TextColor": "#FFFFFF",
                                        "TextBold": true
                                    },
                                    {
                                        "type": "TextView",
                                        "height": "wrap_content",
                                        "width": "match_parent",
                                        "weight": "0",
                                        "Value": "Ячейка",
                                        "Variable": "",
                                        "TextSize": "20"
                                    },
                                    {
                                        "type": "TextView",
                                        "height": "wrap_content",
                                        "width": "match_parent",
                                        "weight": "0",
                                        "Value": "@cell",
                                        "Variable": "",
                                        "TextBold": true,
                                        "TextSize": "22"
                                    },
                                    {
                                        "type": "TextView",
                                        "height": "wrap_content",
                                        "width": "match_parent",
                                        "weight": "0",
                                        "Value": "Товар",
                                        "Variable": "",
                                        "TextSize": "20"
                                    },
                                    {
                                        "type": "TextView",
                                        "height": "wrap_content",
                                        "width": "match_parent",
                                        "weight": "0",
                                        "Value": "@nom",
                                        "Variable": "",
                                        "TextBold": true,
                                        "TextSize": "22"
                                    },
                                    {
                                        "type": "LinearLayout",
                                        "height": "wrap_content",
                                        "width": "match_parent",
                                        "weight": "0",
                                        "Value": "",
                                        "Variable": "",
                                        "orientation": "horizontal",
                                        "Elements": [
                                            {
                                                "type": "TextView",
                                                "height": "wrap_content",
                                                "width": "match_parent",
                                                "weight": "1",
                                                "Value": "Кол-во",
                                                "Variable": ""
                                            },
                                            {
                                                "type": "EditTextNumeric",
                                                "height": "wrap_content",
                                                "width": "match_parent",
                                                "weight": "1",
                                                "Value": "@qty",
                                                "Variable": "qty",
                                                "BackgroundColor": "#F7ECEB",
                                                "TextBold": true
                                            }
                                        ]
                                    }
                                ]
                            }
                        ],
                        "Timer": false,
                        "hideToolBarScreen": false,
                        "noScroll": false,
                        "handleKeyUp": false,
                        "hideBottomBarScreen": true,
                        "onlineOnStart": false,
                        "onlineOnInput": false,
                        "DefOnInput": "outcome_qty_input",
                        "onlineOnAfterStart": false
                    }
                ],
                "PlanFactHeader": "Состав"
            },
            {
                "ProcessName": "Остатки",
                "type": "Process",
                "Operations": [
                    {
                        "Name": "Остатки",
                        "type": "Operation",
                        "Elements": [
                            {
                                "Value": "",
                                "Variable": "",
                                "type": "LinearLayout",
                                "weight": "0",
                                "height": "match_parent",
                                "width": "match_parent",
                                "orientation": "vertical",
                                "Elements": [
                                    {
                                        "type": "TextView",
                                        "height": "wrap_content",
                                        "width": "match_parent",
                                        "weight": "0",
                                        "Value": "Сканируйте ячейку или товар чтобы посмотреть остатки",
                                        "Variable": "",
                                        "TextSize": "20",
                                        "BackgroundColor": "#3B5958",
                                        "TextColor": "#FFFFFF"
                                    },
                                    {
                                        "type": "TableLayout",
                                        "height": "match_parent",
                                        "width": "match_parent",
                                        "weight": "0",
                                        "Value": "@table",
                                        "Variable": ""
                                    }
                                ]
                            },
                            {
                                "Value": "",
                                "Variable": "barcode",
                                "type": "barcode"
                            }
                        ],
                        "Timer": false,
                        "hideToolBarScreen": false,
                        "noScroll": false,
                        "handleKeyUp": false,
                        "hideBottomBarScreen": true,
                        "onlineOnStart": false,
                        "onlineOnInput": false,
                        "DefOnCreate": "stock_on_create",
                        "DefOnInput": "stock_input",
                        "noConfirmation": true,
                        "send_when_opened": true,
                        "onlineOnAfterStart": false
                    },
                    {
                        "Name": "Остатки по объекту",
                        "type": "Operation",
                        "Elements": [
                            {
                                "Value": "",
                                "Variable": "",
                                "type": "LinearLayout",
                                "weight": "0",
                                "height": "match_parent",
                                "width": "match_parent",
                                "orientation": "vertical",
                                "Elements": [
                                    {
                                        "type": "TextView",
                                        "height": "wrap_content",
                                        "width": "match_parent",
                                        "weight": "0",
                                        "Value": "Объект",
                                        "Variable": "",
                                        "TextSize": "20"
                                    },
                                    {
                                        "type": "TextView",
                                        "height": "wrap_content",
                                        "width": "match_parent",
                                        "weight": "0",
                                        "Value": "@object",
                                        "Variable": "",
                                        "TextBold": true,
                                        "TextSize": "22"
                                    },
                                    {
                                        "type": "TableLayout",
                                        "height": "match_parent",
                                        "width": "match_parent",
                                        "weight": "0",
                                        "Value": "@table_object",
                                        "Variable": ""
                                    }
                                ]
                            }
                        ],
                        "Timer": false,
                        "hideToolBarScreen": false,
                        "noScroll": false,
                        "handleKeyUp": false,
                        "hideBottomBarScreen": true,
                        "onlineOnStart": false,
                        "onlineOnInput": false,
                        "noConfirmation": true,
                        "DefOnInput": "stock_object_input",
                        "onlineOnAfterStart": false
                    }
                ]
            },
            {
                "ProcessName": "Инвентаризация Active CV",
                "type": "Process",
                "Operations": [
                    {
                        "Name": "Документы",
                        "type": "Operation",
                        "Elements": [
                            {
                                "Value": "",
                                "Variable": "",
                                "type": "LinearLayout",
                                "weight": "0",
                                "height": "match_parent",
                                "width": "match_parent",
                                "orientation": "vertical",
                                "Elements": [
                                    {
                                        "type": "TextView",
                                        "height": "wrap_content",
                                        "width": "match_parent",
                                        "weight": "0",
                                        "Value": "Создайте новый или продолжите существующий документ",
                                        "Variable": "",
                                        "BackgroundColor": "#3B5958",
                                        "TextSize": "20",
                                        "TextColor": "#FFFFFF",
                                        "TextBold": true
                                    },
                                    {
                                        "type": "Button",
                                        "height": "wrap_content",
                                        "width": "match_parent",
                                        "weight": "0",
                                        "Value": "Создать инвентаризацию",
                                        "Variable": "btn_new",
                                        "BackgroundColor": "#3CB371"
                                    },
                                    {
                                        "type": "CardsLayout",
                                        "height": "wrap_content",
                                        "width": "match_parent",
                                        "weight": "0",
                                        "Value": "@inventory",
                                        "Variable": "doc"
                                    }
                                ]
                            }
                        ],
                        "Timer": false,
                        "hideToolBarScreen": false,
                        "noScroll": false,
                        "handleKeyUp": false,
                        "hideBottomBarScreen": true,
                        "onlineOnStart": false,
                        "onlineOnInput": false,
                        "DefOnCreate": "inventory_on_start",
                        "DefOnInput": "inventory_input",
                        "send_when_opened": true,
                        "onlineOnAfterStart": false
                    },
                    {
                        "Name": "Новая инвентаризация",
                        "type": "Operation",
                        "Elements": [
                            {
                                "Value": "",
                                "Variable": "",
                                "type": "LinearLayout",
                                "weight": "0",
                                "height": "match_parent",
                                "width": "match_parent",
                                "orientation": "vertical",
                                "Elements": [
                                    {
                                        "type": "TextView",
                                        "height": "wrap_content",
                                        "width": "match_parent",
                                        "weight": "0",
                                        "Value": "Комментарий/Название",
                                        "Variable": ""
                                    },
                                    {
                                        "type": "EditTextText",
                                        "height": "wrap_content",
                                        "width": "match_parent",
                                        "weight": "0",
                                        "Value": "",
                                        "Variable": "name"
                                    }
                                ]
                            }
                        ],
                        "Timer": false,
                        "hideToolBarScreen": false,
                        "noScroll": false,
                        "handleKeyUp": false,
                        "hideBottomBarScreen": true,
                        "onlineOnStart": false,
                        "onlineOnInput": false,
                        "DefOnInput": "newinv_input",
                        "onlineOnAfterStart": false
                    },
                    {
                        "Name": "ДиалогВводКоличества",
                        "type": "Operation",
                        "Elements": [
                            {
                                "Value": "",
                                "Variable": "",
                                "type": "LinearLayout",
                                "weight": "0",
                                "height": "match_parent",
                                "width": "match_parent",
                                "orientation": "vertical",
                                "Elements": [
                                    {
                                        "type": "TextView",
                                        "height": "wrap_content",
                                        "width": "wrap_content",
                                        "weight": "0",
                                        "Value": "@nom",
                                        "Variable": ""
                                    },
                                    {
                                        "type": "LinearLayout",
                                        "height": "wrap_content",
                                        "width": "match_parent",
                                        "weight": "0",
                                        "Value": "",
                                        "Variable": "",
                                        "orientation": "horizontal",
                                        "Elements": [
                                            {
                                                "type": "TextView",
                                                "height": "wrap_content",
                                                "width": "match_parent",
                                                "weight": "1",
                                                "Value": "Кол.:",
                                                "Variable": ""
                                            },
                                            {
                                                "type": "EditTextNumeric",
                                                "height": "wrap_content",
                                                "width": "match_parent",
                                                "weight": "1",
                                                "Value": "",
                                                "Variable": "qty"
                                            }
                                        ]
                                    }
                                ]
                            }
                        ],
                        "Timer": false,
                        "hideToolBarScreen": false,
                        "noScroll": false,
                        "handleKeyUp": false,
                        "hideBottomBarScreen": true,
                        "onlineOnStart": false,
                        "onlineOnInput": false,
                        "onlineOnAfterStart": false
                    },
                    {
                        "Name": "Инвентаризация Результаты",
                        "type": "Operation",
                        "Elements": [
                            {
                                "Value": "",
                                "Variable": "",
                                "type": "LinearLayout",
                                "weight": "0",
                                "height": "match_parent",
                                "width": "match_parent",
                                "orientation": "vertical",
                                "Elements": [
                                    {
                                        "type": "TextView",
                                        "height": "wrap_content",
                                        "width": "match_parent",
                                        "weight": "0",
                                        "Value": "@inv",
                                        "Variable": "",
                                        "TextSize": "18"
                                    },
                                    {
                                        "type": "Button",
                                        "height": "wrap_content",
                                        "width": "match_parent",
                                        "weight": "0",
                                        "Value": "Начать сканирование",
                                        "Variable": "btn_run"
                                    },
                                    {
                                        "type": "TableLayout",
                                        "height": "match_parent",
                                        "width": "match_parent",
                                        "weight": "0",
                                        "Value": "@table",
                                        "Variable": ""
                                    }
                                ],
                                "BackgroundColor": "",
                                "StrokeWidth": "",
                                "Padding": ""
                            }
                        ],
                        "Timer": false,
                        "hideToolBarScreen": false,
                        "noScroll": false,
                        "handleKeyUp": false,
                        "hideBottomBarScreen": true,
                        "onlineOnStart": false,
                        "onlineOnInput": false,
                        "DefOnCreate": "invres_on_start",
                        "DefOnInput": "invres_input",
                        "send_when_opened": true,
                        "onlineOnAfterStart": false
                    }
                ],
                "hidden": false
            },
            {
                "CVOperationName": "ИнвCV",
                "type": "CVOperation",
                "CVFrames": [
                    {
                        "Name": "Выбор ячейки",
                        "type": "CVFrame",
                        "CVOnline": false,
                        "CVDetector": "Barcode",
                        "CVResolution": "HD720",
                        "CVMode": "green_and_grey",
                        "CVActionButtons": "",
                        "CVAction": "Сканируйте Штрихкод ячейки",
                        "CVInfo": "@inv",
                        "CVCameraDevice": "Back",
                        "CVDetectorMode": "train",
                        "CVFrameDefOnCreate": "invcv_cell_on_start",
                        "CVFrameDefOnNewObject": "invcv_cell_on_new_object",
                        "VisionSettings": "{\n    \"name\": \"Распознавание артикула\",\n    \"TypeRecognition\": \"Распознавание текста\",\n    \"mesure_qty\": \"1\",\n    \"min_freq\": \"1\",\n    \"min_length\": \"3\",\n    \"max_length\": \"15\",\n    \"query\": \"c2VsZWN0ICogZnJvbSBTV19Hb29kcyB3aGVyZSBwcm9kdWN0X251bWJlciBsaWtlICA/\",\n    \"ReplaceO\": true,\n    \"ToUpcase\": false,\n    \"control_field\": \"product_number\",\n    \"result_field\": \"id\",\n    \"cursor\": [\n        {\n            \"title\": \"id\",\n            \"var\": \"nom_id\",\n            \"field\": \"id\"\n        }\n    ],\n    \"result_var\": \"nom_id\"\n}",
                        "RecognitionTemplate": "Распознавание артикула"
                    },
                    {
                        "Name": "Товары ячейки",
                        "type": "CVFrame",
                        "CVOnline": false,
                        "CVDetector": "Barcode",
                        "CVResolution": "HD720",
                        "CVMode": "list_and_grey",
                        "CVActionButtons": "К ЯЧЕЙКЕ",
                        "CVAction": "Сканируйте штрихкоды товара",
                        "CVInfo": "@inv",
                        "CVCameraDevice": "Back",
                        "CVDetectorMode": "train",
                        "CVFrameDefOnNewObject": "invcv_goods_on_new_object",
                        "CVFrameDefAction": "invcv_goods_action",
                        "VisionSettings": "{\n    \"name\": \"Распознавание артикула\",\n    \"TypeRecognition\": \"Распознавание текста\",\n    \"mesure_qty\": \"1\",\n    \"min_freq\": \"1\",\n    \"min_length\": \"3\",\n    \"max_length\": \"15\",\n    \"query\": \"c2VsZWN0ICogZnJvbSBTV19Hb29kcyB3aGVyZSBwcm9kdWN0X251bWJlciBsaWtlICA/\",\n    \"ReplaceO\": true,\n    \"ToUpcase\": false,\n    \"control_field\": \"product_number\",\n    \"result_field\": \"id\",\n    \"cursor\": [\n        {\n            \"title\": \"id\",\n            \"var\": \"nom_id\",\n            \"field\": \"id\"\n        }\n    ],\n    \"result_var\": \"nom_id\"\n}",
                        "RecognitionTemplate": "Распознавание артикула",
                        "CVRecognitionSettings": "{\n    \"name\": \"Распознавание артикула\",\n    \"TypeRecognition\": \"Распознавание текста\",\n    \"mesure_qty\": \"1\",\n    \"min_freq\": \"1\",\n    \"min_length\": \"3\",\n    \"max_length\": \"15\",\n    \"query\": \"c2VsZWN0ICogZnJvbSBTV19Hb29kcyB3aGVyZSBwcm9kdWN0X251bWJlciBsaWtlICA/\",\n    \"ReplaceO\": true,\n    \"ToUpcase\": false,\n    \"control_field\": \"product_number\",\n    \"result_field\": \"id\",\n    \"cursor\": [\n        {\n            \"title\": \"id\",\n            \"var\": \"nom_id\",\n            \"field\": \"id\"\n        }\n    ],\n    \"result_var\": \"nom_id\"\n}"
                    }
                ],
                "hidden": true
            }
        ],
        "ConfigurationSettings": {
            "uid": "f164e78e7f8f480da045102a42812cdb"
        },
        "ConfigurationTags": "Py,off-line,ActiveCV®",
        "RunPython": true,
        "PyHandlers": "aW1wb3J0IG9zCmltcG9ydCBzcWxpdGUzICAjIFRoaXMgaXMgYW5vdGhlciB3YXkgdG8gd29yayB3aXRoIFNRTApmcm9tIHNxbGl0ZTMuZGJhcGkyIGltcG9ydCBFcnJvcgpmcm9tIGRhdGV0aW1lIGltcG9ydCBkYXRldGltZQpmcm9tIFBJTCBpbXBvcnQgSW1hZ2UKZnJvbSBmbGFzayBpbXBvcnQgRmxhc2sKZnJvbSBmbGFzayBpbXBvcnQgcmVxdWVzdAppbXBvcnQganNvbgpmcm9tIHBvbnkub3JtIGltcG9ydCBzZWxlY3QsIGRiX3Nlc3Npb24sIGNvbW1pdAppbXBvcnQgdWlfZ2xvYmFsCgoKYXBwID0gRmxhc2soX19uYW1lX18pCgoKIyAtQkVHSU4gQ1VTVE9NIEhBTkRMRVJTCgpEQl9QQVRIX2RlYnVnID0gJ2RiLmRiJyAgICAjREJfUEFUSCA9ICdkYi5kYicgI25ldzIg0LfQsNC80LXQvdCwINC/0LXRgNC10LzQtdC90L3QvtC5Cgp1bml0X2lkID0gLTEKbm9tX2lkID0gLTEKY2VsbF9pZCA9IC0xCmNlbGxzID0ge30KY2VsbGlkID0gTm9uZQpmb3VuZCA9IFtdCmdyZWVuX3NpemUgPSAwCnllbGxvd19zaXplID0gMAoKCiNmdW5jID0gbWV0aG9kLnJlcGxhY2UoJ18nLCAnJywgMSkKCmRlZiBpbml0X29uX3N0YXJ0KCk6I2hhc2hNYXAsIF9maWxlcz1Ob25lLCBfZGF0YT1Ob25lKToKICAgIHVpX2dsb2JhbC5pbml0KCkKICAgIHJldHVybiBoYXNoTWFwCgoKZGVmIG1lbnVfaW5wdXQoaGFzaE1hcCwgX2ZpbGVzPU5vbmUsIF9kYXRhPU5vbmUpOgogICAgaWYgaGFzaE1hcC5nZXQoImxpc3RlbmVyIikgPT0gIm1lbnUiOgogICAgICAgIGlmIGhhc2hNYXAuZ2V0KCJtZW51IikgPT0gItCU0L7QsdCw0LLQuNGC0Ywg0YLQvtCy0LDRgCI6CiAgICAgICAgICAgIGhhc2hNYXAucHV0KCJTaG93U2NyZWVuIiwgItCU0L7QsdCw0LLQuNGC0Ywg0YLQvtCy0LDRgCIpCiAgICAgICAgaWYgaGFzaE1hcC5nZXQoIm1lbnUiKSA9PSAi0JTQvtCx0LDQstC40YLRjCDRj9GH0LXQudC60YMiOgogICAgICAgICAgICBoYXNoTWFwLnB1dCgiU2hvd1NjcmVlbiIsICLQlNC+0LHQsNCy0LjRgtGMINGP0YfQtdC50LrRgyIpCiAgICAgICAgaWYgaGFzaE1hcC5nZXQoIm1lbnUiKSA9PSAi0JTQvtCx0LDQstC40YLRjCDQs9GA0YPQv9C/0YMg0YLQvtCy0LDRgNC+0LIiOgogICAgICAgICAgICBoYXNoTWFwLnB1dCgiU2hvd1NjcmVlbiIsICLQlNC+0LHQsNCy0LjRgtGMINCz0YDRg9C/0L/RgyDRgtC+0LLQsNGA0L7QsiIpCgogICAgICAgIGVsaWYgaGFzaE1hcC5nZXQoIm1lbnUiKSA9PSAi0JTQvtCx0LDQstC40YLRjCDQtdC00LjQvdC40YbRgyDQuNC30LzQtdGA0LXQvdC40Y8iOgogICAgICAgICAgICBoYXNoTWFwLnB1dCgiU2hvd1NjcmVlbiIsICLQlNC+0LHQsNCy0LjRgtGMINC10LTQuNC90LjRhtGDINC40LfQvNC10YDQtdC90LjRjyIpCiAgICBlbGlmIGhhc2hNYXAuZ2V0KCJsaXN0ZW5lciIpID09ICdPTl9CQUNLX1BSRVNTRUQnOgogICAgICAgIGhhc2hNYXAucHV0KCJGaW5pc2hQcm9jZXNzIiwgIiIpCiAgICByZXR1cm4gaGFzaE1hcAoKCmRlZiBtZW51X29uX3N0YXJ0KGhhc2hNYXAsIF9maWxlcz1Ob25lLCBfZGF0YT1Ob25lKToKICAgICMgaGFzaE1hcC5wdXQoImdldGZpbGVzIiwiIikKICAgICMgaGFzaE1hcC5wdXQoInRvYXN0IiwidGVzdDEiKQogICAgcmV0dXJuIGhhc2hNYXAKCgojIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLdC00L7QvyDRhNGD0L3QutGG0LjQuApkZWYgZ2V0X3RhYmxlX2J5X2NlbGwoaWQpOgogICAgdGFibGUgPSB7CiAgICAgICAgInR5cGUiOiAidGFibGUiLAogICAgICAgICJ0ZXh0c2l6ZSI6ICIxNyIsCgogICAgICAgICJjb2x1bW5zIjogWwogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAibmFtZSI6ICJjZWxsIiwKICAgICAgICAgICAgICAgICJoZWFkZXIiOiAi0K/Rh9C10LnQutCwIiwKICAgICAgICAgICAgICAgICJ3ZWlnaHQiOiAiMSIKICAgICAgICAgICAgfSwKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgIm5hbWUiOiAibm9tIiwKICAgICAgICAgICAgICAgICJoZWFkZXIiOiAi0KLQvtCy0LDRgCIsCiAgICAgICAgICAgICAgICAid2VpZ2h0IjogIjIiCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICJuYW1lIjogInF0eSIsCiAgICAgICAgICAgICAgICAiaGVhZGVyIjogItCe0YHRgtCw0YLQvtC6IiwKICAgICAgICAgICAgICAgICJ3ZWlnaHQiOiAiMSIKICAgICAgICAgICAgfQogICAgICAgIF0KICAgIH0KCiAgICBjb25uID0gTm9uZQogICAgdHJ5OgogICAgICAgIGNvbm4gPSBzcWxpdGUzLmNvbm5lY3QoREJfUEFUSF9kZWJ1ZykKICAgIGV4Y2VwdCBFcnJvciBhcyBlOgogICAgICAgIHJhaXNlIFZhbHVlRXJyb3IoJ9Cd0LXRgiDRgdC+0LXQtNC40L3QtdC90LjRjyDRgSDQsdCw0LfQvtC5IScpCgogICAgY3Vyc29yID0gY29ubi5jdXJzb3IoKQogICAgY3Vyc29yLmV4ZWN1dGUoCiAgICAgICAgIlNFTEVDVCBTV19DZWxscy5uYW1lIGFzIGNlbGwsU1dfR29vZHMubmFtZSBhcyBub20sIGlmbnVsbChzdW0ocXR5KSwwKSBhcyBxdHkgRlJPTSBTV19BY2NvdW50IExFRlQgSk9JTiBTV19Hb29kcyBPTiBTV19BY2NvdW50LnNrdT1TV19Hb29kcy5pZCBMRUZUIEpPSU4gU1dfQ2VsbHMgT04gU1dfQWNjb3VudC5jZWxsPVNXX0NlbGxzLmlkIFdIRVJFIFNXX0FjY291bnQuY2VsbCA9ICIgKyBzdHIoCiAgICAgICAgICAgIGlkKSArICIgR1JPVVAgQlkgU1dfR29vZHMubmFtZSAsU1dfQ2VsbHMubmFtZSBIQVZJTkcgaWZudWxsKHN1bShxdHkpLDApPD4wIikKCiAgICByZXN1bHRzID0gY3Vyc29yLmZldGNoYWxsKCkKCiAgICByb3dzID0gW10KICAgIGZvciByZWNvcmQgaW4gcmVzdWx0czoKICAgICAgICByb3dzLmFwcGVuZCh7ImNlbGwiOiByZWNvcmRbMF0sICJub20iOiByZWNvcmRbMV0sICJxdHkiOiByZWNvcmRbMl19KQoKICAgIHRhYmxlWydyb3dzJ10gPSByb3dzCgogICAgcmV0dXJuIGpzb24uZHVtcHModGFibGUpCgoKCgoKIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS3QlNC+0LHQsNCy0LjRgtGMINC10LTQuNC90LjRhtGDINC40LfQvNC10YDQtdC90LjRjwpkZWYgdW5pdHNfb25fc3RhcnQoaGFzaE1hcCwgX2ZpbGVzPU5vbmUsIF9kYXRhPU5vbmUpOgogICAgdGFibGUgPSB7CiAgICAgICAgInR5cGUiOiAidGFibGUiLAogICAgICAgICJ0ZXh0c2l6ZSI6ICIyMCIsCgogICAgICAgICJjb2x1bW5zIjogWwogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAibmFtZSI6ICJuYW1lIiwKICAgICAgICAgICAgICAgICJoZWFkZXIiOiAi0J3QsNC40LzQtdC90L7QstCw0L3QuNC1IiwKICAgICAgICAgICAgICAgICJ3ZWlnaHQiOiAiMSIKICAgICAgICAgICAgfQogICAgICAgIF0KICAgIH0KICAgICMgd29yayB3aXRoIFNRTCB2aWEgUG9ueSBPUk0KICAgIHdpdGggZGJfc2Vzc2lvbjojINCX0LDQvNC10L3QuNC7ISEhCiAgICAgICAgcXVlcnkgPSBzZWxlY3QoYyBmb3IgYyBpbiB1aV9nbG9iYWwuU1dfVW5pdHMpCiAgICAgICAgcm93cyA9IFtdCiAgICAgICAgZm9yIHJlY29yZCBpbiBxdWVyeToKICAgICAgICAgICAgcm93cy5hcHBlbmQoeyJuYW1lIjogcmVjb3JkLm5hbWUsICJpZCI6IHJlY29yZC5pZH0pCgogICAgdGFibGVbJ3Jvd3MnXSA9IHJvd3MKICAgIGhhc2hNYXAucHV0KCJsaXN0IiwganNvbi5kdW1wcyh0YWJsZSkpCgogICAgcmV0dXJuIGhhc2hNYXAKCgpkZWYgdW5pdHNfaW5wdXQoaGFzaE1hcCwgX2ZpbGVzPU5vbmUsIF9kYXRhPU5vbmUpOgogICAgZ2xvYmFsIHVuaXRfaWQKCiAgICBpZiBoYXNoTWFwLmdldCgibGlzdGVuZXIiKSA9PSAnT05fQkFDS19QUkVTU0VEJzoKICAgICAgICBoYXNoTWFwLnB1dCgiU2hvd1NjcmVlbiIsICLQnNC10L3RjiDQndCh0JgiKQoKICAgIGVsaWYgaGFzaE1hcC5nZXQoImxpc3RlbmVyIikgPT0gImJ0bl9hZGQiOgogICAgICAgIGhhc2hNYXAucHV0KCJuYW1lIiwgIiIpCiAgICAgICAgdW5pdF9pZCA9IC0xCiAgICAgICAgaGFzaE1hcC5wdXQoIlNob3dEaWFsb2ciLCAi0JTQuNCw0LvQvtCz0JXQtNC40L3QuNGG0YsiKQogICAgICAgIGhhc2hNYXAucHV0KCJTaG93RGlhbG9nU3R5bGUiLCBqc29uLmR1bXBzKHsidGl0bGUiOiAi0JTQvtCx0LDQstC70LXQvdC40LUg0LfQsNC/0LjRgdC4IiwgInllcyI6ICLQodC+0YXRgNCw0L3QuNGC0YwiLCAibm8iOiAi0J7RgtC80LXQvdCwIn0pKQoKICAgIGVsaWYgaGFzaE1hcC5nZXQoImxpc3RlbmVyIikgPT0gIlRhYmxlQ2xpY2siOgoKICAgICAgICBqcmVjb3JkID0ganNvbi5sb2FkcyhoYXNoTWFwLmdldCgic2VsZWN0ZWRfbGluZSIpKQogICAgICAgICMgaGFzaE1hcC5wdXQoInRvYXN0IixzdHIoanJlY29yZFsnaWQnXSkpCiAgICAgICAgdW5pdF9pZCA9IGpyZWNvcmRbJ2lkJ10KICAgICAgICBoYXNoTWFwLnB1dCgibmFtZSIsIGpyZWNvcmRbJ25hbWUnXSkKCiAgICAgICAgaGFzaE1hcC5wdXQoIlNob3dEaWFsb2ciLCAi0JTQuNCw0LvQvtCz0JXQtNC40L3QuNGG0YsiKQogICAgICAgIGhhc2hNYXAucHV0KCJTaG93RGlhbG9nU3R5bGUiLCBqc29uLmR1bXBzKHsidGl0bGUiOiAi0JTQvtCx0LDQstC70LXQvdC40LUg0LfQsNC/0LjRgdC4IiwgInllcyI6ICLQodC+0YXRgNCw0L3QuNGC0YwiLCAibm8iOiAi0J7RgtC80LXQvdCwIn0pKQogICAgZWxpZiBoYXNoTWFwLmdldCgiZXZlbnQiKSA9PSAib25SZXN1bHRQb3NpdGl2ZSI6CiAgICAgICAgIyBoYXNoTWFwLnB1dCgidG9hc3QiLHN0cih1bml0X2lkKSkKICAgICAgICBpZiB1bml0X2lkIDwgMDoKICAgICAgICAgICAgd2l0aCBkYl9zZXNzaW9uOgogICAgICAgICAgICAgICAgciA9IHVpX2dsb2JhbC5TV19Vbml0cyhuYW1lPWhhc2hNYXAuZ2V0KCduYW1lJykpCiAgICAgICAgICAgICAgICBjb21taXQoKQogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHdpdGggZGJfc2Vzc2lvbjoKICAgICAgICAgICAgICAgIGlmIGhhc2hNYXAuZ2V0KCduYW1lJykgPT0gIiI6ICAjINGD0LTQsNC70LXQvdC40LUKICAgICAgICAgICAgICAgICAgICByID0gdWlfZ2xvYmFsLlNXX1VuaXRzW3VuaXRfaWRdCiAgICAgICAgICAgICAgICAgICAgci5kZWxldGUoKQogICAgICAgICAgICAgICAgZWxzZTogICMg0YDQtdC00LDQutGC0LjRgNC+0LLQsNC90LjQtQogICAgICAgICAgICAgICAgICAgIHIgPSB1aV9nbG9iYWwuU1dfVW5pdHNbdW5pdF9pZF0KICAgICAgICAgICAgICAgICAgICByLm5hbWUgPSBoYXNoTWFwLmdldCgnbmFtZScpCgogICAgICAgICAgICAgICAgY29tbWl0KCkKCiAgICByZXR1cm4gaGFzaE1hcAoKCiMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0t0JTQvtCx0LDQstC40YLRjCDQs9GA0YPQv9C/0YMg0YLQvtCy0LDRgNC+0LIKZGVmIGdyb3Vwc19vbl9zdGFydChoYXNoTWFwLCBfZmlsZXM9Tm9uZSwgX2RhdGE9Tm9uZSk6CiAgICB0YWJsZSA9IHsKICAgICAgICAidHlwZSI6ICJ0YWJsZSIsCiAgICAgICAgInRleHRzaXplIjogIjIwIiwKCiAgICAgICAgImNvbHVtbnMiOiBbCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICJuYW1lIjogIm5hbWUiLAogICAgICAgICAgICAgICAgImhlYWRlciI6ICLQndCw0LjQvNC10L3QvtCy0LDQvdC40LUiLAogICAgICAgICAgICAgICAgIndlaWdodCI6ICIxIgogICAgICAgICAgICB9CiAgICAgICAgXQogICAgfQogICAgIyB3b3JrIHdpdGggU1FMIHZpYSBQb255IE9STQogICAgd2l0aCBkYl9zZXNzaW9uOiMg0JfQsNC80LXQvdC40LshISEKICAgICAgICBxdWVyeSA9IHNlbGVjdChjIGZvciBjIGluIHVpX2dsb2JhbC5TV19Hcm91cHMpCiAgICAgICAgcm93cyA9IFtdCiAgICAgICAgZm9yIHJlY29yZCBpbiBxdWVyeToKICAgICAgICAgICAgcm93cy5hcHBlbmQoeyJuYW1lIjogcmVjb3JkLm5hbWUsICJpZCI6IHJlY29yZC5pZH0pCgogICAgdGFibGVbJ3Jvd3MnXSA9IHJvd3MKICAgIGhhc2hNYXAucHV0KCJsaXN0IiwganNvbi5kdW1wcyh0YWJsZSkpCgogICAgcmV0dXJuIGhhc2hNYXAKCgpkZWYgZ3JvdXBzX2lucHV0KGhhc2hNYXAsIF9maWxlcz1Ob25lLCBfZGF0YT1Ob25lKToKICAgIGdsb2JhbCB1bml0X2lkCgogICAgaWYgaGFzaE1hcC5nZXQoImxpc3RlbmVyIikgPT0gJ09OX0JBQ0tfUFJFU1NFRCc6CiAgICAgICAgaGFzaE1hcC5wdXQoIlNob3dTY3JlZW4iLCAi0JzQtdC90Y4g0J3QodCYIikKICAgIGVsaWYgaGFzaE1hcC5nZXQoImxpc3RlbmVyIikgPT0gImJ0bl9hZGQiOgogICAgICAgIGhhc2hNYXAucHV0KCJuYW1lIiwgIiIpCiAgICAgICAgdW5pdF9pZCA9IC0xCiAgICAgICAgaGFzaE1hcC5wdXQoIlNob3dEaWFsb2ciLCAi0JTQuNCw0LvQvtCz0JPRgNGD0L/Qv9GLIikKICAgICAgICBoYXNoTWFwLnB1dCgiU2hvd0RpYWxvZ1N0eWxlIiwganNvbi5kdW1wcyh7InRpdGxlIjogItCU0L7QsdCw0LLQu9C10L3QuNC1INC30LDQv9C40YHQuCIsICJ5ZXMiOiAi0KHQvtGF0YDQsNC90LjRgtGMIiwgIm5vIjogItCe0YLQvNC10L3QsCJ9KSkKCiAgICBlbGlmIGhhc2hNYXAuZ2V0KCJsaXN0ZW5lciIpID09ICJUYWJsZUNsaWNrIjoKCiAgICAgICAganJlY29yZCA9IGpzb24ubG9hZHMoaGFzaE1hcC5nZXQoInNlbGVjdGVkX2xpbmUiKSkKICAgICAgICAjIGhhc2hNYXAucHV0KCJ0b2FzdCIsc3RyKGpyZWNvcmRbJ2lkJ10pKQogICAgICAgIHVuaXRfaWQgPSBqcmVjb3JkWydpZCddCiAgICAgICAgaGFzaE1hcC5wdXQoIm5hbWUiLCBqcmVjb3JkWyduYW1lJ10pCgogICAgICAgIGhhc2hNYXAucHV0KCJTaG93RGlhbG9nIiwgItCU0LjQsNC70L7Qs9CT0YDRg9C/0L/RiyIpCiAgICAgICAgaGFzaE1hcC5wdXQoIlNob3dEaWFsb2dTdHlsZSIsIGpzb24uZHVtcHMoeyJ0aXRsZSI6ICLQlNC+0LHQsNCy0LvQtdC90LjQtSDQt9Cw0L/QuNGB0LgiLCAieWVzIjogItCh0L7RhdGA0LDQvdC40YLRjCIsICJubyI6ICLQntGC0LzQtdC90LAifSkpCiAgICBlbGlmIGhhc2hNYXAuZ2V0KCJldmVudCIpID09ICJvblJlc3VsdFBvc2l0aXZlIjoKICAgICAgICAjIGhhc2hNYXAucHV0KCJ0b2FzdCIsc3RyKHVuaXRfaWQpKQogICAgICAgIGlmIHVuaXRfaWQgPCAwOgogICAgICAgICAgICB3aXRoIGRiX3Nlc3Npb246CiAgICAgICAgICAgICAgICByID0gdWlfZ2xvYmFsLlNXX0dyb3VwcyhuYW1lPWhhc2hNYXAuZ2V0KCduYW1lJykpCiAgICAgICAgICAgICAgICBjb21taXQoKQogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHdpdGggZGJfc2Vzc2lvbjoKICAgICAgICAgICAgICAgIGlmIGhhc2hNYXAuZ2V0KCduYW1lJykgPT0gIiI6ICAjINGD0LTQsNC70LXQvdC40LUKICAgICAgICAgICAgICAgICAgICByID0gdWlfZ2xvYmFsLlNXX0dyb3Vwc1t1bml0X2lkXQogICAgICAgICAgICAgICAgICAgIHIuZGVsZXRlKCkKICAgICAgICAgICAgICAgIGVsc2U6ICAjINGA0LXQtNCw0LrRgtC40YDQvtCy0LDQvdC40LUKICAgICAgICAgICAgICAgICAgICByID0gdWlfZ2xvYmFsLlNXX0dyb3Vwc1t1bml0X2lkXQogICAgICAgICAgICAgICAgICAgIHIubmFtZSA9IGhhc2hNYXAuZ2V0KCduYW1lJykKCiAgICAgICAgICAgICAgICBjb21taXQoKQoKICAgIHJldHVybiBoYXNoTWFwCgoKIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLdCU0L7QsdCw0LLQuNGC0Ywg0YLQvtCy0LDRgApkZWYgZ29vZHNfb25fc3RhcnQoaGFzaE1hcCwgX2ZpbGVzPU5vbmUsIF9kYXRhPU5vbmUpOgogICAgaGFzaE1hcC5wdXQoIm1tX2xvY2FsIiwgIiIpCiAgICBoYXNoTWFwLnB1dCgibW1fY29tcHJlc3Npb24iLCAiNzAiKQogICAgaGFzaE1hcC5wdXQoIm1tX3NpemUiLCAiNjUiKQoKICAgIGxpc3QgPSB7ImN1c3RvbWNhcmRzIjogewoKICAgICAgICAibGF5b3V0IjogewogICAgICAgICAgICAidHlwZSI6ICJMaW5lYXJMYXlvdXQiLAogICAgICAgICAgICAib3JpZW50YXRpb24iOiAidmVydGljYWwiLAogICAgICAgICAgICAiaGVpZ2h0IjogIm1hdGNoX3BhcmVudCIsCiAgICAgICAgICAgICJ3aWR0aCI6ICJtYXRjaF9wYXJlbnQiLAogICAgICAgICAgICAid2VpZ2h0IjogIjAiLAogICAgICAgICAgICAiRWxlbWVudHMiOiBbCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgInR5cGUiOiAiTGluZWFyTGF5b3V0IiwKICAgICAgICAgICAgICAgICAgICAib3JpZW50YXRpb24iOiAiaG9yaXpvbnRhbCIsCiAgICAgICAgICAgICAgICAgICAgImhlaWdodCI6ICJ3cmFwX2NvbnRlbnQiLAogICAgICAgICAgICAgICAgICAgICJ3aWR0aCI6ICJtYXRjaF9wYXJlbnQiLAogICAgICAgICAgICAgICAgICAgICJ3ZWlnaHQiOiAiMCIsCiAgICAgICAgICAgICAgICAgICAgIkVsZW1lbnRzIjogWwogICAgICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAidHlwZSI6ICJQaWN0dXJlIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICJzaG93X2J5X2NvbmRpdGlvbiI6ICIiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgIlZhbHVlIjogIkBwaWMiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgIk5vUmVmcmVzaCI6IEZhbHNlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgImRvY3VtZW50X3R5cGUiOiAiIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICJtYXNrIjogIiIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAiVmFyaWFibGUiOiAiIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICJUZXh0U2l6ZSI6ICIxNiIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAiVGV4dENvbG9yIjogIiNEQjcwOTMiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgIlRleHRCb2xkIjogVHJ1ZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICJUZXh0SXRhbGljIjogRmFsc2UsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAiQmFja2dyb3VuZENvbG9yIjogIiIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAid2lkdGgiOiAiNzUiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgImhlaWdodCI6ICI3NSIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAid2VpZ2h0IjogMAogICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAidHlwZSI6ICJMaW5lYXJMYXlvdXQiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgIm9yaWVudGF0aW9uIjogInZlcnRpY2FsIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICJoZWlnaHQiOiAid3JhcF9jb250ZW50IiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICJ3aWR0aCI6ICJtYXRjaF9wYXJlbnQiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgIndlaWdodCI6ICIxIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICJFbGVtZW50cyI6IFsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJ0eXBlIjogIlRleHRWaWV3IiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgInNob3dfYnlfY29uZGl0aW9uIjogIiIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJWYWx1ZSI6ICJAbmFtZSIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJOb1JlZnJlc2giOiBGYWxzZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgImRvY3VtZW50X3R5cGUiOiAiIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIm1hc2siOiAiIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIlZhcmlhYmxlIjogIiIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgInR5cGUiOiAiVGV4dFZpZXciLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAic2hvd19ieV9jb25kaXRpb24iOiAiIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIlZhbHVlIjogIkBwcm9kdWN0X251bWJlciIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJOb1JlZnJlc2giOiBGYWxzZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgImRvY3VtZW50X3R5cGUiOiAiIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIm1hc2siOiAiIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIlZhcmlhYmxlIjogIiIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgInR5cGUiOiAiVGV4dFZpZXciLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAic2hvd19ieV9jb25kaXRpb24iOiAiIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIlZhbHVlIjogIkBiYXJjb2RlIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIk5vUmVmcmVzaCI6IEZhbHNlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiZG9jdW1lbnRfdHlwZSI6ICIiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAibWFzayI6ICIiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiVmFyaWFibGUiOiAiIgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIF0KICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIF0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgXQogICAgICAgIH0KCiAgICB9CiAgICB9CgogICAgIyBfZmlsZXMgPSBqc29uLmxvYWRzKGhhc2hNYXAuZ2V0KCJfZmlsZXMiKSkKICAgIHdpdGggZGJfc2Vzc2lvbjojINCX0LDQvNC10L3QuNC7ISEhCiAgICAgICAgcXVlcnkgPSBzZWxlY3QoYyBmb3IgYyBpbiB1aV9nbG9iYWwuU1dfR29vZHMpCiAgICAgICAgbGlzdFsiY3VzdG9tY2FyZHMiXVsiY2FyZHNkYXRhIl0gPSBbXQoKICAgICAgICBmb3IgcmVjb3JkIGluIHF1ZXJ5OgoKICAgICAgICAgICAgcGljID0gIiIKICAgICAgICAgICAgaWYgJ3Bob3RvJyBpbiByZWNvcmQucGljdHVyZXM6CgogICAgICAgICAgICAgICAgcCA9IHJlY29yZC5waWN0dXJlc1sncGhvdG8nXQoKICAgICAgICAgICAgICAgIGlmIGxlbihwKSA+IDA6CgogICAgICAgICAgICAgICAgICAgIGZvciBqZiBpbiBfZmlsZXM6I25ldzJfZmlsZXM6INC90LXRgl9maWxlcyAtINC30LDQvNC10L3QuNC7INC90LAgcCAgIyDQvdCw0YXQvtC00LjQvCDQv9GD0YLRjCDQuiDRhNCw0LnQu9GDINC/0L4g0LjQtNC10L3RgtC40YTQuNC60LDRgtC+0YDRgwogICAgICAgICAgICAgICAgICAgICAgICBpZiBqZlsnaWQnXSA9PSBwWzBdOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgb3MucGF0aC5leGlzdHMoamZbJ3BhdGgnXSk6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGljID0gIn4iICsgamZbJ3BhdGgnXQogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWsKCiAgICAgICAgICAgIGxpc3RbImN1c3RvbWNhcmRzIl1bImNhcmRzZGF0YSJdLmFwcGVuZCgKICAgICAgICAgICAgICAgIHsibmFtZSI6IHJlY29yZC5uYW1lLCAia2V5IjogcmVjb3JkLmlkLCAicHJvZHVjdF9udW1iZXIiOiBzdHIocmVjb3JkLnByb2R1Y3RfbnVtYmVyKSwKICAgICAgICAgICAgICAgICAiYmFyY29kZSI6IHN0cihyZWNvcmQuYmFyY29kZSksICJ1bml0Ijogc3RyKHJlY29yZC51bml0KSwgInNrdWdyb3VwIjogc3RyKHJlY29yZC5ncm91cCksCiAgICAgICAgICAgICAgICAgInByaWNlIjogcmVjb3JkLnByaWNlLCAidW5pcXVlIjogcmVjb3JkLnVuaXF1ZSwgInBpY3R1cmVzIjoganNvbi5kdW1wcyhyZWNvcmQucGljdHVyZXMpLCAicGljIjogcGljfSkKICAgIGhhc2hNYXAucHV0KCJsaXN0IiwganNvbi5kdW1wcyhsaXN0KSkKCiAgICByZXR1cm4gaGFzaE1hcAoKCmRlZiBvcGVuX25vbShoYXNoTWFwLCBub21faWQsIGtleSk6CiAgICBqbGlzdCA9IGpzb24ubG9hZHMoaGFzaE1hcC5nZXQoImxpc3QiKSkKICAgIGdvb2RzYXJyYXkgPSBqbGlzdFsiY3VzdG9tY2FyZHMiXVsnY2FyZHNkYXRhJ10KCiAgICBqcmVjb3JkID0gbmV4dChpdGVtIGZvciBpdGVtIGluIGdvb2RzYXJyYXkgaWYgc3RyKGl0ZW1bImtleSJdKSA9PSBrZXkpCgogICAgbm9tX2lkID0ganJlY29yZFsna2V5J10KICAgIGhhc2hNYXAucHV0KCJuYW1lIiwganJlY29yZFsnbmFtZSddKQogICAgaGFzaE1hcC5wdXQoImJhcmNvZGUiLCBqcmVjb3JkWydiYXJjb2RlJ10pCiAgICBoYXNoTWFwLnB1dCgidW5pdCIsIGpyZWNvcmRbJ3VuaXQnXSkKICAgIGhhc2hNYXAucHV0KCJncm91cCIsIGpyZWNvcmRbJ3NrdWdyb3VwJ10pCiAgICBoYXNoTWFwLnB1dCgicHJpY2UiLCBzdHIoanJlY29yZFsncHJpY2UnXSkpCiAgICBoYXNoTWFwLnB1dCgicHJvZHVjdF9udW1iZXIiLCBqcmVjb3JkWydwcm9kdWN0X251bWJlciddKQoKICAgIGlmIGpyZWNvcmRbJ3VuaXF1ZSddID09IDE6CiAgICAgICAgaGFzaE1hcC5wdXQoInVuaXF1ZSIsICJ0cnVlIikKICAgIGVsc2U6CiAgICAgICAgaGFzaE1hcC5wdXQoInVuaXF1ZSIsICJmYWxzZSIpCgogICAgIyBpZiBsZW4oc3RyKGpyZWNvcmRbJ3BpY3R1cmVzJ10pKT4wOgogICAgamcgPSBqc29uLmxvYWRzKGpyZWNvcmRbJ3BpY3R1cmVzJ10pCiAgICBpZiAncGhvdG8nIGluIGpnOgogICAgICAgIGhhc2hNYXAucHV0KCJwaG90b0dhbGxlcnkiLCBqc29uLmR1bXBzKGpnWydwaG90byddKSkKICAgIGVsc2U6CiAgICAgICAgaGFzaE1hcC5wdXQoInBob3RvR2FsbGVyeSIsIGpzb24uZHVtcHMoW10pKQoKICAgIGhhc2hNYXAucHV0KCJTaG93U2NyZWVuIiwgItCi0L7QstCw0YDRi9CX0LDQv9C40YHRjCIpCgogICAgcmV0dXJuIGhhc2hNYXAsIG5vbV9pZAoKCmRlZiBnb29kc19pbnB1dChoYXNoTWFwLCBfZmlsZXM9Tm9uZSwgX2RhdGE9Tm9uZSk6CiAgICBnbG9iYWwgbm9tX2lkCgogICAgaWYgaGFzaE1hcC5nZXQoImxpc3RlbmVyIikgPT0gImJ0bl9hZGQiOgogICAgICAgIGhhc2hNYXAucHV0KCJuYW1lIiwgIiIpCiAgICAgICAgaGFzaE1hcC5wdXQoImJhcmNvZGUiLCAiIikKICAgICAgICBoYXNoTWFwLnB1dCgidW5pdCIsICIiKQogICAgICAgIGhhc2hNYXAucHV0KCJncm91cCIsICIiKQogICAgICAgIGhhc2hNYXAucHV0KCJwcmljZSIsICIwIikKICAgICAgICBoYXNoTWFwLnB1dCgidW5pcXVlIiwgImZhbHNlIikKICAgICAgICBoYXNoTWFwLnB1dCgicHJvZHVjdF9udW1iZXIiLCAiIikKCiAgICAgICAgaGFzaE1hcC5wdXQoInBob3RvR2FsbGVyeSIsIGpzb24uZHVtcHMoW10pKSAgIyDQv9GD0YHRgtC+0Lkg0YHQv9C40YHQvtC6INC/0L7QtCDQs9Cw0LvQtdGA0LXRjgoKICAgICAgICBub21faWQgPSAtMQogICAgICAgIGhhc2hNYXAucHV0KCJTaG93U2NyZWVuIiwgItCi0L7QstCw0YDRi9CX0LDQv9C40YHRjCIpCgoKICAgIGVsaWYgaGFzaE1hcC5nZXQoImxpc3RlbmVyIikgPT0gIkNhcmRzQ2xpY2siOgoKICAgICAgICBoYXNoTWFwLCBub21faWQgPSBvcGVuX25vbShoYXNoTWFwLCBub21faWQsIGhhc2hNYXAuZ2V0KCJzZWxlY3RlZF9jYXJkX2tleSIpKQoKICAgIGVsaWYgaGFzaE1hcC5nZXQoImxpc3RlbmVyIikgPT0gImJhcmNvZGUiOgogICAgICAgICMgaGFzaE1hcC5wdXQoInRvYXN0IixoYXNoTWFwLmdldCgiYmFyY29kZV9pbnB1dCIpKQogICAgICAgIHdpdGggZGJfc2Vzc2lvbjogICMg0JfQsNC80LXQvdC40LshISEKICAgICAgICAgICAgbm9tID0gdWlfZ2xvYmFsLlNXX0dvb2RzLmdldChiYXJjb2RlPWhhc2hNYXAuZ2V0KCJiYXJjb2RlX3NlYXJjaCIpKQogICAgICAgICAgICBpZiBub20gPT0gTm9uZToKICAgICAgICAgICAgICAgIGhhc2hNYXAucHV0KCJ0b2FzdCIsICLQotC+0LLQsNGAINC90LUg0L3QsNC50LTQtdC9IikKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIGhhc2hNYXAsIG5vbV9pZCA9IG9wZW5fbm9tKGhhc2hNYXAsIG5vbV9pZCwgc3RyKG5vbS5pZCkpCgogICAgICAgICAgICAgICAgaGFzaE1hcC5wdXQoInNwZWFrIiwgbm9tLm5hbWUpCgoKICAgIGVsaWYgaGFzaE1hcC5nZXQoImxpc3RlbmVyIikgPT0gInZpc2lvbiI6CiAgICAgICAgIyBoYXNoTWFwLnB1dCgidG9hc3QiLGhhc2hNYXAuZ2V0KCJub21faWQiKSkKICAgICAgICB3aXRoIGRiX3Nlc3Npb246ICAjINCX0LDQvNC10L3QuNC7ISEhCiAgICAgICAgICAgIG5vbSA9IHVpX2dsb2JhbC5TV19Hb29kcy5nZXQoaWQ9aW50KGhhc2hNYXAuZ2V0KCJub21faWQiKSkpCiAgICAgICAgICAgIGlmIG5vbSA9PSBOb25lOgogICAgICAgICAgICAgICAgaGFzaE1hcC5wdXQoInRvYXN0IiwgItCi0L7QstCw0YAg0L3QtSDQvdCw0LnQtNC10L0iKQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgaGFzaE1hcCwgbm9tX2lkID0gb3Blbl9ub20oaGFzaE1hcCwgbm9tX2lkLCBzdHIobm9tLmlkKSkKICAgICAgICAgICAgICAgIGhhc2hNYXAucHV0KCJzcGVhayIsIG5vbS5uYW1lKQogICAgZWxpZiBoYXNoTWFwLmdldCgibGlzdGVuZXIiKSA9PSAnT05fQkFDS19QUkVTU0VEJzoKICAgICAgICBoYXNoTWFwLnB1dCgiU2hvd1NjcmVlbiIsICLQnNC10L3RjiDQndCh0JgiKQoKICAgIHJldHVybiBoYXNoTWFwCgoKCgpkZWYgZ2V0X2lmX2V4aXN0KGhhc2hNYXAsIGZpZWxkKToKICAgIGlmIGhhc2hNYXAuY29udGFpbnNLZXkoZmllbGQpOgogICAgICAgIHJlcyA9IGhhc2hNYXAuZ2V0KGZpZWxkKQogICAgZWxzZToKICAgICAgICByZXMgPSAiIgogICAgcmV0dXJuIHJlcwoKCmRlZiBnZXRib29sZWFuX2lmX2V4aXN0KGhhc2hNYXAsIGZpZWxkKToKICAgIGlmIG5vdCBoYXNoTWFwLmNvbnRhaW5zS2V5KGZpZWxkKToKICAgICAgICByZXMgPSAwCiAgICBlbHNlOgogICAgICAgIGlmIGhhc2hNYXAuZ2V0KGZpZWxkKSA9PSAidHJ1ZSI6CiAgICAgICAgICAgIHJlcyA9IDEKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXMgPSAwCgogICAgcmV0dXJuIHJlcwoKCmRlZiBnZXRmbG9hdF9pZl9leGlzdChoYXNoTWFwLCBmaWVsZCk6CiAgICBpZiBub3QgaGFzaE1hcC5jb250YWluc0tleShmaWVsZCk6CiAgICAgICAgcmVzID0gMAogICAgZWxzZToKICAgICAgICB0cnk6CiAgICAgICAgICAgIHJlcyA9IGZsb2F0KGhhc2hNYXAuZ2V0KGZpZWxkKSkKCiAgICAgICAgZXhjZXB0OgogICAgICAgICAgICByZXR1cm4gMAogICAgcmV0dXJuIHJlcwoKCmRlZiBzYXZlX25vbShoYXNoTWFwKToKICAgIGdsb2JhbCBub21faWQKICAgIGlmIG5vdCBoYXNoTWFwLmNvbnRhaW5zS2V5KCJuYW1lIik6CiAgICAgICAgaGFzaE1hcC5wdXQoInRvYXN0IiwgItCd0LUg0YPQutCw0LfQsNC90L4g0L3QsNC40LzQtdC90L7QstCw0L3QuNC1IikKICAgICAgICByZXR1cm4gaGFzaE1hcCwgRmFsc2UKICAgIGVsc2U6CiAgICAgICAgaWYgbGVuKGhhc2hNYXAuZ2V0KCJuYW1lIikpID09IDA6CiAgICAgICAgICAgIGhhc2hNYXAucHV0KCJ0b2FzdCIsICLQndC1INGD0LrQsNC30LDQvdC+INC90LDQuNC80LXQvdC+0LLQsNC90LjQtSIpCiAgICAgICAgICAgIHJldHVybiBoYXNoTWFwLCBGYWxzZQoKICAgIGlmIG5vdCBoYXNoTWFwLmNvbnRhaW5zS2V5KCJ1bml0Iik6CiAgICAgICAgaGFzaE1hcC5wdXQoInRvYXN0IiwgItCd0LUg0YPQutCw0LfQsNC90LAg0LXQtNC40L3QuNGG0LAiKQogICAgICAgIHJldHVybiBoYXNoTWFwLCBGYWxzZQogICAgZWxzZToKICAgICAgICBpZiBsZW4oaGFzaE1hcC5nZXQoInVuaXQiKSkgPT0gMDoKICAgICAgICAgICAgaGFzaE1hcC5wdXQoInRvYXN0IiwgItCd0LUg0YPQutCw0LfQsNC90LAg0LXQtNC40L3QuNGG0LAiKQogICAgICAgICAgICByZXR1cm4gaGFzaE1hcCwgRmFsc2UKCiAgICBpZiBub21faWQgPCAwOgoKICAgICAgICB3aXRoIGRiX3Nlc3Npb246CiAgICAgICAgICAgIHIgPSB1aV9nbG9iYWwuU1dfR29vZHMobmFtZT1nZXRfaWZfZXhpc3QoaGFzaE1hcCwgIm5hbWUiKSwgYmFyY29kZT1nZXRfaWZfZXhpc3QoaGFzaE1hcCwgImJhcmNvZGUiKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1bml0PWdldF9pZl9leGlzdChoYXNoTWFwLCAidW5pdCIpLCBncm91cD1nZXRfaWZfZXhpc3QoaGFzaE1hcCwgImdyb3VwIiksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJvZHVjdF9udW1iZXI9Z2V0X2lmX2V4aXN0KGhhc2hNYXAsICJwcm9kdWN0X251bWJlciIpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByaWNlPWdldGZsb2F0X2lmX2V4aXN0KGhhc2hNYXAsICJwcmljZSIpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVuaXF1ZT1nZXRib29sZWFuX2lmX2V4aXN0KGhhc2hNYXAsICJ1bmlxdWUiKSkKICAgICAgICAgICAgbm9tX2lkID0gci5pZAogICAgICAgICAgICBjb21taXQoKQogICAgZWxzZToKICAgICAgICB3aXRoIGRiX3Nlc3Npb246CgogICAgICAgICAgICByID0gdWlfZ2xvYmFsLlNXX0dvb2RzW25vbV9pZF0KICAgICAgICAgICAgci5uYW1lID0gZ2V0X2lmX2V4aXN0KGhhc2hNYXAsICJuYW1lIikKICAgICAgICAgICAgci5iYXJjb2RlID0gZ2V0X2lmX2V4aXN0KGhhc2hNYXAsICJiYXJjb2RlIikKICAgICAgICAgICAgci51bml0ID0gZ2V0X2lmX2V4aXN0KGhhc2hNYXAsICJ1bml0IikKICAgICAgICAgICAgci5ncm91cCA9IGdldF9pZl9leGlzdChoYXNoTWFwLCAiZ3JvdXAiKQogICAgICAgICAgICByLnByb2R1Y3RfbnVtYmVyID0gZ2V0X2lmX2V4aXN0KGhhc2hNYXAsICJwcm9kdWN0X251bWJlciIpCiAgICAgICAgICAgIHIucHJpY2UgPSBnZXRmbG9hdF9pZl9leGlzdChoYXNoTWFwLCAicHJpY2UiKQogICAgICAgICAgICByLnVuaXF1ZSA9IGdldGJvb2xlYW5faWZfZXhpc3QoaGFzaE1hcCwgInVuaXF1ZSIpCgogICAgICAgICAgICBqID0ge30KCiAgICAgICAgICAgIGpbJ3Bob3RvJ10gPSBqc29uLmxvYWRzKGhhc2hNYXAuZ2V0KCJwaG90b0dhbGxlcnkiKSkKICAgICAgICAgICAgci5waWN0dXJlcyA9IGoKCiAgICAgICAgICAgIGNvbW1pdCgpCiAgICByZXR1cm4gaGFzaE1hcCwgVHJ1ZQoKCgpkZWYgZ29vZHNfcmVjb3JkX29uX3N0YXJ0KGhhc2hNYXAsIF9maWxlcz1Ob25lLCBfZGF0YT1Ob25lKToKICAgIGhhc2hNYXAucHV0KCJtbV9sb2NhbCIsICIiKQogICAgaGFzaE1hcC5wdXQoIm1tX2NvbXByZXNzaW9uIiwgIjcwIikKICAgIGhhc2hNYXAucHV0KCJtbV9zaXplIiwgIjY1IikKCiAgICBoYXNoTWFwLnB1dCgiZmlsbF9uYW1lIiwganNvbi5kdW1wcyh7ImhpbnQiOiAi0JLQstC10LTQuNGC0LUg0L3QsNC40LzQtdC90L7QstCw0L3QuNC1INGC0L7QstCw0YDQsCIsICJkZWZhdWx0X3RleHQiOiBoYXNoTWFwLmdldCgibmFtZSIpfSkpCiAgICBoYXNoTWFwLnB1dCgiZmlsbF9iYXJjb2RlIiwganNvbi5kdW1wcyh7ImhpbnQiOiAi0JLQstC10LTQuNGC0LUv0L7RgtGB0LrQsNC90LjRgNGD0LnRgtC1INGI0YLRgNC40YXQutC+0LQg0YLQvtCy0LDRgNCwIiwgImRlZmF1bHRfdGV4dCI6IGhhc2hNYXAuZ2V0KCJiYXJjb2RlIil9KSkKICAgIGhhc2hNYXAucHV0KCJmaWxsX3Byb2R1Y3RfbnVtYmVyIiwganNvbi5kdW1wcyh7ImhpbnQiOiAi0JLQstC10LTQuNGC0LUg0LDRgNGC0LjQutGD0Lsg0YLQvtCy0LDRgNCwIiwgImRlZmF1bHRfdGV4dCI6IGhhc2hNYXAuZ2V0KCJwcm9kdWN0X251bWJlciIpfSkpCiAgICBoYXNoTWFwLnB1dCgiZmlsbF9wcmljZSIsIGpzb24uZHVtcHMoeyJoaW50IjogItCS0LLQtdC00LjRgtC1INGG0LXQvdGDIiwgImRlZmF1bHRfdGV4dCI6IGhhc2hNYXAuZ2V0KCJwcmljZSIpfSkpCgogICAgdW5pdHMgPSBbXQogICAgdW5pdHMuYXBwZW5kKCI80JLRi9Cx0LXRgNC40YLQtSDQtdC0LdGG0YMg0LjQt9C80LXRgNC10L3QuNGPIC4uLj4iKQoKICAgIHdpdGggZGJfc2Vzc2lvbjojINCX0LDQvNC10L3QuNC7ISEhCiAgICAgICAgcXVlcnkgPSBzZWxlY3QoYyBmb3IgYyBpbiB1aV9nbG9iYWwuU1dfVW5pdHMpCiAgICAgICAgZm9yIHJlY29yZCBpbiBxdWVyeToKICAgICAgICAgICAgdW5pdHMuYXBwZW5kKHJlY29yZC5uYW1lKQoKICAgICAgICBoYXNoTWFwLnB1dCgidW5pdHMiLCAiOyIuam9pbih1bml0cykpCgogICAgICAgIGdyb3VwcyA9IFtdCiAgICAgICAgZ3JvdXBzLmFwcGVuZCgiPNCS0YvQsdC10YDQuNGC0LUg0LPRgNGD0L/Qv9GDINGC0L7QstCw0YDQvtCyIC4uLj4iKQogICAgICAgIHF1ZXJ5ID0gc2VsZWN0KGMgZm9yIGMgaW4gdWlfZ2xvYmFsLlNXX0dyb3VwcykKICAgICAgICBmb3IgcmVjb3JkIGluIHF1ZXJ5OgogICAgICAgICAgICBncm91cHMuYXBwZW5kKHJlY29yZC5uYW1lKQoKICAgICAgICBoYXNoTWFwLnB1dCgiZ3JvdXBzIiwgIjsiLmpvaW4oZ3JvdXBzKSkKCiAgICAgICAgIyBoYXNoTWFwLnB1dCgidG9hc3QiLGhhc2hNYXAuZ2V0KCJwaG90b0dhbGxlcnkiKSkKCiAgICByZXR1cm4gaGFzaE1hcAoKCgpkZWYgZ29vZHNfcmVjb3JkX2lucHV0KGhhc2hNYXAsIF9maWxlcz1Ob25lLCBfZGF0YT1Ob25lKToKICAgIGdsb2JhbCBub21faWQKICAgIGlmIGhhc2hNYXAuZ2V0KCJsaXN0ZW5lciIpID09ICJidG5fc2F2ZSI6CiAgICAgICAgIyBoYXNoTWFwLnB1dCgidG9hc3QiLHN0cihoYXNoTWFwLmdldCgidW5pcXVlIikpKQoKICAgICAgICBoYXNoTWFwLCBzdWNjZXNzID0gc2F2ZV9ub20oaGFzaE1hcCkKICAgICAgICBpZiBzdWNjZXNzOgogICAgICAgICAgICBoYXNoTWFwLnB1dCgiU2hvd1NjcmVlbiIsICLQlNC+0LHQsNCy0LjRgtGMINGC0L7QstCw0YAiKQoKICAgIGVsaWYgaGFzaE1hcC5nZXQoImxpc3RlbmVyIikgPT0gImJhcmNvZGUiOgogICAgICAgIGhhc2hNYXAucHV0KCJiYXJjb2RlIiwgaGFzaE1hcC5nZXQoImJhcmNvZGVfbm9tIikpCgogICAgZWxpZiBoYXNoTWFwLmdldCgibGlzdGVuZXIiKSA9PSAiQ2FyZHNDbGljayI6CiAgICAgICAgaGFzaE1hcC5wdXQoInRvYXN0Iiwgc3RyKGhhc2hNYXAuZ2V0KCJzZWxlY3RlZF9jYXJkX2tleSIpKSkKCiAgICBlbGlmIGhhc2hNYXAuZ2V0KCJsaXN0ZW5lciIpID09ICdPTl9CQUNLX1BSRVNTRUQnOgogICAgICAgIGhhc2hNYXAucHV0KCJTaG93U2NyZWVuIiwgItCU0L7QsdCw0LLQuNGC0Ywg0YLQvtCy0LDRgCIpCgogICAgZWxpZiBoYXNoTWFwLmdldCgibGlzdGVuZXIiKSA9PSAnbWVudV9kZWwnOgogICAgICAgIHdpdGggZGJfc2Vzc2lvbjoKICAgICAgICAgICAgciA9IHVpX2dsb2JhbC5TV19Hb29kc1tub21faWRdCiAgICAgICAgICAgIHIuZGVsZXRlKCkKICAgICAgICBoYXNoTWFwLnB1dCgiU2hvd1NjcmVlbiIsICLQlNC+0LHQsNCy0LjRgtGMINGC0L7QstCw0YAiKQogICAgICAgIGhhc2hNYXAucHV0KCJ0b2FzdCIsICLQo9C00LDQu9C10L3Qvi4uLiIpCgogICAgZWxpZiBoYXNoTWFwLmdldCgibGlzdGVuZXIiKSA9PSAicGhvdG8iOgoKICAgICAgICAjINCc0L7QttC90L4g0LLQvtC+0LHRidC1INGN0YLQvtCz0L4g0L3QtSDQtNC10LvQsNGC0Ywt0L7RgdGC0LDQstC70Y/RgtGMINC60LDQuiDQtdGB0YLRjC4g0K3RgtC+INC00LvRjyDQv9GA0LjQvNC10YDQsC4KICAgICAgICBpbWFnZV9maWxlID0gc3RyKAogICAgICAgICAgICBoYXNoTWFwLmdldCgicGhvdG9fcGF0aCIpKSAgIyAi0L/QtdGA0LXQvNC10L3QvdCw0Y8iKyJfcGF0aCIgLSDRgdGO0LTQsCDQv9C+0LzQtdGJ0LDQtdGC0YHRjyDQv9GD0YLRjCDQuiDQv9C+0LvRg9GH0LXQvdC90L7QuSDRhNC+0YLQvtCz0YDQsNGE0LjQuAogICAgICAgICMgaGFzaE1hcC5wdXQoInRvYXN0IixzdHIoaGFzaE1hcC5nZXQoInBob3RvX3BhdGgiKSkpCgogICAgICAgICMg0YHRgNCw0LfRgyDRgdC00LXQu9Cw0LXQvCDRhNC+0YLQutGDIC0g0LrQstCw0LTRgNCw0YLQvdC+0LkgLSDRjdGC0L4g0L/RgNC+0YHRgtC+0Lkg0LLQsNGA0LjQsNC90YIuINCc0L7QttC90L4g0YHQtNC10LvQsNGC0Ywg0L3QsNC/0YDQuNC80LXRgCDQvtGC0LTQtdC70YzQviDQvNC40L3QuNCw0YLRjtGA0Ysg0LTQu9GPINGB0L/QuNGB0LrQsCwg0Y3RgtC+INC90LXQvNC90L7Qs9C+INGB0LvQvtC20L3QtdC1CiAgICAgICAgaW1hZ2UgPSBJbWFnZS5vcGVuKGltYWdlX2ZpbGUpCiAgICAgICAgaW0gPSBpbWFnZS5yZXNpemUoKDUwMCwgNTAwKSkKICAgICAgICBpbS5zYXZlKGltYWdlX2ZpbGUpCgogICAgICAgIGpwaG90b2FyciA9IGpzb24ubG9hZHMoaGFzaE1hcC5nZXQoInBob3RvR2FsbGVyeSIpKQogICAgICAgIGhhc2hNYXAucHV0KCJwaG90b0dhbGxlcnkiLCBqc29uLmR1bXBzKGpwaG90b2FycikpCiAgICAgICAgIyBoYXNoTWFwLnB1dCgidG9hc3QiLGpzb24uZHVtcHMoanBob3RvYXJyKSkKCiAgICBlbGlmIGhhc2hNYXAuZ2V0KAogICAgICAgICAgICAibGlzdGVuZXIiKSA9PSAiZ2FsbGVyeV9jaGFuZ2UiOiAgIyDQv9C+0LvRjNC30L7QstCw0YLQtdC70Ywg0LzQvtC20LXRgiDRg9C00LDQu9C40YLRjCDRhNC+0YLQviDQuNC3INCz0LDQu9C10YDQtdC4LiDQndC+0LLRi9C5INC80LDRgdGB0LjQsiDQvdCw0LTQviDQv9C+0LzQtdGB0YLQuNGC0Ywg0Log0LTQvtC60YPQvNC10L3RgtGDCgogICAgICAgIGlmIGhhc2hNYXAuY29udGFpbnNLZXkoInBob3RvR2FsbGVyeSIpOiAgIyDRjdGC0LggMiDQvtCx0YDQsNCx0L7RgtGH0LjQutCwIC0g0LDQvdCw0LvQvtCz0LjRh9C90YvQtSwg0L/RgNC+0YHRgtC+INC00LvRjyDRgNCw0LfQvdGL0YUg0YHQvtCx0YvRgtC40LkKICAgICAgICAgICAganBob3RvYXJyID0ganNvbi5sb2FkcyhoYXNoTWFwLmdldCgicGhvdG9HYWxsZXJ5IikpCiAgICAgICAgICAgIGhhc2hNYXAucHV0KCJwaG90b0dhbGxlcnkiLCBqc29uLmR1bXBzKGpwaG90b2FycikpCiAgICAgICAgICAgICMgaGFzaE1hcC5wdXQoInRvYXN0IiwiIzIiK2pzb24uZHVtcHMoanBob3RvYXJyKSkKCiAgICByZXR1cm4gaGFzaE1hcAoKICAgICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLdCU0L7QsdCw0LLQuNGC0Ywg0Y/Rh9C10LnQutGDCgoKZGVmIGNlbGxzX29uX3N0YXJ0KGhhc2hNYXAsIF9maWxlcz1Ob25lLCBfZGF0YT1Ob25lKToKICAgIGxpc3QgPSB7ImN1c3RvbWNhcmRzIjogewoKICAgICAgICAibGF5b3V0IjogewogICAgICAgICAgICAidHlwZSI6ICJMaW5lYXJMYXlvdXQiLAogICAgICAgICAgICAib3JpZW50YXRpb24iOiAidmVydGljYWwiLAogICAgICAgICAgICAiaGVpZ2h0IjogIm1hdGNoX3BhcmVudCIsCiAgICAgICAgICAgICJ3aWR0aCI6ICJtYXRjaF9wYXJlbnQiLAogICAgICAgICAgICAid2VpZ2h0IjogIjAiLAogICAgICAgICAgICAiRWxlbWVudHMiOiBbCgogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICJ0eXBlIjogIlRleHRWaWV3IiwKICAgICAgICAgICAgICAgICAgICAic2hvd19ieV9jb25kaXRpb24iOiAiIiwKICAgICAgICAgICAgICAgICAgICAiVmFsdWUiOiAiQG5hbWUiLAogICAgICAgICAgICAgICAgICAgICJOb1JlZnJlc2giOiBGYWxzZSwKICAgICAgICAgICAgICAgICAgICAiZG9jdW1lbnRfdHlwZSI6ICIiLAogICAgICAgICAgICAgICAgICAgICJtYXNrIjogIiIsCiAgICAgICAgICAgICAgICAgICAgIlZhcmlhYmxlIjogIiIKICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICJ0eXBlIjogIlRleHRWaWV3IiwKICAgICAgICAgICAgICAgICAgICAic2hvd19ieV9jb25kaXRpb24iOiAiIiwKICAgICAgICAgICAgICAgICAgICAiVmFsdWUiOiAiQGJhcmNvZGUiLAogICAgICAgICAgICAgICAgICAgICJOb1JlZnJlc2giOiBGYWxzZSwKICAgICAgICAgICAgICAgICAgICAiZG9jdW1lbnRfdHlwZSI6ICIiLAogICAgICAgICAgICAgICAgICAgICJtYXNrIjogIiIsCiAgICAgICAgICAgICAgICAgICAgIlZhcmlhYmxlIjogIiIKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgXQogICAgICAgIH0KCiAgICB9CiAgICB9CgogICAgd2l0aCBkYl9zZXNzaW9uOiMg0JfQsNC80LXQvdC40LshISEKICAgICAgICBxdWVyeSA9IHNlbGVjdChjIGZvciBjIGluIHVpX2dsb2JhbC5TV19DZWxscykKICAgICAgICBsaXN0WyJjdXN0b21jYXJkcyJdWyJjYXJkc2RhdGEiXSA9IFtdCgogICAgICAgIGZvciByZWNvcmQgaW4gcXVlcnk6CiAgICAgICAgICAgIGxpc3RbImN1c3RvbWNhcmRzIl1bImNhcmRzZGF0YSJdLmFwcGVuZCh7Im5hbWUiOiByZWNvcmQubmFtZSwgImtleSI6IHJlY29yZC5pZCwgImJhcmNvZGUiOiBzdHIocmVjb3JkLmJhcmNvZGUpfSkKICAgICAgICBoYXNoTWFwLnB1dCgibGlzdCIsIGpzb24uZHVtcHMobGlzdCkpCgogICAgcmV0dXJuIGhhc2hNYXAKCgpkZWYgY2VsbHNfaW5wdXQoaGFzaE1hcCwgX2ZpbGVzPU5vbmUsIF9kYXRhPU5vbmUpOgogICAgZ2xvYmFsIGNlbGxfaWQKCiAgICBpZiBoYXNoTWFwLmdldCgibGlzdGVuZXIiKSA9PSAiYnRuX2FkZCI6CiAgICAgICAgaGFzaE1hcC5wdXQoIm5hbWUiLCAiIikKICAgICAgICBoYXNoTWFwLnB1dCgiYmFyY29kZSIsICIiKQoKICAgICAgICBjZWxsX2lkID0gLTEKICAgICAgICBoYXNoTWFwLnB1dCgiU2hvd1NjcmVlbiIsICLQr9GH0LXQudC60LjQl9Cw0L/QuNGB0YwiKQoKCiAgICBlbGlmIGhhc2hNYXAuZ2V0KCJsaXN0ZW5lciIpID09ICJDYXJkc0NsaWNrIjoKCiAgICAgICAgamxpc3QgPSBqc29uLmxvYWRzKGhhc2hNYXAuZ2V0KCJsaXN0IikpCiAgICAgICAgZ29vZHNhcnJheSA9IGpsaXN0WyJjdXN0b21jYXJkcyJdWydjYXJkc2RhdGEnXQoKICAgICAgICBqcmVjb3JkID0gbmV4dChpdGVtIGZvciBpdGVtIGluIGdvb2RzYXJyYXkgaWYgc3RyKGl0ZW1bImtleSJdKSA9PSBoYXNoTWFwLmdldCgic2VsZWN0ZWRfY2FyZF9rZXkiKSkKCiAgICAgICAgY2VsbF9pZCA9IGpyZWNvcmRbJ2tleSddCiAgICAgICAgaGFzaE1hcC5wdXQoIm5hbWUiLCBqcmVjb3JkWyduYW1lJ10pCiAgICAgICAgaGFzaE1hcC5wdXQoImJhcmNvZGUiLCBqcmVjb3JkWydiYXJjb2RlJ10pCgogICAgICAgIGhhc2hNYXAucHV0KCJTaG93U2NyZWVuIiwgItCv0YfQtdC50LrQuNCX0LDQv9C40YHRjCIpCgogICAgZWxpZiBoYXNoTWFwLmdldCgibGlzdGVuZXIiKSA9PSAnT05fQkFDS19QUkVTU0VEJzoKICAgICAgICBoYXNoTWFwLnB1dCgiU2hvd1NjcmVlbiIsICLQnNC10L3RjiDQndCh0JgiKQoKICAgIHJldHVybiBoYXNoTWFwCgoKZGVmIGNlbGxzX3JlY29yZF9vbl9zdGFydChoYXNoTWFwLCBfZmlsZXM9Tm9uZSwgX2RhdGE9Tm9uZSk6CiAgICBoYXNoTWFwLnB1dCgiZmlsbF9uYW1lIiwganNvbi5kdW1wcyh7ImhpbnQiOiAi0J3QsNC40LzQtdC90L7QstCw0L3QuNC1IiwgImRlZmF1bHRfdGV4dCI6IGhhc2hNYXAuZ2V0KCJuYW1lIil9KSkKICAgIGhhc2hNYXAucHV0KCJmaWxsX2JhcmNvZGUiLCBqc29uLmR1bXBzKHsiaGludCI6ICLQqNGC0YDQuNGF0LrQvtC0IiwgImRlZmF1bHRfdGV4dCI6IGhhc2hNYXAuZ2V0KCJiYXJjb2RlIil9KSkKCiAgICByZXR1cm4gaGFzaE1hcAoKCmRlZiBjZWxsc19yZWNvcmRfaW5wdXQoaGFzaE1hcCwgX2ZpbGVzPU5vbmUsIF9kYXRhPU5vbmUpOgogICAgZ2xvYmFsIGNlbGxfaWQKCiAgICBpZiBoYXNoTWFwLmdldCgibGlzdGVuZXIiKSA9PSAiYnRuX3NhdmUiOgogICAgICAgICMgaGFzaE1hcC5wdXQoInRvYXN0IixzdHIoY2VsbF9pZCkpCgogICAgICAgIGlmIG5vdCBoYXNoTWFwLmNvbnRhaW5zS2V5KCJuYW1lIik6CiAgICAgICAgICAgIGhhc2hNYXAucHV0KCJ0b2FzdCIsICLQndC1INGD0LrQsNC30LDQvdC+INC90LDQuNC80LXQvdC+0LLQsNC90LjQtSIpCiAgICAgICAgICAgIHJldHVybiBoYXNoTWFwCiAgICAgICAgZWxzZToKICAgICAgICAgICAgaWYgbGVuKGhhc2hNYXAuZ2V0KCJuYW1lIikpID09IDA6CiAgICAgICAgICAgICAgICBoYXNoTWFwLnB1dCgidG9hc3QiLCAi0J3QtSDRg9C60LDQt9Cw0L3QviDQvdCw0LjQvNC10L3QvtCy0LDQvdC40LUiKQogICAgICAgICAgICAgICAgcmV0dXJuIGhhc2hNYXAKCiAgICAgICAgaWYgY2VsbF9pZCA8IDA6CgogICAgICAgICAgICB3aXRoIGRiX3Nlc3Npb246CiAgICAgICAgICAgICAgICByID0gdWlfZ2xvYmFsLlNXX0NlbGxzKG5hbWU9Z2V0X2lmX2V4aXN0KGhhc2hNYXAsICJuYW1lIiksIGJhcmNvZGU9Z2V0X2lmX2V4aXN0KGhhc2hNYXAsICJiYXJjb2RlIikpCiAgICAgICAgICAgICAgICBjb21taXQoKQogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHdpdGggZGJfc2Vzc2lvbjoKCiAgICAgICAgICAgICAgICByID0gdWlfZ2xvYmFsLlNXX0NlbGxzW2NlbGxfaWRdCiAgICAgICAgICAgICAgICByLm5hbWUgPSBnZXRfaWZfZXhpc3QoaGFzaE1hcCwgIm5hbWUiKQogICAgICAgICAgICAgICAgci5iYXJjb2RlID0gZ2V0X2lmX2V4aXN0KGhhc2hNYXAsICJiYXJjb2RlIikKCiAgICAgICAgICAgICAgICBjb21taXQoKQogICAgICAgIGhhc2hNYXAucHV0KCJTaG93U2NyZWVuIiwgItCU0L7QsdCw0LLQuNGC0Ywg0Y/Rh9C10LnQutGDIikKCiAgICBlbGlmIGhhc2hNYXAuZ2V0KCJsaXN0ZW5lciIpID09ICJiYXJjb2RlIjoKICAgICAgICBoYXNoTWFwLnB1dCgiYmFyY29kZSIsIGhhc2hNYXAuZ2V0KCJiYXJjb2RlX2NlbGwiKSkKCiAgICBlbGlmIGhhc2hNYXAuZ2V0KCJsaXN0ZW5lciIpID09ICJDYXJkc0NsaWNrIjoKICAgICAgICBhID0gVHJ1ZQogICAgICAgICMgaGFzaE1hcC5wdXQoInRvYXN0IixzdHIoaGFzaE1hcC5nZXQoInNlbGVjdGVkX2NhcmRfa2V5IikpKQoKICAgIGVsaWYgaGFzaE1hcC5nZXQoImxpc3RlbmVyIikgPT0gJ09OX0JBQ0tfUFJFU1NFRCc6CiAgICAgICAgaGFzaE1hcC5wdXQoIlNob3dTY3JlZW4iLCAi0JzQtdC90Y4g0J3QodCYIikKICAgIGVsaWYgaGFzaE1hcC5nZXQoImxpc3RlbmVyIikgPT0gJ21lbnVfZGVsJzoKICAgICAgICB3aXRoIGRiX3Nlc3Npb246CiAgICAgICAgICAgIHIgPSB1aV9nbG9iYWwuU1dfQ2VsbHNbY2VsbF9pZF0KICAgICAgICAgICAgci5kZWxldGUoKQogICAgICAgIGhhc2hNYXAucHV0KCJTaG93U2NyZWVuIiwgItCU0L7QsdCw0LLQuNGC0Ywg0Y/Rh9C10LnQutGDIikKICAgICAgICBoYXNoTWFwLnB1dCgidG9hc3QiLCAi0KPQtNCw0LvQtdC90L4uLi4iKQoKICAgIHJldHVybiBoYXNoTWFwCgoKZGVmIGluY29tZV9jZWxsX29uX3N0YXJ0KGhhc2hNYXAsIF9maWxlcz1Ob25lLCBfZGF0YT1Ob25lKToKICAgIGp0ID0gewogICAgICAgICJ0eXBlIjogInRhYmxlIiwKICAgICAgICAidGV4dHNpemUiOiAiMjUiLAogICAgICAgICJoaWRlY2FwdGlvbiI6ICJmYWxzZSIsCiAgICAgICAgImhpZGVpbnRlcmxpbmUiOiAiZmFsc2UiLAogICAgICAgICJjb2x1bW5zIjogWwogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAibmFtZSI6ICJjZWxsIiwKICAgICAgICAgICAgICAgICJoZWFkZXIiOiAi0K/Rh9C10LnQutCwIiwKICAgICAgICAgICAgICAgICJ3ZWlnaHQiOiAiMSIKICAgICAgICAgICAgfSwKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgIm5hbWUiOiAibm9tIiwKICAgICAgICAgICAgICAgICJoZWFkZXIiOiAi0KLQvtCy0LDRgCIsCiAgICAgICAgICAgICAgICAid2VpZ2h0IjogIjIiCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICJuYW1lIjogInF0eSIsCiAgICAgICAgICAgICAgICAiaGVhZGVyIjogItCa0L7Quy3QstC+IiwKICAgICAgICAgICAgICAgICJ3ZWlnaHQiOiAiMSIKICAgICAgICAgICAgfQogICAgICAgIF0sCiAgICAgICAgInJvd3MiOiBbXQogICAgfQoKICAgIGlmIG5vdCBoYXNoTWFwLmNvbnRhaW5zS2V5KCJwZiIpOgogICAgICAgICMgaGFzaE1hcC5wdXQoInRvYXN0Iiwi0J3QvtCy0YvQuSIpCiAgICAgICAgaGFzaE1hcC5wdXQoInBmIiwgIjEiKSAgIyDRhNC70LDQsyDQtNC70Y8g0L7Qv9GA0LXQtNC10LvQtdC90LjRjyDQvdCw0YfQsNC70LAg0L/RgNC+0YbQtdGB0YHQsAogICAgICAgIGhhc2hNYXAucHV0KCJjZW50cmFsX3RhYmxlIiwganNvbi5kdW1wcyhqdCkpCgogICAgY2VsbHMgPSBbXQogICAgY2VsbHMuYXBwZW5kKCI80LLRi9Cx0LXRgNC40YLQtSDRj9GH0LXQudC60YMuLi4+IikKICAgIHdpdGggZGJfc2Vzc2lvbjojINCX0LDQvNC10L3QuNC7ISEhCiAgICAgICAgcXVlcnkgPSBzZWxlY3QoYyBmb3IgYyBpbiB1aV9nbG9iYWwuU1dfQ2VsbHMpCiAgICAgICAgZm9yIHJlY29yZCBpbiBxdWVyeToKICAgICAgICAgICAgY2VsbHMuYXBwZW5kKHJlY29yZC5uYW1lKQoKICAgIGhhc2hNYXAucHV0KCJjZWxscyIsICI7Ii5qb2luKGNlbGxzKSkKCiAgICByZXR1cm4gaGFzaE1hcAoKCmRlZiBpbmNvbWVfY2VsbF9vbl9pbnB1dChoYXNoTWFwLCBfZmlsZXM9Tm9uZSwgX2RhdGE9Tm9uZSk6CiAgICAjIGhhc2hNYXAucHV0KCJ0b2FzdCIsaGFzaE1hcC5nZXQoImxpc3RlbmVyIikpCgogICAgaWYgaGFzaE1hcC5nZXQoImxpc3RlbmVyIikgPT0gIiI6CiAgICAgICAgIyBoYXNoTWFwLnB1dCgidG9hc3QiLCLQktGL0LHQvtGAINGC0L7QstCw0YDQsC0tIikKCiAgICAgICAgaWYgbm90IGhhc2hNYXAuY29udGFpbnNLZXkoImNlbGwiKToKICAgICAgICAgICAgaGFzaE1hcC5wdXQoInRvYXN0IiwgItCd0LUg0YPQutCw0LfQsNC90LAg0Y/Rh9C10LnQutCwIikKICAgICAgICAgICAgcmV0dXJuIGhhc2hNYXAKICAgICAgICBlbHNlOgogICAgICAgICAgICBpZiBsZW4oaGFzaE1hcC5nZXQoImNlbGwiKSkgPT0gMDoKICAgICAgICAgICAgICAgIGhhc2hNYXAucHV0KCJ0b2FzdCIsICLQndC1INGD0LrQsNC30LDQvdCwINGP0YfQtdC50LrQsCIpCiAgICAgICAgICAgICAgICByZXR1cm4gaGFzaE1hcAoKICAgICAgICBoYXNoTWFwLnB1dCgiU2hvd1NjcmVlbiIsICLQktGL0LHQvtGAINGC0L7QstCw0YDQsCIpCgogICAgZWxpZiBoYXNoTWFwLmdldCgibGlzdGVuZXIiKSA9PSAiYmFyY29kZSI6CiAgICAgICAgd2l0aCBkYl9zZXNzaW9uOiAgIyDQl9Cw0LzQtdC90LjQuyEhIQogICAgICAgICAgICBjZWxsID0gdWlfZ2xvYmFsLlNXX0NlbGxzLmdldChiYXJjb2RlPWhhc2hNYXAuZ2V0KCJiYXJjb2RlX2NlbGwiKSkKICAgICAgICBpZiBjZWxsID09IE5vbmU6CiAgICAgICAgICAgIGhhc2hNYXAucHV0KCJ0b2FzdCIsICLQr9GH0LXQudC60LAg0L3QtSDQvdCw0LnQtNC10L3QsCIpCiAgICAgICAgZWxzZToKICAgICAgICAgICAgaGFzaE1hcC5wdXQoImNlbGwiLCBjZWxsLm5hbWUpCiAgICAgICAgICAgIGhhc2hNYXAucHV0KCJjZWxsX2lkIiwgc3RyKGNlbGwuaWQpKQogICAgICAgICAgICBoYXNoTWFwLnB1dCgidGFibGVfb2JqZWN0IiwgZ2V0X3RhYmxlX2J5X2NlbGwoY2VsbC5pZCkpI25ldyDQtNC+0LHQsNCy0LjQuyDRgtCw0LHQu9C40YbRgyDQtNC70Y8g0L7RgdGC0LDRgtC60L7QsiDRgtC+0LLQsNGA0LAg0LIg0Y3RgtC+0Lkg0Y/Rh9C10LnQutC1CiAgICAgICAgICAgIGhhc2hNYXAucHV0KCJTaG93U2NyZWVuIiwgItCS0YvQsdC+0YAg0YLQvtCy0LDRgNCwIikKCiAgICBlbGlmIGhhc2hNYXAuZ2V0KCJsaXN0ZW5lciIpID09ICdjZWxsJzoKICAgICAgICB3aXRoIGRiX3Nlc3Npb246ICAjINCX0LDQvNC10L3QuNC7ISEhCiAgICAgICAgICAgIGNlbGwgPSB1aV9nbG9iYWwuU1dfQ2VsbHMuZ2V0KG5hbWU9aGFzaE1hcC5nZXQoImNlbGwiKSkKICAgICAgICBpZiBjZWxsID09IE5vbmU6CiAgICAgICAgICAgIGhhc2hNYXAucHV0KCJ0b2FzdCIsICLQr9GH0LXQudC60LAg0L3QtSDQvdCw0LnQtNC10L3QsCIpCiAgICAgICAgZWxzZToKICAgICAgICAgICAgaGFzaE1hcC5wdXQoImNlbGwiLCBjZWxsLm5hbWUpCiAgICAgICAgICAgIGhhc2hNYXAucHV0KCJjZWxsX2lkIiwgc3RyKGNlbGwuaWQpKQogICAgICAgICAgICBoYXNoTWFwLnB1dCgidGFibGVfb2JqZWN0IixnZXRfdGFibGVfYnlfY2VsbChjZWxsLmlkKSkgICNuZXcg0LTQvtCx0LDQstC40Lsg0YLQsNCx0LvQuNGG0YMg0LTQu9GPINC+0YHRgtCw0YLQutC+0LIg0YLQvtCy0LDRgNCwINCyINGN0YLQvtC5INGP0YfQtdC50LrQtQogICAgICAgICAgICBoYXNoTWFwLnB1dCgiU2hvd1NjcmVlbiIsICLQktGL0LHQvtGAINGC0L7QstCw0YDQsCIpCgogICAgcmV0dXJuIGhhc2hNYXAKCgpkZWYgaW5jb21lX25vbV9pbnB1dChoYXNoTWFwLCBfZmlsZXM9Tm9uZSwgX2RhdGE9Tm9uZSk6CiAgICAjIGhhc2hNYXAucHV0KCJ0b2FzdCIsaGFzaE1hcC5nZXQoImxpc3RlbmVyIikpCgogICAgaWYgaGFzaE1hcC5nZXQoImxpc3RlbmVyIikgPT0gIiI6CgogICAgICAgIGlmIG5vdCBoYXNoTWFwLmNvbnRhaW5zS2V5KCJub20iKToKICAgICAgICAgICAgaGFzaE1hcC5wdXQoInRvYXN0IiwgItCd0LUg0YPQutCw0LfQsNC9INGC0L7QstCw0YAiKQogICAgICAgICAgICByZXR1cm4gaGFzaE1hcAogICAgICAgIGVsc2U6CiAgICAgICAgICAgIGlmIGxlbihoYXNoTWFwLmdldCgiY2VsbCIpKSA9PSAwOgogICAgICAgICAgICAgICAgaGFzaE1hcC5wdXQoInRvYXN0IiwgItCd0LUg0YPQutCw0LfQsNC9INGC0L7QstCw0YAiKQogICAgICAgICAgICAgICAgcmV0dXJuIGhhc2hNYXAKCiAgICAgICAgaGFzaE1hcC5wdXQoIlNob3dTY3JlZW4iLCAi0JLQstC+0LQg0LrQvtC70LjRh9C10YHRgtCy0LAiKQogICAgZWxpZiBoYXNoTWFwLmdldCgibGlzdGVuZXIiKSA9PSAiQkFDS19CVVRUT04iOgogICAgICAgIGhhc2hNYXAucHV0KCJTaG93U2NyZWVuIiwgItCS0YvQsdC+0YAg0Y/Rh9C10LnQutC4IikKICAgIGVsaWYgaGFzaE1hcC5nZXQoImxpc3RlbmVyIikgPT0gImJhcmNvZGUiOgogICAgICAgIHdpdGggZGJfc2Vzc2lvbjogICMg0JfQsNC80LXQvdC40LshISEKICAgICAgICAgICAgbm9tID0gdWlfZ2xvYmFsLlNXX0dvb2RzLmdldChiYXJjb2RlPWhhc2hNYXAuZ2V0KCJiYXJjb2RlIikpCiAgICAgICAgaWYgbm9tID09IE5vbmU6CiAgICAgICAgICAgIGhhc2hNYXAucHV0KCJ0b2FzdCIsICLQotC+0LLQsNGAINC90LUg0L3QsNC50LTQtdC9IikKICAgICAgICBlbHNlOgogICAgICAgICAgICBoYXNoTWFwLnB1dCgibm9tIiwgbm9tLm5hbWUpCiAgICAgICAgICAgIGhhc2hNYXAucHV0KCJub21faWQiLCBzdHIobm9tLmlkKSkKICAgICAgICAgICAgaGFzaE1hcC5wdXQoInNwZWFrIiwgbm9tLm5hbWUpCiAgICAgICAgICAgIGhhc2hNYXAucHV0KCJTaG93U2NyZWVuIiwgItCS0LLQvtC0INC60L7Qu9C40YfQtdGB0YLQstCwIikKICAgICAgICAgICAgaGFzaE1hcC5wdXQoInF0eSIsICIxIikKCiAgICBlbGlmIGhhc2hNYXAuZ2V0KCJsaXN0ZW5lciIpID09ICJ2aXNpb24iOgogICAgICAgICMgaGFzaE1hcC5wdXQoInRvYXN0IixoYXNoTWFwLmdldCgibm9tX2lkIikpCiAgICAgICAgd2l0aCBkYl9zZXNzaW9uOiAgIyDQl9Cw0LzQtdC90LjQuyEhIQogICAgICAgICAgICBub20gPSB1aV9nbG9iYWwuU1dfR29vZHMuZ2V0KGlkPWludChoYXNoTWFwLmdldCgibm9tX2lkIikpKQogICAgICAgIGlmIG5vbSA9PSBOb25lOgogICAgICAgICAgICBoYXNoTWFwLnB1dCgidG9hc3QiLCAi0KLQvtCy0LDRgCDQvdC1INC90LDQudC00LXQvSIpCiAgICAgICAgZWxzZToKICAgICAgICAgICAgaGFzaE1hcC5wdXQoIm5vbSIsIG5vbS5uYW1lKQogICAgICAgICAgICBoYXNoTWFwLnB1dCgibm9tX2lkIiwgc3RyKG5vbS5pZCkpCiAgICAgICAgICAgIGhhc2hNYXAucHV0KCJzcGVhayIsIG5vbS5uYW1lKQogICAgICAgICAgICBoYXNoTWFwLnB1dCgiU2hvd1NjcmVlbiIsICLQktCy0L7QtCDQutC+0LvQuNGH0LXRgdGC0LLQsCIpCiAgICAgICAgICAgIGhhc2hNYXAucHV0KCJxdHkiLCAiMSIpCgogICAgcmV0dXJuIGhhc2hNYXAKCgpkZWYgaW5jb21lX3F0eV9pbnB1dChoYXNoTWFwLCBfZmlsZXM9Tm9uZSwgX2RhdGE9Tm9uZSk6CiAgICBpZiBoYXNoTWFwLmdldCgibGlzdGVuZXIiKSA9PSAiIjoKCiAgICAgICAgaWYgZ2V0ZmxvYXRfaWZfZXhpc3QoaGFzaE1hcCwgInF0eSIpID4gMDoKICAgICAgICAgICAgd2l0aCBkYl9zZXNzaW9uOgogICAgICAgICAgICAgICAgciA9IHVpX2dsb2JhbC5TV19BY2NvdW50KHF0eT1nZXRmbG9hdF9pZl9leGlzdChoYXNoTWFwLCAicXR5IiksIHNrdT1pbnQoaGFzaE1hcC5nZXQoIm5vbV9pZCIpKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjZWxsPWludChoYXNoTWFwLmdldCgiY2VsbF9pZCIpKSkKICAgICAgICAgICAgICAgIGNvbW1pdCgpCgoKICAgICAgICBlbHNlOgoKICAgICAgICAgICAgaGFzaE1hcC5wdXQoInRvYXN0IiwgItCd0LUg0YPQutCw0LfQsNC90L4g0LrQvtC7LdCy0L4iKQogICAgICAgICAgICByZXR1cm4gaGFzaE1hcAoKICAgIGp0ID0ganNvbi5sb2FkcyhoYXNoTWFwLmdldCgiY2VudHJhbF90YWJsZSIpKQogICAganRbJ3Jvd3MnXS5hcHBlbmQoeyJjZWxsIjogaGFzaE1hcC5nZXQoImNlbGwiKSwgIm5vbSI6IGhhc2hNYXAuZ2V0KCJub20iKSwgInF0eSI6IGhhc2hNYXAuZ2V0KCJxdHkiKX0pCgogICAgaGFzaE1hcC5wdXQoImNlbnRyYWxfdGFibGUiLCBqc29uLmR1bXBzKGp0KSkKICAgIGhhc2hNYXAucHV0KCJ0YWJsZV9vYmplY3QiLCBnZXRfdGFibGVfYnlfY2VsbChpbnQoaGFzaE1hcC5nZXQoJ2NlbGxfaWQnKSkpKSAgIyBuZXcg0LTQvtCx0LDQstC40Lsg0YLQsNCx0LvQuNGG0YMg0LTQu9GPINC+0YHRgtCw0YLQutC+0LIg0YLQvtCy0LDRgNCwINCyINGN0YLQvtC5INGP0YfQtdC50LrQtQogICAgaGFzaE1hcC5wdXQoIlNob3dTY3JlZW4iLCAi0JLRi9Cx0L7RgCDRgtC+0LLQsNGA0LAiKQoKICAgIHJldHVybiBoYXNoTWFwCgoKZGVmIG91dGNvbWVfcXR5X2lucHV0KGhhc2hNYXAsIF9maWxlcz1Ob25lLCBfZGF0YT1Ob25lKToKICAgIGlmIGhhc2hNYXAuZ2V0KCJsaXN0ZW5lciIpID09ICIiOgoKICAgICAgICBpZiBnZXRmbG9hdF9pZl9leGlzdChoYXNoTWFwLCAicXR5IikgPiAwOgogICAgICAgICAgICB3aXRoIGRiX3Nlc3Npb246CiAgICAgICAgICAgICAgICByID0gdWlfZ2xvYmFsLlNXX0FjY291bnQocXR5PS0xICogZ2V0ZmxvYXRfaWZfZXhpc3QoaGFzaE1hcCwgInF0eSIpLCBza3U9aW50KGhhc2hNYXAuZ2V0KCJub21faWQiKSksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2VsbD1pbnQoaGFzaE1hcC5nZXQoImNlbGxfaWQiKSkpCiAgICAgICAgICAgICAgICBzZWxlY3RfZ29vZHMgPSBzZWxlY3QoZy5xdHkgZm9yIGcgaW4gdWlfZ2xvYmFsLlNXX0FjY291bnQgaWYgZy5za3U9PWludChoYXNoTWFwLmdldCgibm9tX2lkIikpIGFuZCBnLmNlbGw9PWludChoYXNoTWFwLmdldCgiY2VsbF9pZCIpKSlbOl0KICAgICAgICAgICAgICAgIGlmIHN1bShzZWxlY3RfZ29vZHMpKygtMSAqIGdldGZsb2F0X2lmX2V4aXN0KGhhc2hNYXAsICJxdHkiKSk8MDoKICAgICAgICAgICAgICAgICAgICBoYXNoTWFwLnB1dCgidG9hc3QiLCAi0J7RgtCz0YDRg9C20LXQvdC+INCx0L7Qu9GM0YjQtSwg0YfQtdC8INC10YHRgtGMINC90LAg0YHQutC70LDQtNC1ISEhIikKICAgICAgICAgICAgICAgIGNvbW1pdCgpCgogICAgICAgIGVsc2U6CgogICAgICAgICAgICBoYXNoTWFwLnB1dCgidG9hc3QiLCAi0J3QtSDRg9C60LDQt9Cw0L3QviDQutC+0Lst0LLQviIpCiAgICAgICAgICAgIHJldHVybiBoYXNoTWFwCgogICAganQgPSBqc29uLmxvYWRzKGhhc2hNYXAuZ2V0KCJjZW50cmFsX3RhYmxlIikpCiAgICBqdFsncm93cyddLmFwcGVuZCh7ImNlbGwiOiBoYXNoTWFwLmdldCgiY2VsbCIpLCAibm9tIjogaGFzaE1hcC5nZXQoIm5vbSIpLCAicXR5IjogaGFzaE1hcC5nZXQoInF0eSIpfSkKCiAgICBoYXNoTWFwLnB1dCgiY2VudHJhbF90YWJsZSIsIGpzb24uZHVtcHMoanQpKQogICAgaGFzaE1hcC5wdXQoInRhYmxlX29iamVjdCIsIGdldF90YWJsZV9ieV9jZWxsKGludChoYXNoTWFwLmdldCgnY2VsbF9pZCcpKSkpICAjIG5ldyDQtNC+0LHQsNCy0LjQuyDRgtCw0LHQu9C40YbRgyDQtNC70Y8g0L7RgdGC0LDRgtC60L7QsiDRgtC+0LLQsNGA0LAg0LIg0Y3RgtC+0Lkg0Y/Rh9C10LnQutC1CiAgICBoYXNoTWFwLnB1dCgiU2hvd1NjcmVlbiIsICLQktGL0LHQvtGAINGC0L7QstCw0YDQsCIpCgogICAgcmV0dXJuIGhhc2hNYXAKCgpkZWYgc3RvY2tfb25fY3JlYXRlKGhhc2hNYXAsIF9maWxlcz1Ob25lLCBfZGF0YT1Ob25lKToKICAgIHRhYmxlID0gewogICAgICAgICJ0eXBlIjogInRhYmxlIiwKICAgICAgICAidGV4dHNpemUiOiAiMTciLAoKICAgICAgICAiY29sdW1ucyI6IFsKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgIm5hbWUiOiAiY2VsbCIsCiAgICAgICAgICAgICAgICAiaGVhZGVyIjogItCv0YfQtdC50LrQsCIsCiAgICAgICAgICAgICAgICAid2VpZ2h0IjogIjEiCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICJuYW1lIjogIm5vbSIsCiAgICAgICAgICAgICAgICAiaGVhZGVyIjogItCi0L7QstCw0YAiLAogICAgICAgICAgICAgICAgIndlaWdodCI6ICIyIgogICAgICAgICAgICB9LAogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAibmFtZSI6ICJxdHkiLAogICAgICAgICAgICAgICAgImhlYWRlciI6ICLQntGB0YLQsNGC0L7QuiIsCiAgICAgICAgICAgICAgICAid2VpZ2h0IjogIjEiCiAgICAgICAgICAgIH0KICAgICAgICBdCiAgICB9CgogICAgY29ubiA9IE5vbmUKICAgIHRyeToKICAgICAgICBjb25uID0gc3FsaXRlMy5jb25uZWN0KERCX1BBVEhfZGVidWcpCiAgICBleGNlcHQgRXJyb3IgYXMgZToKICAgICAgICByYWlzZSBWYWx1ZUVycm9yKCfQndC10YIg0YHQvtC10LTQuNC90LXQvdC40Y8g0YEg0LHQsNC30L7QuSEnKQogICAgd2l0aCBkYl9zZXNzaW9uOiAgIyDQl9Cw0LzQtdC90LjQuyEhIQogICAgICAgIGN1cnNvciA9IGNvbm4uY3Vyc29yKCkKICAgICAgICBjdXJzb3IuZXhlY3V0ZSgKICAgICAgICAgICAgJycnU0VMRUNUIFNXX0NlbGxzLm5hbWUgYXMgY2VsbCwgU1dfR29vZHMubmFtZSBhcyBub20sIGlmbnVsbChzdW0ocXR5KSwwKSBhcyBxdHkgCiAgICAgICAgICAgIEZST00gU1dfQWNjb3VudCBMRUZUIEpPSU4gU1dfR29vZHMgT04gU1dfQWNjb3VudC5za3U9U1dfR29vZHMuaWQgTEVGVCBKT0lOIFNXX0NlbGxzIE9OIFNXX0FjY291bnQuY2VsbD1TV19DZWxscy5pZCBHUk9VUCBCWSBTV19Hb29kcy5uYW1lICxTV19DZWxscy5uYW1lIEhBVklORyBpZm51bGwoc3VtKHF0eSksMCk8PjAnJycpCgogICAgICAgIHJlc3VsdHMgPSBjdXJzb3IuZmV0Y2hhbGwoKQoKICAgICAgICByb3dzID0gW10KICAgICAgICBmb3IgcmVjb3JkIGluIHJlc3VsdHM6CiAgICAgICAgICAgIHJvd3MuYXBwZW5kKHsiY2VsbCI6IHJlY29yZFswXSwgIm5vbSI6IHJlY29yZFsxXSwgInF0eSI6IHJlY29yZFsyXX0pCgogICAgdGFibGVbJ3Jvd3MnXSA9IHJvd3MKICAgIGhhc2hNYXAucHV0KCJ0YWJsZSIsIGpzb24uZHVtcHModGFibGUpKQoKICAgIHJldHVybiBoYXNoTWFwCgoKCmRlZiBnZXRfdGFibGVfYnlfbm9tKGlkKToKICAgIHRhYmxlID0gewogICAgICAgICJ0eXBlIjogInRhYmxlIiwKICAgICAgICAidGV4dHNpemUiOiAiMTciLAoKICAgICAgICAiY29sdW1ucyI6IFsKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgIm5hbWUiOiAiY2VsbCIsCiAgICAgICAgICAgICAgICAiaGVhZGVyIjogItCv0YfQtdC50LrQsCIsCiAgICAgICAgICAgICAgICAid2VpZ2h0IjogIjEiCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICJuYW1lIjogIm5vbSIsCiAgICAgICAgICAgICAgICAiaGVhZGVyIjogItCi0L7QstCw0YAiLAogICAgICAgICAgICAgICAgIndlaWdodCI6ICIyIgogICAgICAgICAgICB9LAogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAibmFtZSI6ICJxdHkiLAogICAgICAgICAgICAgICAgImhlYWRlciI6ICLQntGB0YLQsNGC0L7QuiIsCiAgICAgICAgICAgICAgICAid2VpZ2h0IjogIjEiCiAgICAgICAgICAgIH0KICAgICAgICBdCiAgICB9CgogICAgY29ubiA9IE5vbmUKICAgIHRyeToKICAgICAgICBjb25uID0gc3FsaXRlMy5jb25uZWN0KERCX1BBVEhfZGVidWcpCiAgICBleGNlcHQgRXJyb3IgYXMgZToKICAgICAgICByYWlzZSBWYWx1ZUVycm9yKCfQndC10YIg0YHQvtC10LTQuNC90LXQvdC40Y8g0YEg0LHQsNC30L7QuSEnKQoKICAgIGN1cnNvciA9IGNvbm4uY3Vyc29yKCkKICAgIGN1cnNvci5leGVjdXRlKAogICAgICAgICJTRUxFQ1QgU1dfQ2VsbHMubmFtZSBhcyBjZWxsLFNXX0dvb2RzLm5hbWUgYXMgbm9tLCBpZm51bGwoc3VtKHF0eSksMCkgYXMgcXR5IEZST00gU1dfQWNjb3VudCBMRUZUIEpPSU4gU1dfR29vZHMgT04gU1dfQWNjb3VudC5za3U9U1dfR29vZHMuaWQgTEVGVCBKT0lOIFNXX0NlbGxzIE9OIFNXX0FjY291bnQuY2VsbD1TV19DZWxscy5pZCBXSEVSRSBTV19BY2NvdW50LnNrdSA9ICIgKyBzdHIoCiAgICAgICAgICAgIGlkKSArICIgR1JPVVAgQlkgU1dfR29vZHMubmFtZSAsU1dfQ2VsbHMubmFtZSBIQVZJTkcgaWZudWxsKHN1bShxdHkpLDApPD4wIikKCiAgICByZXN1bHRzID0gY3Vyc29yLmZldGNoYWxsKCkKCiAgICByb3dzID0gW10KICAgIGZvciByZWNvcmQgaW4gcmVzdWx0czoKICAgICAgICByb3dzLmFwcGVuZCh7ImNlbGwiOiByZWNvcmRbMF0sICJub20iOiByZWNvcmRbMV0sICJxdHkiOiByZWNvcmRbMl19KQoKICAgIHRhYmxlWydyb3dzJ10gPSByb3dzCgogICAgcmV0dXJuIGpzb24uZHVtcHModGFibGUpCgoKZGVmIHN0b2NrX2lucHV0KGhhc2hNYXAsIF9maWxlcz1Ob25lLCBfZGF0YT1Ob25lKToKICAgIGlmIGhhc2hNYXAuZ2V0KCJsaXN0ZW5lciIpID09ICJiYXJjb2RlIjoKICAgICAgICB3aXRoIGRiX3Nlc3Npb246ICAjINCX0LDQvNC10L3QuNC7ISEhCiAgICAgICAgICAgIG5vbSA9IHVpX2dsb2JhbC5TV19Hb29kcy5nZXQoYmFyY29kZT1oYXNoTWFwLmdldCgiYmFyY29kZSIpKQogICAgICAgIGlzX25vbSA9IEZhbHNlCgogICAgICAgIG9iamVjdCA9ICIiCgogICAgICAgIGlmIG5vbSA9PSBOb25lOgogICAgICAgICAgICBpc19ub20gPSBGYWxzZQogICAgICAgIGVsc2U6CiAgICAgICAgICAgIGlzX25vbSA9IFRydWUKICAgICAgICAgICAgaGFzaE1hcC5wdXQoIm9iamVjdCIsIG5vbS5uYW1lKQogICAgICAgICAgICBoYXNoTWFwLnB1dCgidGFibGVfb2JqZWN0IiwgZ2V0X3RhYmxlX2J5X25vbShub20uaWQpKQogICAgICAgICAgICBoYXNoTWFwLnB1dCgiU2hvd1NjcmVlbiIsICLQntGB0YLQsNGC0LrQuCDQv9C+INC+0LHRitC10LrRgtGDIikKCiAgICAgICAgaWYgbm90IGlzX25vbToKICAgICAgICAgICAgd2l0aCBkYl9zZXNzaW9uOiAgIyDQl9Cw0LzQtdC90LjQuyEhIQogICAgICAgICAgICAgICAgY2VsbCA9IHVpX2dsb2JhbC5TV19DZWxscy5nZXQoYmFyY29kZT1oYXNoTWFwLmdldCgiYmFyY29kZSIpKQogICAgICAgICAgICBpZiBjZWxsID09IE5vbmU6CiAgICAgICAgICAgICAgICBoYXNoTWFwLnB1dCgidG9hc3QiLCAi0KjRgtGA0LjRhdC60L7QtCDQvdC4INGP0YfQtdC50LrQuCDQvdC4INGC0L7QsNGA0LAiKQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgaGFzaE1hcC5wdXQoIm9iamVjdCIsIGNlbGwubmFtZSkKICAgICAgICAgICAgICAgIGhhc2hNYXAucHV0KCJ0YWJsZV9vYmplY3QiLCBnZXRfdGFibGVfYnlfY2VsbChjZWxsLmlkKSkKICAgICAgICAgICAgICAgIGhhc2hNYXAucHV0KCJTaG93U2NyZWVuIiwgItCe0YHRgtCw0YLQutC4INC/0L4g0L7QsdGK0LXQutGC0YMiKQoKICAgIHJldHVybiBoYXNoTWFwCgoKZGVmIHN0b2NrX29iamVjdF9pbnB1dChoYXNoTWFwLCBfZmlsZXM9Tm9uZSwgX2RhdGE9Tm9uZSk6CiAgICBpZiBoYXNoTWFwLmdldCgibGlzdGVuZXIiKSA9PSAiQkFDS19CVVRUT04iOgogICAgICAgIGhhc2hNYXAucHV0KCJTaG93U2NyZWVuIiwgItCe0YHRgtCw0YLQutC4IikKCiAgICByZXR1cm4gaGFzaE1hcAoKCmRlZiBpbnZlbnRvcnlfb25fc3RhcnQoaGFzaE1hcCwgX2ZpbGVzPU5vbmUsIF9kYXRhPU5vbmUpOgogICAgbGlzdCA9IHsiY3VzdG9tY2FyZHMiOiB7CgogICAgICAgICJsYXlvdXQiOiB7CiAgICAgICAgICAgICJ0eXBlIjogIkxpbmVhckxheW91dCIsCiAgICAgICAgICAgICJvcmllbnRhdGlvbiI6ICJ2ZXJ0aWNhbCIsCiAgICAgICAgICAgICJoZWlnaHQiOiAibWF0Y2hfcGFyZW50IiwKICAgICAgICAgICAgIndpZHRoIjogIm1hdGNoX3BhcmVudCIsCiAgICAgICAgICAgICJ3ZWlnaHQiOiAiMCIsCiAgICAgICAgICAgICJFbGVtZW50cyI6IFsKCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgInR5cGUiOiAiVGV4dFZpZXciLAogICAgICAgICAgICAgICAgICAgICJzaG93X2J5X2NvbmRpdGlvbiI6ICIiLAogICAgICAgICAgICAgICAgICAgICJWYWx1ZSI6ICJAZGVzY3IiLAogICAgICAgICAgICAgICAgICAgICJOb1JlZnJlc2giOiBGYWxzZSwKICAgICAgICAgICAgICAgICAgICAiZG9jdW1lbnRfdHlwZSI6ICIiLAogICAgICAgICAgICAgICAgICAgICJtYXNrIjogIiIsCiAgICAgICAgICAgICAgICAgICAgIlZhcmlhYmxlIjogIiIKICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICJ0eXBlIjogIlRleHRWaWV3IiwKICAgICAgICAgICAgICAgICAgICAic2hvd19ieV9jb25kaXRpb24iOiAiIiwKICAgICAgICAgICAgICAgICAgICAiVmFsdWUiOiAiQGRhdGUiLAogICAgICAgICAgICAgICAgICAgICJOb1JlZnJlc2giOiBGYWxzZSwKICAgICAgICAgICAgICAgICAgICAiZG9jdW1lbnRfdHlwZSI6ICIiLAogICAgICAgICAgICAgICAgICAgICJtYXNrIjogIiIsCiAgICAgICAgICAgICAgICAgICAgIlZhcmlhYmxlIjogIiIKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgXQogICAgICAgIH0KCiAgICB9CiAgICB9CgogICAgd2l0aCBkYl9zZXNzaW9uOiMg0JfQsNC80LXQvdC40LshISEKICAgICAgICBxdWVyeSA9IHNlbGVjdChjIGZvciBjIGluIHVpX2dsb2JhbC5TV19JbnZlbnRvcnkpCiAgICAgICAgbGlzdFsiY3VzdG9tY2FyZHMiXVsiY2FyZHNkYXRhIl0gPSBbXQoKICAgICAgICBmb3IgcmVjb3JkIGluIHF1ZXJ5OgogICAgICAgICAgICBsaXN0WyJjdXN0b21jYXJkcyJdWyJjYXJkc2RhdGEiXS5hcHBlbmQoCiAgICAgICAgICAgICAgICB7ImRlc2NyIjogcmVjb3JkLmRlc2NyaXB0aW9uLCAia2V5IjogcmVjb3JkLmlkLCAiZGF0ZSI6IHN0cihyZWNvcmQuY3JlYXRlZF9hdCl9KQogICAgICAgIGhhc2hNYXAucHV0KCJpbnZlbnRvcnkiLCBqc29uLmR1bXBzKGxpc3QpKQoKICAgIHJldHVybiBoYXNoTWFwCgoKZGVmIGludmVudG9yeV9pbnB1dChoYXNoTWFwLCBfZmlsZXM9Tm9uZSwgX2RhdGE9Tm9uZSk6CiAgICBnbG9iYWwgY2VsbF9pZAoKICAgIGlmIGhhc2hNYXAuZ2V0KCJsaXN0ZW5lciIpID09ICJidG5fbmV3IjoKCiAgICAgICAgaGFzaE1hcC5wdXQoIlNob3dTY3JlZW4iLCAi0J3QvtCy0LDRjyDQuNC90LLQtdC90YLQsNGA0LjQt9Cw0YbQuNGPIikKCgogICAgZWxpZiBoYXNoTWFwLmdldCgibGlzdGVuZXIiKSA9PSAiQ2FyZHNDbGljayI6CgogICAgICAgIGpsaXN0ID0ganNvbi5sb2FkcyhoYXNoTWFwLmdldCgiaW52ZW50b3J5IikpCiAgICAgICAgZ29vZHNhcnJheSA9IGpsaXN0WyJjdXN0b21jYXJkcyJdWydjYXJkc2RhdGEnXQoKICAgICAgICBqcmVjb3JkID0gbmV4dChpdGVtIGZvciBpdGVtIGluIGdvb2RzYXJyYXkgaWYgc3RyKGl0ZW1bImtleSJdKSA9PSBoYXNoTWFwLmdldCgic2VsZWN0ZWRfY2FyZF9rZXkiKSkKCiAgICAgICAgaW52X2lkID0ganJlY29yZFsna2V5J10KICAgICAgICBoYXNoTWFwLnB1dCgiaW52X25hbWUiLCBqcmVjb3JkWydkZXNjciddKQogICAgICAgIGhhc2hNYXAucHV0KCJpbnZfaWQiLCBzdHIoaW52X2lkKSkKICAgICAgICBoYXNoTWFwLnB1dCgiaW52X2RhdGUiLCBzdHIoanJlY29yZFsnZGF0ZSddKSkKCiAgICAgICAgaGFzaE1hcC5wdXQoIlNob3dTY3JlZW4iLCAi0JjQvdCy0LXQvdGC0LDRgNC40LfQsNGG0LjRjyDQoNC10LfRg9C70YzRgtCw0YLRiyIpCgogICAgcmV0dXJuIGhhc2hNYXAKCgpkZWYgbmV3aW52X2lucHV0KGhhc2hNYXAsIF9maWxlcz1Ob25lLCBfZGF0YT1Ob25lKToKICAgIGdsb2JhbCBjZWxsX2lkCgogICAgaWYgaGFzaE1hcC5nZXQoImxpc3RlbmVyIikgPT0gIiI6CiAgICAgICAgd2l0aCBkYl9zZXNzaW9uOgogICAgICAgICAgICByID0gdWlfZ2xvYmFsLlNXX0ludmVudG9yeShkZXNjcmlwdGlvbj1oYXNoTWFwLmdldCgnbmFtZScpKQogICAgICAgICAgICBjb21taXQoKQoKICAgICAgICAgICAgaGFzaE1hcC5wdXQoImludl9uYW1lIiwgaGFzaE1hcC5nZXQoJ25hbWUnKSkKICAgICAgICAgICAgaGFzaE1hcC5wdXQoImludl9pZCIsIHN0cihyLmlkKSkKICAgICAgICAgICAgaGFzaE1hcC5wdXQoImludl9kYXRlIiwgc3RyKHIuY3JlYXRlZF9hdCkpCiAgICAgICAgICAgICMgaGFzaE1hcC5wdXQoInRvYXN0IixzdHIoci5pZCkpCgogICAgICAgICAgICBoYXNoTWFwLnB1dCgiU2hvd1NjcmVlbiIsICLQmNC90LLQtdC90YLQsNGA0LjQt9Cw0YbQuNGPINCg0LXQt9GD0LvRjNGC0LDRgtGLIikKCiAgICByZXR1cm4gaGFzaE1hcAoKCmRlZiBpbnZyZXNfb25fc3RhcnQoaGFzaE1hcCwgX2ZpbGVzPU5vbmUsIF9kYXRhPU5vbmUpOgogICAgaW52ZGF0ZSA9IGRhdGV0aW1lLmZyb21pc29mb3JtYXQoc3RyKGhhc2hNYXAuZ2V0KCJpbnZfZGF0ZSIpKSkKICAgIGhhc2hNYXAucHV0KCJpbnYiLAogICAgICAgICAgICAgICAgItCY0L3QstC10L3RgtCw0YDQuNC30LDRhtC40Y8gIiArIHN0cihoYXNoTWFwLmdldCgiaW52X25hbWUiKSkgKyAiINC+0YIgIiArIGludmRhdGUuc3RyZnRpbWUoIiVtLiVkLiVZLCAlSDolTTolUyIpKQoKICAgIHRhYmxlID0gewogICAgICAgICJ0eXBlIjogInRhYmxlIiwKICAgICAgICAidGV4dHNpemUiOiAiMTciLAoKICAgICAgICAiY29sdW1ucyI6IFsKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgIm5hbWUiOiAiY2VsbCIsCiAgICAgICAgICAgICAgICAiaGVhZGVyIjogItCv0YfQtdC50LrQsCIsCiAgICAgICAgICAgICAgICAid2VpZ2h0IjogIjEiCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICJuYW1lIjogIm5vbSIsCiAgICAgICAgICAgICAgICAiaGVhZGVyIjogItCi0L7QstCw0YAiLAogICAgICAgICAgICAgICAgIndlaWdodCI6ICIyIgogICAgICAgICAgICB9LAogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAibmFtZSI6ICJxdHlwbGFuIiwKICAgICAgICAgICAgICAgICJoZWFkZXIiOiAi0J/Qu9Cw0L0iLAogICAgICAgICAgICAgICAgIndlaWdodCI6ICIxIgogICAgICAgICAgICB9LAogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAibmFtZSI6ICJxdHlmYWN0IiwKICAgICAgICAgICAgICAgICJoZWFkZXIiOiAi0KTQsNC60YIiLAogICAgICAgICAgICAgICAgIndlaWdodCI6ICIxIgogICAgICAgICAgICB9CiAgICAgICAgXQogICAgfQoKICAgIGNvbm4gPSBOb25lCiAgICB0cnk6CiAgICAgICAgY29ubiA9IHNxbGl0ZTMuY29ubmVjdChEQl9QQVRIX2RlYnVnKQogICAgZXhjZXB0IEVycm9yIGFzIGU6CiAgICAgICAgcmFpc2UgVmFsdWVFcnJvcign0J3QtdGCINGB0L7QtdC00LjQvdC10L3QuNGPINGBINCx0LDQt9C+0LkhJykKCiAgICBjdXJzb3IgPSBjb25uLmN1cnNvcigpCiAgICBjdXJzb3IuZXhlY3V0ZSgKICAgICAgICAic2VsZWN0IFQuY2VsbCxULm5vbSxtYXgoVC5xdHlwbGFuKSBhcyBxdHlwbGFuLCBpZm51bGwoc3VtKEYucXR5KSwwKSBhcyBxdHlmYWN0IEZST00gKFNFTEVDVCBTV19DZWxscy5uYW1lIGFzIGNlbGwsU1dfR29vZHMubmFtZSBhcyBub20sIGlmbnVsbChzdW0oU1dfQWNjb3VudC5xdHkpLDApIGFzIHF0eXBsYW4sU1dfQWNjb3VudC5za3UgYXMgc2t1aWQsIFNXX0FjY291bnQuY2VsbCBhcyBjZWxsaWQgRlJPTSBTV19BY2NvdW50IExFRlQgSk9JTiBTV19Hb29kcyBPTiBTV19BY2NvdW50LnNrdT1TV19Hb29kcy5pZCBMRUZUIEpPSU4gU1dfQ2VsbHMgT04gU1dfQWNjb3VudC5jZWxsPVNXX0NlbGxzLmlkICAgR1JPVVAgQlkgU1dfR29vZHMubmFtZSAsU1dfQ2VsbHMubmFtZSwgU1dfQWNjb3VudC5jZWxsLCBTV19BY2NvdW50LnNrdSBIQVZJTkcgaWZudWxsKHN1bShTV19BY2NvdW50LnF0eSksMCk8PjApIGFzIFQgTEVGVCBKT0lOIFNXX0ludmVudG9yeV9saW5lIEFTIEYgT04gVC5jZWxsaWQ9Ri5jZWxsIEFORCBULnNrdWlkPUYgLnNrdSBhbmQgRiAuaW52ZW50b3J5PSIgKyBoYXNoTWFwLmdldCgKICAgICAgICAgICAgImludl9pZCIpICsgIiBHUk9VUCBCWSBULmNlbGwsVC5ub20iKQoKICAgIHJlc3VsdHMgPSBjdXJzb3IuZmV0Y2hhbGwoKQoKICAgIHJvd3MgPSBbXQogICAgY29sb3JjZWxscyA9IFtdCiAgICByb3cgPSAwCiAgICBmb3IgcmVjb3JkIGluIHJlc3VsdHM6CgogICAgICAgIHJvd3MuYXBwZW5kKHsiY2VsbCI6IHJlY29yZFswXSwgIm5vbSI6IHJlY29yZFsxXSwgInF0eXBsYW4iOiByZWNvcmRbMl0sICJxdHlmYWN0IjogcmVjb3JkWzNdfSkKICAgICAgICAjINC/0L7QtNC60YDQsNGI0LjQstCw0LXQvCDRgNC10LfRg9C70YzRgtCw0YLRiyDQsiDQt9C10LvQtdC90YvQuSDQuCDQutGA0LDRgdC90YvQuSDRhtCy0LXRgtCwCiAgICAgICAgaWYgcmVjb3JkWzNdID4gMDoKICAgICAgICAgICAgaWYgcmVjb3JkWzNdID49IHJlY29yZFsyXToKICAgICAgICAgICAgICAgIGNvbG9yY2VsbHMuYXBwZW5kKHsicm93Ijogcm93LCAiY29sdW1uIjogIjMiLCAiY29sb3IiOiAiIzMyYTg1MiJ9KQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgY29sb3JjZWxscy5hcHBlbmQoeyJyb3ciOiByb3csICJjb2x1bW4iOiAiMyIsICJjb2xvciI6ICIjZTY0YzRjIn0pCiAgICAgICAgcm93ICs9IDEKCiAgICB0YWJsZVsncm93cyddID0gcm93cwogICAgdGFibGVbJ2NvbG9yY2VsbHMnXSA9IGNvbG9yY2VsbHMKCiAgICBoYXNoTWFwLnB1dCgidGFibGUiLCBqc29uLmR1bXBzKHRhYmxlKSkKCiAgICByZXR1cm4gaGFzaE1hcAoKCmRlZiBpbnZyZXNfaW5wdXQoaGFzaE1hcCwgX2ZpbGVzPU5vbmUsIF9kYXRhPU5vbmUpOgogICAgZ2xvYmFsIGNlbGxfaWQKCiAgICBpZiBoYXNoTWFwLmdldCgibGlzdGVuZXIiKSA9PSAiYnRuX3J1biI6CiAgICAgICAgaGFzaE1hcC5wdXQoIlJ1bkNWIiwgItCY0L3QskNWIikKCiAgICByZXR1cm4gaGFzaE1hcAoKCmRlZiBpbnZjdl9jZWxsX29uX3N0YXJ0KGhhc2hNYXAsIF9maWxlcz1Ob25lLCBfZGF0YT1Ob25lKToKICAgIGdsb2JhbCBjZWxscwogICAgZ2xvYmFsIGNlbGxpZAoKICAgIGNlbGxpZCA9IE5vbmUKCiAgICBpZiBoYXNoTWFwLmNvbnRhaW5zS2V5KCJzdG9wX2xpc3RlbmVyX2xpc3QiKToKICAgICAgICBoYXNoTWFwLnJlbW92ZSgic3RvcF9saXN0ZW5lcl9saXN0IikKCiAgICAjIGNyZWF0ZSBjb25uZWN0aW9uIHdpdGggZGF0YWJhc2UKICAgIGNvbm4gPSBOb25lCiAgICB0cnk6CiAgICAgICAgY29ubiA9IHNxbGl0ZTMuY29ubmVjdChEQl9QQVRIX2RlYnVnKSMg0LHRi9C70L4gLSDQt9Cw0LzQtdC90LjQuygnLy9kYXRhL2RhdGEvcnUudHJhdmVsZm9vZC5zaW1wbGVfdWkvZGF0YWJhc2VzL1NpbXBsZVdNUycpCiAgICBleGNlcHQgRXJyb3IgYXMgZToKICAgICAgICByYWlzZSBWYWx1ZUVycm9yKCfQndC10YIg0YHQvtC10LTQuNC90LXQvdC40Y8g0YEg0LHQsNC30L7QuSEnKQoKICAgIGN1cnNvciA9IGNvbm4uY3Vyc29yKCkKICAgIGN1cnNvci5leGVjdXRlKCJTRUxFQ1QgYmFyY29kZSxpZCxuYW1lIEZST00gU1dfQ2VsbHMiKQoKICAgIHJlc3VsdHMgPSBjdXJzb3IuZmV0Y2hhbGwoKQoKICAgIGdyZWVuX2xpc3QgPSBbXQogICAgcmVkX2xpc3QgPSBbXQogICAgaW5mb19saXN0ID0gW10KICAgIGNlbGxzID0ge30KICAgIGZvciBsaW5rIGluIHJlc3VsdHM6CiAgICAgICAgIyBqb2IgPSB7Im9iamVjdCI6c3RyKGxpbmtbMF0pLCJpbmZvIjpzdHIobGlua1sxXSkrIiA8L24+INCe0YHRgtCw0YLQvtC6OiA8YmlnPiIrc3RyKGxpbmtbMl0pKyI8L2JpZz4ifQogICAgICAgICMgaW5mb19saXN0LmFwcGVuZChqb2IpCiAgICAgICAgZ3JlZW5fbGlzdC5hcHBlbmQobGlua1swXSkKICAgICAgICBjZWxsc1tsaW5rWzBdXSA9IGxpbmtbMV0KCiAgICBjb25uLmNsb3NlKCkKCiAgICAjIGhhc2hNYXAucHV0KCJvYmplY3RfaW5mb19saXN0Iixqc29uLmR1bXBzKGluZm9fbGlzdCxlbnN1cmVfYXNjaWk9RmFsc2UpKQogICAgaGFzaE1hcC5wdXQoImdyZWVuX2xpc3QiLCAnOycuam9pbihncmVlbl9saXN0KSkKCiAgICByZXR1cm4gaGFzaE1hcAoKCmRlZiBpbnZjdl9jZWxsX29uX25ld19vYmplY3QoaGFzaE1hcCwgX2ZpbGVzPU5vbmUsIF9kYXRhPU5vbmUpOgogICAgZ2xvYmFsIGNlbGxzCiAgICBnbG9iYWwgY2VsbGlkCiAgICBnbG9iYWwgZ3JlZW5fc2l6ZSwgeWVsbG93X3NpemUKCiAgICBoYXNoTWFwLnB1dCgidmlicmF0ZSIsICIiKQoKICAgIGNlbGxpZCA9IGNlbGxzLmdldChoYXNoTWFwLmdldCgiY3VycmVudF9vYmplY3QiKSkKCiAgICBpZiBub3QgY2VsbGlkID09IE5vbmU6CgogICAgICAgICMgY3JlYXRlIGNvbm5lY3Rpb24gd2l0aCBkYXRhYmFzZQogICAgICAgIGNvbm4gPSBOb25lCiAgICAgICAgdHJ5OgogICAgICAgICAgICBjb25uID0gc3FsaXRlMy5jb25uZWN0KERCX1BBVEhfZGVidWcpCiAgICAgICAgZXhjZXB0IEVycm9yIGFzIGU6CiAgICAgICAgICAgIHJhaXNlIFZhbHVlRXJyb3IoJ9Cd0LXRgiDRgdC+0LXQtNC40L3QtdC90LjRjyDRgSDQsdCw0LfQvtC5IScpCgogICAgICAgIGN1cnNvciA9IGNvbm4uY3Vyc29yKCkKICAgICAgICB0cnk6CiAgICAgICAgICAgICMg0YLRg9GCINGPINC/0L7QvdGP0Lsg0YfRgtC+INC70LDQttCw0L3Rg9C70YHRjywg0LjRgdC/0L7Qu9GM0LfQvtCy0LDQsiB1bmlxdWUg0LIg0LrQsNGH0LXRgdGC0LLQtSDQuNC80LXQvdC4LCDQvdC+INCx0YvQu9C+INGD0LbQtSDQv9C+0LfQtNC90L4KICAgICAgICAgICAgY3Vyc29yLmV4ZWN1dGUoCiAgICAgICAgICAgICAgICAiU0VMRUNUIFNXX0dvb2RzLmJhcmNvZGUgYXMgYmFyY29kZSxTV19DZWxscy5uYW1lIGFzIGNlbGwsU1dfR29vZHMubmFtZSBhcyBub20sIGlmbnVsbChzdW0ocXR5KSwwKSBhcyBxdHksIFwidW5pcXVlXCIgYXMgdW4sU1dfR29vZHMuaWQgYXMgbm9tX2lkICBGUk9NIFNXX0FjY291bnQgTEVGVCBKT0lOIFNXX0dvb2RzIE9OIFNXX0FjY291bnQuc2t1PVNXX0dvb2RzLmlkIExFRlQgSk9JTiBTV19DZWxscyBPTiBTV19BY2NvdW50LmNlbGw9U1dfQ2VsbHMuaWQgV0hFUkUgU1dfQWNjb3VudC5jZWxsID0gIiArIHN0cigKICAgICAgICAgICAgICAgICAgICBjZWxsaWQpICsgIiBHUk9VUCBCWSBTV19Hb29kcy5uYW1lICxTV19DZWxscy5uYW1lIEhBVklORyBpZm51bGwoc3VtKHF0eSksMCk8PjAiKQogICAgICAgIGV4Y2VwdCBFcnJvciBhcyBlOgogICAgICAgICAgICByYWlzZSBWYWx1ZUVycm9yKGUpCgogICAgICAgIHJlc3VsdHMgPSBjdXJzb3IuZmV0Y2hhbGwoKQoKICAgICAgICBmb3VuZCA9IFtdCgogICAgICAgIHllbGxvd19saXN0ID0gW10KICAgICAgICByZWRfbGlzdCA9IFtdCiAgICAgICAgaW5mb19saXN0ID0gW10KICAgICAgICB5ZWxsb3dfc2l6ZSA9IDAKICAgICAgICBncmVlbl9zaXplID0gMAogICAgICAgICMg0LjRgdC/0L7Qu9GM0LfRg9C10Lwgb2JqZWN0X2luZm9fbGlzdCDQuCDQt9Cw0L/RgNC+0YEg0YfRgtC+0LHRiyDRhdGA0LDQvdC40YLRjCDQt9Cw0L7QtNC90L4g0L3Rg9C20L3Ri9C1INC/0L7Qu9GPLCDQvtC90Lgg0L3Rg9C20L3RiyDQvdC1INC00LvRjyDQvtGC0L7QsdGA0LDQtNCw0LXQvdC40Y8g0LAg0LTQu9GPINC00LDQu9GM0L3QtdC50YjQtdC5INC70L7Qs9C40LrQuCAtIHVuaXF1ZSwgbm9tX2lkCiAgICAgICAgZm9yIGxpbmsgaW4gcmVzdWx0czoKICAgICAgICAgICAgam9iID0geyJvYmplY3QiOiBzdHIobGlua1swXSksICJpbmZvIjogc3RyKGxpbmtbMl0pICsgIiA8L24+INCe0YHRgtCw0YLQvtC6OiA8YmlnPiIgKyBzdHIobGlua1szXSkgKyAiPC9iaWc+IiwKICAgICAgICAgICAgICAgICAgICJ1bmlxdWUiOiBsaW5rWzRdLCAibm9tX2lkIjogc3RyKGxpbmtbNV0pfQogICAgICAgICAgICBpbmZvX2xpc3QuYXBwZW5kKGpvYikKICAgICAgICAgICAgeWVsbG93X2xpc3QuYXBwZW5kKGxpbmtbMF0pCiAgICAgICAgICAgIHllbGxvd19zaXplICs9IDEKCiAgICAgICAgY29ubi5jbG9zZSgpCgogICAgICAgIGhhc2hNYXAucHV0KCJvYmplY3RfaW5mb19saXN0IiwganNvbi5kdW1wcyhpbmZvX2xpc3QsIGVuc3VyZV9hc2NpaT1GYWxzZSkpCiAgICAgICAgaGFzaE1hcC5wdXQoInllbGxvd19saXN0IiwgJzsnLmpvaW4oeWVsbG93X2xpc3QpKQoKICAgICAgICBpbnZkYXRlID0gZGF0ZXRpbWUuZnJvbWlzb2Zvcm1hdChzdHIoaGFzaE1hcC5nZXQoImludl9kYXRlIikpKQogICAgICAgIGhhc2hNYXAucHV0KCJpbnYiLCAi0JjQvdCy0LXQvdGC0LDRgNC40LfQsNGG0LjRjyAiICsgc3RyKGhhc2hNYXAuZ2V0KCJpbnZfbmFtZSIpKSArICIg0L7RgiAiICsgaW52ZGF0ZS5zdHJmdGltZSgKICAgICAgICAgICAgIiVtLiVkLiVZLCAlSDolTTolUyIpICsgIjwvbj4g0J3QsNC50LTQtdC90L46IDxiaWc+IiArIHN0cihncmVlbl9zaXplKSArICI8L2JpZz4iICsgIiDQuNC3ICIgKyAiPGJpZz4iICsgc3RyKAogICAgICAgICAgICB5ZWxsb3dfc2l6ZSkgKyAiPC9iaWc+IikKCiAgICAgICAgaGFzaE1hcC5wdXQoIk5leHRTdGVwIiwgItCi0L7QstCw0YDRiyDRj9GH0LXQudC60LgiKQoKICAgIHJldHVybiBoYXNoTWFwCgoKZGVmIGludmN2X2dvb2RzX29uX25ld19vYmplY3QoaGFzaE1hcCwgX2ZpbGVzPU5vbmUsIF9kYXRhPU5vbmUpOgogICAgZ2xvYmFsIGNlbGxzCiAgICBnbG9iYWwgY2VsbGlkCiAgICBnbG9iYWwgZ3JlZW5fc2l6ZSwgeWVsbG93X3NpemUKCiAgICBub21fYmFyY29kZSA9IHN0cihoYXNoTWFwLmdldCgiY3VycmVudF9vYmplY3QiKSkKCiAgICBpZiBub21fYmFyY29kZSBpbiBoYXNoTWFwLmdldCgieWVsbG93X2xpc3QiKToKCiAgICAgICAgaWYgaGFzaE1hcC5jb250YWluc0tleSgic3RvcF9saXN0ZW5lcl9saXN0Iik6IyDQtdGB0YLRjCDQu9C4IHN0b3BfbGlzdGVuZXJfbGlzdCDQsiBoYXNoTWFwCiAgICAgICAgICAgIHN0b3BfbGlzdCA9IGhhc2hNYXAuZ2V0KCJzdG9wX2xpc3RlbmVyX2xpc3QiKS5zcGxpdCgiOyIpCiAgICAgICAgICAgIHN0b3BfbGlzdC5hcHBlbmQobm9tX2JhcmNvZGUpIyDQtNC+0LHQsNCy0LjRgtGMIG5vbV9iYXJjb2RlINCyIHN0b3BfbGlzdGVuZXJfbGlzdAogICAgICAgICAgICBoYXNoTWFwLnB1dCgic3RvcF9saXN0ZW5lcl9saXN0IiwgIjsiLmpvaW4oc3RvcF9saXN0KSkKICAgICAgICBlbHNlOgogICAgICAgICAgICBoYXNoTWFwLnB1dCgic3RvcF9saXN0ZW5lcl9saXN0Iiwgbm9tX2JhcmNvZGUpCgogICAgICAgIG9iamVjdF9saXN0ID0ganNvbi5sb2FkcyhoYXNoTWFwLmdldCgib2JqZWN0X2luZm9fbGlzdCIpKQoKICAgICAgICB0cnk6I9C/0YDQvtGF0L7QtNC40Lwg0L/QviBvYmplY3RfbGlzdCDQv9C+0LrQsCDQvdC1INC90LDQudC00LXQvCDQvtCx0YrQtdC60YIg0YEg0LHQsNGA0LrQvtC00L7QvCDRgtC10LrRg9GJ0LXQs9C+INC+0LHRitC10LrRgtCwCiAgICAgICAgICAgIG5vbV9yZWNvcmQgPSBuZXh0KGl0ZW0gZm9yIGl0ZW0gaW4gb2JqZWN0X2xpc3QgaWYgc3RyKGl0ZW1bIm9iamVjdCJdKSA9PSBzdHIobm9tX2JhcmNvZGUpKQoKICAgICAgICBleGNlcHQgU3RvcEl0ZXJhdGlvbjoKICAgICAgICAgICAgbm9tX3JlY29yZCA9IE5vbmUKCiAgICAgICAgaWYgbm90IG5vbV9yZWNvcmQgPT0gTm9uZToKICAgICAgICAgICAgaGFzaE1hcC5wdXQoIm5vbV9pZCIsIHN0cihub21fcmVjb3JkLmdldCgibm9tX2lkIikpKSMg0JfQsNC/0LjRgdGMINC90L7QvNC10YDQsCBJRCDRgtC+0LLQsNGA0LAKICAgICAgICAgICAgaWYgaGFzaE1hcC5jb250YWluc0tleSgnd3JpdGVfaWRfbGlzdCcpOgogICAgICAgICAgICAgICAgd3JpdGVfbGlzdCA9IGhhc2hNYXAuZ2V0KCd3cml0ZV9pZF9saXN0Jykuc3BsaXQoJzsnKQogICAgICAgICAgICAgICAgd3JpdGVfbGlzdC5hcHBlbmQoc3RyKG5vbV9yZWNvcmQuZ2V0KCdub21faWQnKSkpCiAgICAgICAgICAgICAgICBoYXNoTWFwLnB1dCgnd3JpdGVfaWRfbGlzdCcsICc7Jy5qb2luKHdyaXRlX2xpc3QpKQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgaGFzaE1hcC5wdXQoJ3dyaXRlX2lkX2xpc3QnLCBzdHIobm9tX3JlY29yZC5nZXQoJ25vbV9pZCcpKSkKICAgICAgICAgICAgIyBoYXNoTWFwLnB1dCgidG9hc3QiLCJub21faWQ9IitzdHIoaGFzaE1hcC5nZXQoIm5vbV9pZCIpKSsiIGludl9pZD0iK3N0cihoYXNoTWFwLmdldCgiaW52X2lkIikpKQogICAgICAgICAgICBpZiBub21fcmVjb3JkWyd1bmlxdWUnXSA9PSAxOiMg0Y3RgtC+INGD0L3QuNC60LDQu9GM0L3Ri9C5INGI0YLRgNC40YXQutC+0LQ/Pz8KCiAgICAgICAgICAgICAgICBoYXNoTWFwLnB1dCgidmlicmF0ZSIsICIiKQogICAgICAgICAgICAgICAgaGFzaE1hcC5wdXQoImJlZXAiLCAiNSIpCgogICAgICAgICAgICAgICAgIyDRjdGC0L4g0YPQvdC40LrQsNC70YzQvdGL0Lkg0YjRgtGA0LjRhdC60L7QtCAtINC00L7QsdCw0LLQu9GP0LXQvCDQtdCz0L4g0LIg0LfQtdC70LXQvdGL0Lkg0YHQv9C40YHQvtC6INGB0YDQsNC30YMg0Lgg0YPQsdC40YDQsNC10Lwg0LjQtyDQttC10LvRgtC+0LPQvgogICAgICAgICAgICAgICAgZ3JlZW5fc2l6ZSA9IDAKICAgICAgICAgICAgICAgIGlmIGhhc2hNYXAuY29udGFpbnNLZXkoImdyZWVuX2xpc3QiKToKICAgICAgICAgICAgICAgICAgICBncmVlbl9saXN0ID0gaGFzaE1hcC5nZXQoImdyZWVuX2xpc3QiKS5zcGxpdCgiOyIpCiAgICAgICAgICAgICAgICAgICAgZ3JlZW5fbGlzdC5hcHBlbmQobm9tX2JhcmNvZGUpCiAgICAgICAgICAgICAgICAgICAgaGFzaE1hcC5wdXQoImdyZWVuX2xpc3QiLCAiOyIuam9pbihncmVlbl9saXN0KSkKCiAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgIGhhc2hNYXAucHV0KCJncmVlbl9saXN0IiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBub21fYmFyY29kZSkKCiAgICAgICAgICAgICAgICBpZiBoYXNoTWFwLmNvbnRhaW5zS2V5KCJ5ZWxsb3dfbGlzdCIpOgogICAgICAgICAgICAgICAgICAgIHllbGxvd19saXN0ID0gaGFzaE1hcC5nZXQoInllbGxvd19saXN0Iikuc3BsaXQoIjsiKQogICAgICAgICAgICAgICAgICAgIHllbGxvd19saXN0LnJlbW92ZShub21fYmFyY29kZSkKICAgICAgICAgICAgICAgICAgICBoYXNoTWFwLnB1dCgieWVsbG93X2xpc3QiLCAiOyIuam9pbih5ZWxsb3dfbGlzdCkpCgogICAgICAgICAgICAgICAgICAgICMg0LTQvtCx0LDQstC70Y/QtdC8INCyINCx0LDQt9GDIC0g0L7QvSDQv9C+0YHRh9C40YLQsNC9CiAgICAgICAgICAgICAgICB3aXRoIGRiX3Nlc3Npb246CiAgICAgICAgICAgICAgICAgICAgZm91bmQuYXBwZW5kKGludChoYXNoTWFwLmdldCgibm9tX2lkIikpKQogICAgICAgICAgICAgICAgICAgIGludmVudG9yeSA9IHVpX2dsb2JhbC5TV19JbnZlbnRvcnlbaW50KGhhc2hNYXAuZ2V0KCJpbnZfaWQiKSldCiAgICAgICAgICAgICAgICAgICAgciA9IHVpX2dsb2JhbC5TV19JbnZlbnRvcnlfbGluZShxdHk9MSwgc2t1PWludChoYXNoTWFwLmdldCgibm9tX2lkIikpLCBjZWxsPWNlbGxpZCwgaW52ZW50b3J5PWludmVudG9yeSkKICAgICAgICAgICAgICAgICAgICBjb21taXQoKQoKICAgICAgICAgICAgICAgIGdyZWVuX3NpemUgKz0gMQogICAgICAgICAgICAgICAgaW52ZGF0ZSA9IGRhdGV0aW1lLmZyb21pc29mb3JtYXQoc3RyKGhhc2hNYXAuZ2V0KCJpbnZfZGF0ZSIpKSkKICAgICAgICAgICAgICAgIGhhc2hNYXAucHV0KCJpbnYiLCAi0JjQvdCy0LXQvdGC0LDRgNC40LfQsNGG0LjRjyAiICsgc3RyKGhhc2hNYXAuZ2V0KCJpbnZfbmFtZSIpKSArICIg0L7RgiAiICsgaW52ZGF0ZS5zdHJmdGltZSgKICAgICAgICAgICAgICAgICAgICAiJW0uJWQuJVksICVIOiVNOiVTIikgKyAiPC9uPiDQndCw0LnQtNC10L3QvjogPGJpZz4iICsgc3RyKGdyZWVuX3NpemUpICsgIjwvYmlnPiIgKyAiINC40LcgIiArICI8YmlnPiIgKyBzdHIoCiAgICAgICAgICAgICAgICAgICAgeWVsbG93X3NpemUpICsgIjwvYmlnPiIpCiAgICAgICAgICAgIGVsc2U6ICAjINC90LXRg9C90LjQutCw0LvRjNC90YvQuSDRiNGC0YDQuNGF0LrQvtC0IC0g0L/RgNC+0YHQuNC8INCy0LLQtdGB0YLQuCDQutC+0Lst0LLQvgogICAgICAgICAgICAgICAgaGFzaE1hcC5wdXQoImJlZXAiLCAiNTAiKQogICAgICAgICAgICAgICAgaWYgaGFzaE1hcC5jb250YWluc0tleSgnd3JpdGVfbGlzdCcpOiAgIyDQtdGB0YLRjCDQu9C4IHdyaXRlX2xpc3Qg0LIgaGFzaE1hcAogICAgICAgICAgICAgICAgICAgIHdyaXRlX2xpc3QgPSBoYXNoTWFwLmdldCgid3JpdGVfbGlzdCIpLnNwbGl0KCI7IikKICAgICAgICAgICAgICAgICAgICB3cml0ZV9saXN0LmFwcGVuZChub21fYmFyY29kZSkgICMg0LTQvtCx0LDQstC40YLRjCBub21fYmFyY29kZSDQsiB3cml0ZV9saXN0CiAgICAgICAgICAgICAgICAgICAgaGFzaE1hcC5wdXQoIndyaXRlX2xpc3QiLCAiOyIuam9pbih3cml0ZV9saXN0KSkKICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgaGFzaE1hcC5wdXQoIndyaXRlX2xpc3QiLCBub21fYmFyY29kZSkKCiAgICAgICAgICAgICAgICBoYXNoTWFwLnB1dCgibm9tIiwgbm9tX3JlY29yZC5nZXQoImluZm8iKSkKICAgICAgICAgICAgICAgIGhhc2hNYXAucHV0KCJub21fYmFyY29kZSIsIG5vbV9iYXJjb2RlKQogICAgICAgICAgICAgICAgaGFzaE1hcC5wdXQoIlNob3dEaWFsb2dQcm9jZXNzIiwgItCY0L3QstC10L3RgtCw0YDQuNC30LDRhtC40Y8gQWN0aXZlIENWIikKICAgICAgICAgICAgICAgIGhhc2hNYXAucHV0KCJTaG93RGlhbG9nIiwgItCU0LjQsNC70L7Qs9CS0LLQvtC00JrQvtC70LjRh9C10YHRgtCy0LAiKQogICAgICAgICAgICAgICAgaGFzaE1hcC5wdXQoIlNob3dEaWFsb2dTdHlsZSIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBqc29uLmR1bXBzKHsidGl0bGUiOiAi0JLQstC10LTQuNGC0LUg0LrQvtC70LjRh9C10YHRgtCy0L4g0YTQsNC60YIiLCAieWVzIjogItCf0L7QtNGC0LLQtdGA0LTQuNGC0YwiLCAibm8iOiAi0J7RgtC80LXQvdCwIn0pKQoKICAgIHJldHVybiBoYXNoTWFwCgoKZGVmIGludmN2X2dvb2RzX2FjdGlvbihoYXNoTWFwLCBfZmlsZXM9Tm9uZSwgX2RhdGE9Tm9uZSk6CiAgICBnbG9iYWwgY2VsbGlkCiAgICBnbG9iYWwgZ3JlZW5fc2l6ZSwgeWVsbG93X3NpemUKCiAgICAjIGhhc2hNYXAucHV0KCJ0b2FzdCIsc3RyKGhhc2hNYXAuZ2V0KCJldmVudCIpKSkKCiAgICBpZiBoYXNoTWFwLmdldCgibGlzdGVuZXIiKSA9PSAib25SZXN1bHRQb3NpdGl2ZSI6IyDQsiDQtNC40LDQu9C+0LPQtSDQstCy0L7QtNCwINC60L7Qu9C40YfQtdGB0YLQstCwIC0gItCe0LoiCgogICAgICAgIGhhc2hNYXAucHV0KCJ2aWJyYXRlIiwgIiIpCgogICAgICAgIGlmIGhhc2hNYXAuY29udGFpbnNLZXkoJ3dyaXRlX2xpc3QnKTogICMg0LXRgdGC0Ywg0LvQuCB3cml0ZV9saXN0INCyIGhhc2hNYXAKICAgICAgICAgICAgd3JpdGVfbGlzdCA9IGhhc2hNYXAuZ2V0KCJ3cml0ZV9saXN0Iikuc3BsaXQoIjsiKQogICAgICAgICAgICBub21fYmFyY29kZV93cml0ZSA9IHN0cih3cml0ZV9saXN0Wy0xXSkKICAgICAgICAgICAgd3JpdGVfbGlzdC5yZW1vdmUobm9tX2JhcmNvZGVfd3JpdGUpCiAgICAgICAgICAgIGhhc2hNYXAucHV0KCJ3cml0ZV9saXN0IiwgIjsiLmpvaW4od3JpdGVfbGlzdCkpCgogICAgICAgIGVsc2U6CiAgICAgICAgICAgIG5vbV9iYXJjb2RlX3dyaXRlID0gc3RyKGhhc2hNYXAuZ2V0KCJjdXJyZW50X29iamVjdCIpKQogICAgICAgICMg0L/QtdGA0LXQutGA0LDRiNC40LLQsNC10Lwg0LIg0LfQtdC70LXQvdGL0LkKCiAgICAgICAgaWYgaGFzaE1hcC5jb250YWluc0tleSgiZ3JlZW5fbGlzdCIpOgogICAgICAgICAgICBncmVlbl9saXN0ID0gaGFzaE1hcC5nZXQoImdyZWVuX2xpc3QiKS5zcGxpdCgiOyIpCiAgICAgICAgICAgIGdyZWVuX2xpc3QuYXBwZW5kKG5vbV9iYXJjb2RlX3dyaXRlKQogICAgICAgICAgICBoYXNoTWFwLnB1dCgiZ3JlZW5fbGlzdCIsICI7Ii5qb2luKGdyZWVuX2xpc3QpKQoKICAgICAgICBlbHNlOgogICAgICAgICAgICBoYXNoTWFwLnB1dCgiZ3JlZW5fbGlzdCIsIG5vbV9iYXJjb2RlX3dyaXRlKQoKICAgICAgICBpZiBoYXNoTWFwLmNvbnRhaW5zS2V5KCJ5ZWxsb3dfbGlzdCIpIGFuZCBub21fYmFyY29kZV93cml0ZSBpbiBoYXNoTWFwLmdldCgieWVsbG93X2xpc3QiKToKICAgICAgICAgICAgeWVsbG93X2xpc3QgPSBoYXNoTWFwLmdldCgieWVsbG93X2xpc3QiKS5zcGxpdCgiOyIpCiAgICAgICAgICAgIHllbGxvd19saXN0LnJlbW92ZShub21fYmFyY29kZV93cml0ZSkgICMgVmFsdWVFcnJvcjogbGlzdC5yZW1vdmUoeCk6IHggbm90IGluIGxpc3QKICAgICAgICAgICAgaGFzaE1hcC5wdXQoInllbGxvd19saXN0IiwgIjsiLmpvaW4oeWVsbG93X2xpc3QpKQoKICAgICAgICAj0L7Qv9GA0LXQtNC10LvRj9C10LwgSUQKICAgICAgICBpZiBoYXNoTWFwLmNvbnRhaW5zS2V5KCd3cml0ZV9pZF9saXN0Jyk6ICAjINC10YHRgtGMINC70Lggd3JpdGVfaWRfbGlzdCDQsiBoYXNoTWFwCiAgICAgICAgICAgIHdyaXRlX2lkX2xpc3QgPSBoYXNoTWFwLmdldCgid3JpdGVfaWRfbGlzdCIpLnNwbGl0KCI7IikKICAgICAgICAgICAgbm9tX2lkID0gc3RyKHdyaXRlX2lkX2xpc3RbLTFdKQogICAgICAgICAgICB3cml0ZV9pZF9saXN0LnJlbW92ZShub21faWQpCiAgICAgICAgICAgIGhhc2hNYXAucHV0KCJ3cml0ZV9pZF9saXN0IiwgIjsiLmpvaW4od3JpdGVfaWRfbGlzdCkpCgogICAgICAgIGVsc2U6CiAgICAgICAgICAgIG5vbV9pZCA9IHN0cihoYXNoTWFwLmdldCgnbm9tX2lkJykpCgogICAgICAgICAgICAjINC00L7QsdCw0LLQu9GP0LXQvCDQsiDQsdCw0LfRgwogICAgICAgIGlmIGdldGZsb2F0X2lmX2V4aXN0KGhhc2hNYXAsICJxdHkiKSA+IDA6CiAgICAgICAgICAgIHdpdGggZGJfc2Vzc2lvbjoKICAgICAgICAgICAgICAgIGludmVudG9yeSA9IHVpX2dsb2JhbC5TV19JbnZlbnRvcnlbaW50KGhhc2hNYXAuZ2V0KCJpbnZfaWQiKSldCiAgICAgICAgICAgICAgICByID0gdWlfZ2xvYmFsLlNXX0ludmVudG9yeV9saW5lKHF0eT1nZXRmbG9hdF9pZl9leGlzdChoYXNoTWFwLCAicXR5IiksIHNrdT1pbnQobm9tX2lkKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2VsbD1jZWxsaWQsIGludmVudG9yeT1pbnZlbnRvcnkpCiAgICAgICAgICAgICAgICBjb21taXQoKQogICAgICAgICAgICAgICAgZm91bmQuYXBwZW5kKGludChub21faWQpKQogICAgICAgICAgICAgICAgZ3JlZW5fc2l6ZSArPSAxCiAgICAgICAgICAgICAgICBpbnZkYXRlID0gZGF0ZXRpbWUuZnJvbWlzb2Zvcm1hdChzdHIoaGFzaE1hcC5nZXQoImludl9kYXRlIikpKQogICAgICAgICAgICAgICAgaGFzaE1hcC5wdXQoImludiIsICLQmNC90LLQtdC90YLQsNGA0LjQt9Cw0YbQuNGPICIgKyBzdHIoaGFzaE1hcC5nZXQoImludl9uYW1lIikpICsgIiDQvtGCICIgKyBpbnZkYXRlLnN0cmZ0aW1lKAogICAgICAgICAgICAgICAgICAgICIlbS4lZC4lWSwgJUg6JU06JVMiKSArICI8L24+INCd0LDQudC00LXQvdC+OiA8YmlnPiIgKyBzdHIoCiAgICAgICAgICAgICAgICAgICAgZ3JlZW5fc2l6ZSkgKyAiPC9iaWc+IiArICIg0LjQtyA6IiArICI8YmlnPiIgKyBzdHIoeWVsbG93X3NpemUpICsgIjwvYmlnPiIpCgogICAgaWYgaGFzaE1hcC5nZXQoImxpc3RlbmVyIikgPT0gItCaINCv0KfQldCZ0JrQlSI6CiAgICAgICAgaGFzaE1hcC5wdXQoIk5leHRTdGVwIiwgItCS0YvQsdC+0YAg0Y/Rh9C10LnQutC4IikKICAgICAgICBpbnZkYXRlID0gZGF0ZXRpbWUuZnJvbWlzb2Zvcm1hdChzdHIoaGFzaE1hcC5nZXQoImludl9kYXRlIikpKQogICAgICAgIGhhc2hNYXAucHV0KCJpbnYiLAogICAgICAgICAgICAgICAgICAgICLQmNC90LLQtdC90YLQsNGA0LjQt9Cw0YbQuNGPICIgKyBzdHIoaGFzaE1hcC5nZXQoImludl9uYW1lIikpICsgIiDQvtGCICIgKyBpbnZkYXRlLnN0cmZ0aW1lKCIlbS4lZC4lWSwgJUg6JU06JVMiKSkKCiAgICByZXR1cm4gaGFzaE1hcAoKCgojIC1FTkQgQ1VTVE9NIEhBTkRMRVJTCgoKCkBhcHAucm91dGUoJy9zZXRfaW5wdXRfZGlyZWN0LzxtZXRob2Q+JywgbWV0aG9kcz1bJ1BPU1QnXSkKZGVmIHNldF9pbnB1dChtZXRob2QpOgogICAgI2Z1bmMgPSBtZXRob2QKICAgIGZ1bmMgPSBtZXRob2QucmVwbGFjZSgnXycsICcnLCAxKQogICAgamRhdGEgPSBqc29uLmxvYWRzKHJlcXVlc3QuZGF0YS5kZWNvZGUoJ3V0Zi04JykpCiAgICBmID0gZ2xvYmFscygpW2Z1bmNdCiAgICBoYXNoTWFwLmQgPSBqZGF0YVsnaGFzaG1hcCddCiAgICAjIGYoKQogICAgIyBmKCdoYXNobWFwJykKICAgIGYoaGFzaE1hcCkgICMgbmV3CiAgICBqZGF0YVsnaGFzaG1hcCddID0gaGFzaE1hcC5leHBvcnQoKQogICAgamRhdGFbJ3N0b3AnXSA9IEZhbHNlCiAgICBqZGF0YVsnRXJyb3JNZXNzYWdlJ10gPSAnJwogICAgamRhdGFbJ1Jvd3MnXSA9IFtdCgogICAgcmV0dXJuIGpzb24uZHVtcHMoamRhdGEpCgoKQGFwcC5yb3V0ZSgnL3Bvc3Rfc2NyZWVuc2hvdCcsIG1ldGhvZHM9WydQT1NUJ10pCmRlZiBwb3N0X3NjcmVlbnNob3QoKToKICAgIGQgPSByZXF1ZXN0LmRhdGEKICAgIHJldHVybiAnMScKCgpjbGFzcyBoYXNoTWFwOgogICAgZCA9IHt9CgogICAgZGVmIHB1dChrZXksIHZhbCk6CiAgICAgICAgaGFzaE1hcC5kW2tleV0gPSB2YWwKCiAgICBkZWYgZ2V0KGtleSk6CiAgICAgICAgcmV0dXJuIGhhc2hNYXAuZC5nZXQoa2V5KQoKICAgIGRlZiByZW1vdmUoa2V5KToKICAgICAgICBpZiBrZXkgaW4gaGFzaE1hcC5kOgogICAgICAgICAgICBoYXNoTWFwLmQucG9wKGtleSkKCiAgICBkZWYgY29udGFpbnNLZXkoa2V5KToKICAgICAgICByZXR1cm4ga2V5IGluIGhhc2hNYXAuZAoKICAgIGRlZiBleHBvcnQoKTogICMgSXQncyBOT1QgZXJyb3IhISEKICAgICAgICBleF9oYXNoTWFwID0gW10KICAgICAgICBmb3Iga2V5IGluIGhhc2hNYXAuZC5rZXlzKCk6CiAgICAgICAgICAgIGV4X2hhc2hNYXAuYXBwZW5kKHsna2V5Jzoga2V5LCAndmFsdWUnOiBoYXNoTWFwLmRba2V5XX0pCiAgICAgICAgcmV0dXJuIGV4X2hhc2hNYXAKCgppZiBfX25hbWVfXyA9PSAnX19tYWluX18nOgogICAgaW5pdF9vbl9zdGFydCgpICAjIG5ldwogICAgYXBwLnJ1bihob3N0PScwLjAuMC4wJywgcG9ydD0yMDc1LCBkZWJ1Zz1UcnVlKQo=",
        "PyFiles": [],
        "PyTimerTask": [
            {
                "PyTimerTaskKey": "on_start",
                "PyTimerTaskDef": "init_on_start",
                "PyTimerTaskPeriod": "-1",
                "PyTimerTaskBuilIn": false
            }
        ],
        "RecognitionTemplates": [
            {
                "name": "Распознавание артикула",
                "TypeRecognition": "Распознавание текста",
                "mesure_qty": "1",
                "min_freq": "1",
                "min_length": "3",
                "max_length": "15",
                "query": "c2VsZWN0ICogZnJvbSBTV19Hb29kcyB3aGVyZSBwcm9kdWN0X251bWJlciBsaWtlICA/",
                "ReplaceO": true,
                "ToUpcase": false,
                "control_field": "product_number",
                "result_field": "id",
                "cursor": [
                    {
                        "title": "id",
                        "var": "nom_id",
                        "field": "id"
                    }
                ],
                "result_var": "nom_id"
            }
        ],
        "MainMenu": [
            {
                "MenuItem": "1",
                "MenuTitle": " ",
                "MenuId": "1",
                "MenuTop": true
            }
        ]
    }
}